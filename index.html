<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>萌萌的PP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="爱好码代码的小菜鸟啦!!!">
<meta property="og:type" content="website">
<meta property="og:title" content="萌萌的PP">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="萌萌的PP">
<meta property="og:description" content="爱好码代码的小菜鸟啦!!!">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="萌萌的PP">
<meta name="twitter:description" content="爱好码代码的小菜鸟啦!!!">
  
    <link rel="alternate" href="/atom.xml" title="萌萌的PP" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://mmdpp.oss-cn-hangzhou.aliyuncs.com/blog_picture/photo.png?Expires=1542289434&amp;OSSAccessKeyId=TMP.AQG_RpuS4fyqggAxYqW_-DP3rhVICt7iBDnM2SL8sxXGOIE4S99ZyErlUmX1ADAtAhQuet9a6zd-APvmQsTcEovHdxiSSAIVAM-031-ELaXQL220snS3uY_RUT0O&amp;Signature=5LUKd6FkQqv3HA0s92Z7Wj8rmmo%3D">
    <h2 class="author">Mr Tong</h2>
    <h3 class="description">爱好码代码的小菜鸟啦!!!</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>13</strong><br>文章</div></a>
      <a href="/categories"><div><strong>5</strong><br>分类</div></a>
      <a href="/tags"><div><strong>15</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/" title="About">
            <li>关于</li>
          </a>
        
          <a href="/" title="展示">
            <li>展示</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-基于java的容器底层原理实现" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/15/基于java的容器底层原理实现/" class="article-date">
  <time class="post-time" datetime="2018-11-15T12:50:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">15</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/15/基于java的容器底层原理实现/">基于java的容器底层原理实现</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/15/基于java的容器底层原理实现/" class="leancloud_visitors" data-flag-title="基于java的容器底层原理实现">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-java容器的体系大览"><a href="#一-java容器的体系大览" class="headerlink" title="一.java容器的体系大览"></a>一.java容器的体系大览</h2><p><img src="https://img-blog.csdnimg.cn/20181112115653565.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-java为啥子需要容器呢"><a href="#1-java为啥子需要容器呢" class="headerlink" title="1. java为啥子需要容器呢?"></a>1. java为啥子需要容器呢?</h4><p>通常，程序总是在运行时才能确定要创建的对象，甚至是对象的类型。为了解决这个问题，需要在任意时刻任意位置创建任意数量的对象。大多数语言都提供某种方法来解决这个问题，Java使用容器来解决这个问题。容器也称集合类，基本的类型是List、Set、Queue、Map，但由于Java类库中使用了Collection关键字来代表某一接口，所以一般用容器来称呼这些集合类。Java容器工具包位置是==java.util.*==。</p>
<h4 id="2-java-util包简介"><a href="#2-java-util包简介" class="headerlink" title="2. java.util包简介"></a>2. java.util包简介</h4><p><img src="https://img-blog.csdnimg.cn/20181112114354256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-容器的大体组成"><a href="#3-容器的大体组成" class="headerlink" title="3. 容器的大体组成"></a>3. 容器的大体组成</h4><p>Java容器主要可以划分为5个部分：List列表、Set集合、Map映射、queue队列、工具类(Iterator迭代器、Enumeration枚举类、Arrays和Collections)。<br><img src="https://img-blog.csdnimg.cn/20181112115625910.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181112115810675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>上面两图也是下面要展开讲解的部分啦！</p>
<h2 id="二-list接口的实现-主要讲解下面四个实现"><a href="#二-list接口的实现-主要讲解下面四个实现" class="headerlink" title="二. list接口的实现(主要讲解下面四个实现)"></a>二. list接口的实现(主要讲解下面四个实现)</h2><p><img src="https://img-blog.csdnimg.cn/20181112160923957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-list的概念"><a href="#1-list的概念" class="headerlink" title="1. list的概念"></a>1. list的概念</h4><p> List 接口继承 Collection，==<strong>有序允许重复</strong>==，以元素安插的次序来放置元素，<strong>不会重新排列</strong>。<br> <img src="https://img-blog.csdnimg.cn/20181112124444676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="1-1-list集合源码中的方法"><a href="#1-1-list集合源码中的方法" class="headerlink" title="1-1 list集合源码中的方法"></a>1-1 list集合源码中的方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.UnaryOperator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Query Operations</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of elements in this list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;tt&gt;true&lt;/tt&gt; if this list contains no elements</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this list contains the specified element.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> an iterator over the elements in this list in proper sequence</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an array containing all of the elements in this list in proper(自身的，合适的)</span></span><br><span class="line"><span class="comment">     * sequence (from first to last element).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object[] toArray();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an array containing all of the elements in this list in</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; T[] toArray(T[] a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Appends the specified element to the end of this list (optional operation).</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Lists that support this operation may place limitations on what</span></span><br><span class="line"><span class="comment">     * elements may be added to this list.  In particular, some</span></span><br><span class="line"><span class="comment">     * lists will refuse to add null elements, and others will impose（利用，欺骗）</span></span><br><span class="line"><span class="comment">     * restrictions（限制） on the type of elements that may be added（可能添加的元素类型的限制）. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the first occurrence of the specified element from this list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this list contains all of the elements of the specified collection.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Appends all of the elements in the specified collection to the end of</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts all of the elements in the specified collection into this</span></span><br><span class="line"><span class="comment">     *  list at the specified position (optional operation). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes from this list all of its elements that are contained in the specified collection (optional operation)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retains（保持，保留） only the elements in this list that are contained in the</span></span><br><span class="line"><span class="comment">     * specified collection (optional operation).  In other words, removes</span></span><br><span class="line"><span class="comment">     * from this list all of its elements that are not contained in the specified collection.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces each element of this list with the result of applying the operator to that element.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(operator);</span><br><span class="line">        <span class="keyword">final</span> ListIterator&lt;E&gt; li = <span class="keyword">this</span>.listIterator();</span><br><span class="line">        <span class="keyword">while</span> (li.hasNext()) &#123;</span><br><span class="line">            li.set(operator.apply(li.next()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sorts this list according to the order induced by the specified</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">        Object[] a = <span class="keyword">this</span>.toArray();</span><br><span class="line">        Arrays.sort(a, (Comparator) c);</span><br><span class="line">        ListIterator&lt;E&gt; i = <span class="keyword">this</span>.listIterator();</span><br><span class="line">        <span class="keyword">for</span> (Object e : a) &#123;</span><br><span class="line">            i.next();</span><br><span class="line">            i.set((E) e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes all of the elements from this list (optional operation).</span></span><br><span class="line"><span class="comment">     * The list will be empty after this call returns</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares the specified object with this list for equality.  </span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; only if the specified object is also a list, both</span></span><br><span class="line"><span class="comment">     * lists have the same size, and all corresponding pairs of （对的）elements in</span></span><br><span class="line"><span class="comment">     * the two lists are &lt;i&gt;equal&lt;/i&gt;.  </span></span><br><span class="line"><span class="comment">     * In other words, two lists are defined to be equal if they contain the same elements in the same order.  This</span></span><br><span class="line"><span class="comment">     * definition ensures that the equals method works properly across</span></span><br><span class="line"><span class="comment">     * different implementations of the &lt;tt&gt;List&lt;/tt&gt; interface.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the hash code value for this list.  The hash code of a list</span></span><br><span class="line"><span class="comment">     * is defined to be the result of the following calculation（计算，计算方法）:</span></span><br><span class="line"><span class="comment">     * &lt;pre&gt;&#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     *     int hashCode = 1;</span></span><br><span class="line"><span class="comment">     *     for (E e : list)</span></span><br><span class="line"><span class="comment">     *         hashCode = 31*hashCode + (e==null ? 0 : e.hashCode());</span></span><br><span class="line"><span class="comment">     * &#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the element at the specified position in this list.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index index of the element to return</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the element at the specified position in this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IndexOutOfBoundsException if the index is out of range</span></span><br><span class="line"><span class="comment">     *         (&lt;tt&gt;index &lt; 0 || index &gt;= size()&lt;/tt&gt;) (因为ArrayList为数组实现方式， 从0开始到长度-1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces the element at the specified position in this list with the  specified element (optional operation)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts the specified element at the specified position in this list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the element at the specified position in this list (optional operation). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the index of the first occurrence of the specified element （返回第一个出现该元素的位置）</span></span><br><span class="line"><span class="comment">     * in this list, or -1 if this list does not contain the element.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the index of the last occurrence of the specified element</span></span><br><span class="line"><span class="comment">     * in this list, or -1 if this list does not contain the element.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a list iterator over the elements in this list (in proper sequence).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a list iterator over the elements in this list (in proper</span></span><br><span class="line"><span class="comment">     * sequence), starting at the specified position in the list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a view of the portion of this list between the specified</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;fromIndex&lt;/tt&gt;, inclusive（递归）, and &lt;tt&gt;toIndex&lt;/tt&gt;, exclusive.  (If</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;fromIndex&lt;/tt&gt; and &lt;tt&gt;toIndex&lt;/tt&gt; are equal, the returned list is empty.)  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;E&gt; <span class="title">subList</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a &#123;<span class="doctag">@link</span> Spliterator&#125; over the elements in this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Spliterators.spliterator(<span class="keyword">this</span>, Spliterator.ORDERED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-ArrayList的实现"><a href="#2-ArrayList的实现" class="headerlink" title="2. ArrayList的实现"></a>2. ArrayList的实现</h4><p> ==ArrayList 是 List 的子类，它和 HashSet 相反，<strong>允许存放重复元素，因此有序</strong>。集合中元素被访问的顺序取决于集合的类型。如果对 ArrayList 进行访问，迭代器将从索引 0 开始，每迭代一次，索引值加 1。然而，如果访问 HashSet 中的元素，每个元素将会按照<strong>某种随机</strong>的次序出现。虽然可以确定在迭代过程中能够遍历到集合中的所有元素，但却无法预知元素被访问的次序。==</p>
<h5 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2-1 特点"></a>2-1 特点</h5><ul>
<li>底层用数组实现的 List。特点：查询效率高，增删效率低，线程不安全。</li>
<li>既然使用数组实现，底层的查询与插入等等一定是与数组的操作时一样的</li>
<li>下面来看看里面几个重要的方法实现</li>
</ul>
<pre><code>add(E e)方法的源码实现
</code></pre> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">int</span> cursor;       <span class="comment">// index of next element to return (该指针始终指向最后一个元素的下一个元素下标)</span></span><br><span class="line">    	    <span class="keyword">int</span> lastRet = -<span class="number">1</span>; <span class="comment">// index of last element returned; -1 if no such（当cursor指向最后一个的时候就为-1啦！）</span></span><br><span class="line">            <span class="keyword">int</span> expectedModCount = modCount; <span class="comment">//protected transient int modCount = 0;</span></span><br><span class="line">            </span><br><span class="line">           checkForComodification();</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="keyword">int</span> i = cursor;</span><br><span class="line">               ArrayList.<span class="keyword">this</span>.add(i, e);</span><br><span class="line">               cursor = i + <span class="number">1</span>;</span><br><span class="line">               lastRet = -<span class="number">1</span>;</span><br><span class="line">               expectedModCount = modCount;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>add(int index, E element)方法的实现
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">        rangeCheckForAdd(index); <span class="comment">//检查下标越界的函数</span></span><br><span class="line"></span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>, size - index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>真正的插入方法实现 arraycopy(Object src,  int  srcPos, Object dest, int destPos, int length);
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line"> 		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">     </span><br><span class="line">        <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); <span class="comment">//相当于+1啦!</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The capacity of the ArrayList is the length of this array buffer.</span></span><br><span class="line"><span class="comment">     *  Any empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span></span><br><span class="line"><span class="comment">     * will be expanded to）（扩展到） DEFAULT_CAPACITY when the first element is added.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> Object[] elementData;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Default initial capacity.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Copies an array from the specified source array, beginning at the</span></span><br><span class="line"><span class="comment">     * specified position, to the specified position of the destination array.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>      src      the source array.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>      srcPos   starting position in the source array.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>      dest     the destination array.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>      destPos  starting position in the destination data.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>      length   the number of array elements to be copied.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">arraycopy</span><span class="params">(Object src,  <span class="keyword">int</span>  srcPos, Object dest, <span class="keyword">int</span> destPos, <span class="keyword">int</span> length)</span></span>;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-得出的结论"><a href="#2-2-得出的结论" class="headerlink" title="2-2 得出的结论"></a>2-2 得出的结论</h5><p>从上面的ArrayList的插入方式可以知道,里面的元素都是可以重复且与插入的顺序一致(因为是一个接着一个插入的)</p>
<h5 id="2-3-get-int-index-的实现"><a href="#2-3-get-int-index-的实现" class="headerlink" title="2-3 get(int, index)的实现"></a>2-3 get(int, index)的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        rangeCheck(index); <span class="comment">//检查下标问题</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> elementData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-再次得出结论"><a href="#2-4-再次得出结论" class="headerlink" title="2-4 再次得出结论"></a>2-4 再次得出结论</h5><p>为啥ArrayList的查询效率高呢?因为它是根据所给的下标直接返回了元素的. 再深入一步,数组是怎样通过给定一个下标就能直接得到他的值的呢! 下面简单来谈一下.</p>
<ul>
<li><p>定义一个数组其实它的引用(也就是底层实现的爸爸指针啦!)指向的是该数组的首地址, 如:    </p>
<pre><code>Integer[] array =  new Integer[5]; 
array = {1,2,3,4,5};

1.  new(实例化对象) jvm做的三件大事: 在堆里分配空间, 在栈里分配引用空间, 该引用(指针)指向该对象在堆里面的首地址
2.  数组得到的一定是内存中的连续空间
3. 里面的每个子空间为该数组的类型所占的内存大小
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181112152305971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>从数组中取元素的时间复杂度为:==<strong>o(1)</strong>==</p>
<h5 id="2-5-增删效率低"><a href="#2-5-增删效率低" class="headerlink" title="2-5 增删效率低"></a>2-5 增删效率低</h5><p>正因为数组为连续空间存储,当你添加或删除一个元素其他的元素必须跟着相应的移动,效率很低,时间复杂度为: ==<strong>o(n)</strong>==(n为数组的长度)</p>
<h5 id="2-6-ArrayList的set加入元素的实现"><a href="#2-6-ArrayList的set加入元素的实现" class="headerlink" title="2-6 ArrayList的set加入元素的实现"></a>2-6 ArrayList的set加入元素的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        E oldValue = elementData(index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>看完上面的源码有没有发现什么惊天大密码? 主要它的下标index, 能得出的结论就是:</p>
<pre><code>采用set方式,你要设置的该下标必须的存在元素,也就是说每个下标的第一次赋值必须用add方式,set相当于修改该下标的值;
如果直接用set方式给ArrayList赋值,会抛出下标越界异常,请看下面的测试:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line">        <span class="comment">//LinkedList</span></span><br><span class="line">        ArrayList&lt;Integer&gt; array = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        array.add(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line">        array.add(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">        array.set(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;array.size(); ++i)&#123;</span><br><span class="line">            System.out.println(array.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>抛出的异常为:<br><img src="https://img-blog.csdnimg.cn/20181112164333718.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>而且采用add添加元素时,必须连续的添加且从0下标开始,不然也会抛出上面的异常, 如下写法错误:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种错误写法</span></span><br><span class="line"> array.add(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line"> array.add(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line"> <span class="comment">//第二种错误写法</span></span><br><span class="line"> array.add(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"> array.add(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line"> <span class="comment">//正确写法</span></span><br><span class="line"> array.add(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"> array.add(<span class="number">1</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure></p>
<h5 id="2-7-为啥ArrayList是线程不安全的呢"><a href="#2-7-为啥ArrayList是线程不安全的呢" class="headerlink" title="2-7 为啥ArrayList是线程不安全的呢?"></a>2-7 为啥ArrayList是线程不安全的呢?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加一个元素时，做了如下两步操作</span></span><br><span class="line"><span class="comment">     * 1.判断列表的capacity容量是否足够，是否需要扩容</span></span><br><span class="line"><span class="comment">     * 2.真正将元素放在列表的元素数组里面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*扩容的基本操作源码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ensureExplicitCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> <strong>仔细观察源码,是有多线程安全问题的,主要有两个基本问题:</strong></p>
<pre><code>1.在多个线程进行add操作时可能会导致elementData数组越界. 具体逻辑如下：
</code></pre><p>数组默认大小为10，即size=10<br>线程A开始进入add方法，这时它获取到当前数组size的值为9，调用ensureCapacityInternal方法进行容量判断。<br>线程B此时也进入add方法，它获取到size的值也为9，也开始调用ensureCapacityInternal方法。<br>线程A发现需求大小为10，而elementData的大小就为10，可以容纳。于是它不再扩容，返回。<br>线程B也发现需求大小为10，也可以容纳，返回。<br>线程A开始进行设置值操作， elementData[size++] = e 操作。此时size变为10。<br>线程B也开始进行设置值操作，它尝试设置elementData[10] = e，而elementData没有进行过扩容，它的下标最大为9。于是此时会报出一个数组越界的异常ArrayIndexOutOfBoundsException.</p>
<pre><code>elementData[size++] = e 设置值的操作同样会导致线程不安全。从这儿可以看出，这步操作也不是一个原子操作，它由如下两步操作构成：

elementData[size] = e;  //1111111
size = size + 1;        //2222222
在单线程执行这两条代码时没有任何问题，但是当多线程环境下执行时，可能就会发生一个线程的值覆盖另一个线程添加的值，具体逻辑如下：
</code></pre><p>列表大小为0，即size=0<br>线程A开始添加一个元素，值为A。此时它执行第一条操作，将A放在了elementData下标为0的位置上。<br>接着线程B刚好也要开始添加一个值为B的元素，且走到了第一步操作。此时线程B获取到size的值依然为0，于是它将B也放在了elementData下标为0的位置上。<br>线程A开始将size的值增加为1<br>线程B开始将size的值增加为2<br>这样线程AB执行完毕后，理想中情况为size为2，elementData下标0的位置为A，下标1的位置为B。而实际情况变成了size为2，elementData下标为0的位置变成了B，下标1的位置上什么都没有。并且后续除非使用set方法修改此位置的值，否则将一直为null，因为size为2，添加元素时会从下标为2的位置上开始。</p>
<pre><code>线程测试不安全,让它先出原型:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">          List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 线程A将0-1000添加到list</span></span><br><span class="line">          <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span> ; i++) &#123;</span><br><span class="line">                      list.add(i);</span><br><span class="line"></span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                          Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                          e.printStackTrace();</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;).start();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 线程B将1000-2000添加到列表</span></span><br><span class="line">          <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1000</span>; i &lt; <span class="number">2000</span> ; i++) &#123;</span><br><span class="line">                      list.add(i);</span><br><span class="line"></span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                          Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                          e.printStackTrace();</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;).start();</span><br><span class="line"></span><br><span class="line">          Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 打印所有结果</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">              System.out.println(<span class="string">"第"</span> + (i + <span class="number">1</span>) + <span class="string">"个元素为："</span> + list.get(i));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<pre><code>结果如下:
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181112160636868.png" alt="在这里插入图片描述"></p>
<h4 id="3-LinkedList的实现"><a href="#3-LinkedList的实现" class="headerlink" title="3. LinkedList的实现"></a>3. LinkedList的实现</h4><p>==LinkedList 是一种可以<strong>在任何位置进行高效地插入和删除操作的有序序列</strong>。底层用<strong>双向链表</strong>实现的 List。<strong>特点：查询效率低，增删效率高，线程不安全。</strong>==</p>
<pre><code>java里面定义的链式结构如下:
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181112170241324.png" alt="在这里插入图片描述"></p>
<pre><code>java里面的每个节点Node的源码描述:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        E item;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">        Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.item = element;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">            <span class="keyword">this</span>.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这就知道了LinkedList 的底层是用双向链表实现的,下面先来从数据结构的角度分析一下双向链表的特点:</p>
<pre><code>双向链表的插入
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181112172604824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如上图,大致有四步操作,对应的算法实现如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m.next=q.prev;     //1</span><br><span class="line">m.prev=p.next;	  //2</span><br><span class="line">p.next=m.prev;   //3</span><br><span class="line">q.prev=m.next;  //4</span><br></pre></td></tr></table></figure></p>
<pre><code>双向链表的删除
</code></pre><p><img src="https://img-blog.csdnimg.cn/2018111217343749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>对应的算法实现如下:</p>
<pre><code>p.next=m.next;    //1
m.next.prev=m.prev    //2
</code></pre><h5 id="3-1-上面解释了第一个问题-查询效率低，增删效率高"><a href="#3-1-上面解释了第一个问题-查询效率低，增删效率高" class="headerlink" title="3-1 上面解释了第一个问题:查询效率低，增删效率高"></a>3-1 上面解释了第一个问题:查询效率低，增删效率高</h5><pre><code>查询元素的复杂度为:o(n)  //n为链表的size
增删的时间复杂度为:o(1)  
</code></pre><h5 id="3-2-从源码看java怎样实现元素的添加的"><a href="#3-2-从源码看java怎样实现元素的添加的" class="headerlink" title="3-2 从源码看java怎样实现元素的添加的"></a>3-2 从源码看java怎样实现元素的添加的</h5><pre><code>add(E e)方法的实现
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		*初始化的一些值</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">private</span> Node&lt;E&gt; lastReturned;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; next;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> nextIndex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                linkLast(e); <span class="comment">//链表的尾插法(默认为尾插法)</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                linkBefore(e, next); <span class="comment">//链表的头插法</span></span><br><span class="line">            nextIndex++; <span class="comment">//始终指向当前节点</span></span><br><span class="line">            expectedModCount++;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>add(E e)的分解详解
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">protected</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>; <span class="comment">//初始化的值</span></span><br><span class="line">			<span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount; <span class="comment">//初始化的值</span></span><br><span class="line">         </span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Links e as last element.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;E&gt; l = last; <span class="comment">//l 与 last两个指针同时指向最后一个节点</span></span><br><span class="line">        <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(l, e, <span class="keyword">null</span>); <span class="comment">//得到一个新节点,新的节点的前驱指向最后一个节点的后继</span></span><br><span class="line">        last = newNode; <span class="comment">//last指向新的节点,怎样最后一个节点与新的节点互联了</span></span><br><span class="line">        <span class="keyword">if</span> (l == <span class="keyword">null</span>) <span class="comment">//异常,没有连上</span></span><br><span class="line">            first = newNode; <span class="comment">//头结点指针指向新节点</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l.next = newNode;</span><br><span class="line">        size++; <span class="comment">//链表长度加1</span></span><br><span class="line">        modCount++; <span class="comment">//对应的加1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts element e before non-null Node succ.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">linkBefore</span><span class="params">(E e, Node&lt;E&gt; succ)</span> </span>&#123; <span class="comment">//succ节点为头结点后面的第一个数据节点</span></span><br><span class="line">        <span class="comment">// assert succ != null;</span></span><br><span class="line">        <span class="keyword">final</span> Node&lt;E&gt; pred = succ.prev; <span class="comment">//定义个指针指向head节点</span></span><br><span class="line">        <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, succ); <span class="comment">//得到的节点已经连接好两个点啦!</span></span><br><span class="line">        succ.prev = newNode; <span class="comment">//继续连接</span></span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>) <span class="comment">//如果pred连接不成功</span></span><br><span class="line">            first = newNode; <span class="comment">//采用first指针连接</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-3-插入节点的结论"><a href="#3-3-插入节点的结论" class="headerlink" title="3-3 插入节点的结论"></a>3-3 插入节点的结论</h5><p>从上面可以得出,LinkedList默认插入方式为尾插法,也就是每个元素都是插在链表的最后面,所以为有序序列,且允许元素为空,且为双向链表,源码里面写的非常清楚:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> * Doubly-linked list implementation of the &#123;@code List&#125; and &#123;@code Deque&#125;</span><br><span class="line"> * interfaces.  Implements all optional list operations, and permits allelements (including &#123;@code null&#125;).	</span><br><span class="line">````	</span><br><span class="line">##### 3-4  获取元素的方法实现</span><br><span class="line">	get(int index) 方法的源码实现	</span><br><span class="line">````java</span><br><span class="line">public E get(int index) &#123;</span><br><span class="line">        checkElementIndex(index); //检查下标的函数</span><br><span class="line">        return node(index).item;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>get(int index)的分解
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*下标检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkElementIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isElementIndex(index))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isElementIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 关键代码的实现</span></span><br><span class="line"><span class="comment">     * Returns the (non-null) Node at the specified element index.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123; <span class="comment">// 为运算, 向右移动一位2进制, 如果为偶数相当于除2, 如果为奇数那就是整除2,如5/2=2;</span></span><br><span class="line">           <span class="comment">// 上面的判断减少了检索次数,时间复杂度为0(n/2);优秀</span></span><br><span class="line">            Node&lt;E&gt; x = first; <span class="comment">//头结点</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">                x = x.next; <span class="comment">//往后走</span></span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;E&gt; x = last;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">                x = x.prev; <span class="comment">//往前走</span></span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h6 id="3-5-get结论"><a href="#3-5-get结论" class="headerlink" title="3-5 get结论"></a>3-5 get结论</h6><p>上面的检索顺序根据下标,先判断落在前半段还是后半段,大大的减少了索引的顺序,使得时间复杂度降低了一半,但是与ArrayList的数组实现模式相比,这样的时间复杂度还是不能忍受的.</p>
<h5 id="3-6-简单看一下set-E-e-覆盖元素-与上面差不多-不多讲解"><a href="#3-6-简单看一下set-E-e-覆盖元素-与上面差不多-不多讲解" class="headerlink" title="3-6 简单看一下set(E e), 覆盖元素,与上面差不多,不多讲解"></a>3-6 简单看一下set(E e), 覆盖元素,与上面差不多,不多讲解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (lastReturned == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned.item = e;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-Stack-与-Vector实现"><a href="#4-Stack-与-Vector实现" class="headerlink" title="4. Stack 与 Vector实现"></a>4. Stack 与 Vector实现</h4><h5 id="4-1-Vector实现线程安全的方式"><a href="#4-1-Vector实现线程安全的方式" class="headerlink" title="4-1 Vector实现线程安全的方式"></a>4-1 Vector实现线程安全的方式</h5><p>==<strong>Vector(向量)与 ArrayList 底层一致，就是多了线程安全而已</strong>。那Vector到底施了啥魔法变得线程安全呢?那下面我来简单的通过源码来展示它背后的神秘力量.==<br>继承结构:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vector</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure></p>
<h5 id="4-2-实现线程安全的关键"><a href="#4-2-实现线程安全的关键" class="headerlink" title="4-2 实现线程安全的关键"></a>4-2 实现线程安全的关键</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i = cursor;</span><br><span class="line">            <span class="keyword">synchronized</span> (Vector.<span class="keyword">this</span>) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                Vector.<span class="keyword">this</span>.add(i, e);</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125;</span><br><span class="line">            cursor = i + <span class="number">1</span>;</span><br><span class="line">            lastRet = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>揭开它的面纱才发现:我靠,这么简单,暴力,每错,与ArrayList的方式一模一样,就是<strong>加了个同步锁</strong>,其实看到这里我情不自禁的笑起来了,简简单单.</li>
<li>这也解释了为什么<strong>Vector效率比较低</strong>啦!原因就是多了个同步等待啦!</li>
<li><strong>熊掌与鱼不可兼得</strong>,java中还有许多怎样的例子啦! StringBuffer(低效,安全)与StringBuilder就是怎样啦!但逗比String高效.<h5 id="4-3-Stack实现FILO-先进后出-的方法"><a href="#4-3-Stack实现FILO-先进后出-的方法" class="headerlink" title="4-3 Stack实现FILO(先进后出)的方法"></a>4-3 Stack实现FILO(先进后出)的方法</h5>==<strong>Stack(栈)为 Vector 子类，具有后进先出的特点。</strong>==<br>继承结构图:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The &lt;code&gt;Stack&lt;/code&gt; class represents a last-in-first-out</span></span><br><span class="line"><span class="comment"> * (LIFO) stack of objects. </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   JDK1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Vector</span>&lt;<span class="title">E</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-4-FILO的源码实现"><a href="#4-4-FILO的源码实现" class="headerlink" title="4-4 FILO的源码实现"></a>4-4 FILO的源码实现</h5><pre><code>插入的操作: push(E item)
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pushes an item onto the top of this stack. This has exactly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   item   the item to be pushed onto this stack.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  the &lt;code&gt;item&lt;/code&gt; argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">push</span><span class="params">(E item)</span> </span>&#123;</span><br><span class="line">    addElement(item);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds the specified component to the end of this vector,</span></span><br><span class="line"><span class="comment">     * increasing its size by one.(并不是从1开始的意思,而是栈是从小到大的增长) </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addElement</span><span class="params">(E obj)</span> </span>&#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        ensureCapacityHelper(elementCount + <span class="number">1</span>); <span class="comment">//与ArrayList一样</span></span><br><span class="line">        elementData[elementCount++] = obj; <span class="comment">//先赋值再++</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>弹出元素的操作: pop(E obj)
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the object at the top of this stack and returns that</span></span><br><span class="line"><span class="comment">     * object as the value of this function.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  The object at the top of this stack (the last item</span></span><br><span class="line"><span class="comment">     *          of the &lt;tt&gt;Vector&lt;/tt&gt; object).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         E   obj;</span><br><span class="line">        <span class="keyword">int</span>  len = size();</span><br><span class="line"></span><br><span class="line">        obj = peek(); <span class="comment">//求出最上面元素的下标</span></span><br><span class="line">        removeElementAt(len - <span class="number">1</span>); <span class="comment">//实际弹出的为最新push进去的元素</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Looks at the object at the top of this stack without removing(正在移动的) it</span></span><br><span class="line"><span class="comment">     * from the stack.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  the object at the top of this stack (the last item</span></span><br><span class="line"><span class="comment">     *          of the &lt;tt&gt;Vector&lt;/tt&gt; object).</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span>  EmptyStackException  if this stack is empty.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>     len = size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</span><br><span class="line">        <span class="keyword">return</span> elementAt(len - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-5-FILO结论"><a href="#4-5-FILO结论" class="headerlink" title="4-5 FILO结论"></a>4-5 FILO结论</h5><p>话不多说,从上面可以赤裸裸的看出Stack(栈)是如何实现先进后出的功能的,插入正常,但是弹出就有点猫腻啦!</p>
<h2 id="三-map接口的源码实现"><a href="#三-map接口的源码实现" class="headerlink" title="三. map接口的源码实现"></a>三. map接口的源码实现</h2><p><img src="https://img-blog.csdnimg.cn/20181112211109780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-map基本概念"><a href="#1-map基本概念" class="headerlink" title="1. map基本概念"></a>1. map基本概念</h4><p>==HashMap 可以说是 Java 中最常用的集合类框架之一，是 Java 语言中非常典型的数据结构，我们总会在不经意间用到它，很大程度上方便了我们日常开发。实现 Map 接口的类 用来存储 <strong>键(key) －值(value)  对</strong>，Map 类中存储的键－<strong>值对通过键来标识</strong>， 所以<strong>键值不能重复</strong>。==</p>
<h4 id="2-map接口的基本方法"><a href="#2-map接口的基本方法" class="headerlink" title="2. map接口的基本方法"></a>2. map接口的基本方法</h4><p><img src="https://img-blog.csdnimg.cn/20181112212813319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An object that maps keys to values.  A map cannot contain duplicate keys;</span></span><br><span class="line"><span class="comment"> * each key can map to at most one value.(key不能重复啦!)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the number of key-value mappings in this map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this map contains no key-value mappings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this map contains a mapping for the specified key. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this map maps one or more keys to the specified value. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsValue</span><span class="params">(Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value to which the specified key is mapped,</span></span><br><span class="line"><span class="comment">     * or &#123;<span class="doctag">@code</span> null&#125; if this map contains no mapping for the key.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Associates the specified value with the specified key in this map (optional operation). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">put</span><span class="params">(K key, V value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the mapping for a key from this map if it is present</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">remove</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Copies all of the mappings from the specified map to this map</span></span><br><span class="line"><span class="comment">     * (optional operation).  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">putAll</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes all of the mappings from this map (optional operation).</span></span><br><span class="line"><span class="comment">     * The map will be empty after this call returns.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Set&#125; view of the keys contained in this map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Collection&#125; view of the values contained in this map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Collection&lt;V&gt; <span class="title">values</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Set&#125; view of the mappings contained in this map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A map entry (key-value pair).  The &lt;tt&gt;Map.entrySet&lt;/tt&gt; method returns</span></span><br><span class="line"><span class="comment">     * a collection-view of the map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns the key corresponding to this entry.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function">K <span class="title">getKey</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns the value corresponding to this entry.  If the mapping</span></span><br><span class="line"><span class="comment">        V getValue();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        /**</span></span><br><span class="line"><span class="comment">         * Replaces the value corresponding to this entry with the specified</span></span><br><span class="line"><span class="comment">         * value (optional operation).  </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function">V <span class="title">setValue</span><span class="params">(V value)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Compares the specified object with this entry for equality.</span></span><br><span class="line"><span class="comment">         * Returns &lt;tt&gt;true&lt;/tt&gt; if the given object is also a map entry and</span></span><br><span class="line"><span class="comment">         * the two entries represent the same mapping.  </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns the hash code value for this map entry. </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns a comparator that compares &#123;<span class="doctag">@link</span> Map.Entry&#125; in natural order on key.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K extends Comparable&lt;? <span class="keyword">super</span> K&gt;, V&gt; Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comparingByKey() &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; c1.getKey().compareTo(c2.getKey());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns a comparator that compares &#123;<span class="doctag">@link</span> Map.Entry&#125; in natural order on value.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V extends Comparable&lt;? <span class="keyword">super</span> V&gt;&gt; Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comparingByValue() &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; c1.getValue().compareTo(c2.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns a comparator that compares &#123;<span class="doctag">@link</span> Map.Entry&#125; by key using the given</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByKey(Comparator&lt;? <span class="keyword">super</span> K&gt; cmp) &#123;</span><br><span class="line">            Objects.requireNonNull(cmp);</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; cmp.compare(c1.getKey(), c2.getKey());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns a comparator that compares &#123;<span class="doctag">@link</span> Map.Entry&#125; by value using the given</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByValue(Comparator&lt;? <span class="keyword">super</span> V&gt; cmp) &#123;</span><br><span class="line">            Objects.requireNonNull(cmp);</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; cmp.compare(c1.getValue(), c2.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares the specified object with this map for equality.  Returns</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;true&lt;/tt&gt; if the given object is also a map and the two maps</span></span><br><span class="line"><span class="comment">     * represent the same mappings.  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the hash code value for this map.  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value to which the specified key is mapped, or</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> defaultValue&#125; if this map contains no mapping for the key.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">getOrDefault</span><span class="params">(Object key, V defaultValue)</span> </span>&#123;</span><br><span class="line">        V v;</span><br><span class="line">        <span class="keyword">return</span> (((v = get(key)) != <span class="keyword">null</span>) || containsKey(key))</span><br><span class="line">            ? v</span><br><span class="line">            : defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs the given action for each entry in this map until all entries</span></span><br><span class="line"><span class="comment">     * have been processed or the action throws an exception.   Unless</span></span><br><span class="line"><span class="comment">     * otherwise specified by the implementing class, actions are performed in</span></span><br><span class="line"><span class="comment">     * the order of entry set iteration (if an iteration order is specified.)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(BiConsumer&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V&gt; action)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(action);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            V v;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                k = entry.getKey();</span><br><span class="line">                v = entry.getValue();</span><br><span class="line">            &#125; <span class="keyword">catch</span>(IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line">            action.accept(k, v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces each entry's value with the result of invoking the given</span></span><br><span class="line"><span class="comment">     * function on that entry until all entries have been processed or the</span></span><br><span class="line"><span class="comment">     * function throws an exception.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; function)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(function);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            V v;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                k = entry.getKey();</span><br><span class="line">                v = entry.getValue();</span><br><span class="line">            &#125; <span class="keyword">catch</span>(IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ise thrown from function is not a cme.</span></span><br><span class="line">            v = function.apply(k, v);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                entry.setValue(v);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If the specified key is not already associated with a value (or is mapped</span></span><br><span class="line"><span class="comment">     * to &#123;<span class="doctag">@code</span> null&#125;) associates it with the given value and returns</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125;, else returns the current value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">putIfAbsent</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V v = get(key);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;</span><br><span class="line">            v = put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the entry for the specified key only if it is currently</span></span><br><span class="line"><span class="comment">     * mapped to the specified value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object key, Object value)</span> </span>&#123;</span><br><span class="line">        Object curValue = get(key);</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(curValue, value) ||</span><br><span class="line">            (curValue == <span class="keyword">null</span> &amp;&amp; !containsKey(key))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        remove(key);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces the entry for the specified key only if currently</span></span><br><span class="line"><span class="comment">     * mapped to the specified value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class="line">        Object curValue = get(key);</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(curValue, oldValue) ||</span><br><span class="line">            (curValue == <span class="keyword">null</span> &amp;&amp; !containsKey(key))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        put(key, newValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces the entry for the specified key only if it is</span></span><br><span class="line"><span class="comment">     * currently mapped to some value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">replace</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V curValue;</span><br><span class="line">        <span class="keyword">if</span> (((curValue = get(key)) != <span class="keyword">null</span>) || containsKey(key)) &#123;</span><br><span class="line">            curValue = put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If the specified key is not already associated with a value (or is mapped</span></span><br><span class="line"><span class="comment">     * to &#123;<span class="doctag">@code</span> null&#125;), attempts to compute its value using the given mapping</span></span><br><span class="line"><span class="comment">     * function and enters it into this map unless &#123;<span class="doctag">@code</span> null&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">computeIfPresent</span><span class="params">(K key,</span></span></span><br><span class="line"><span class="function"><span class="params">            BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        V oldValue;</span><br><span class="line">        <span class="keyword">if</span> ((oldValue = get(key)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            V newValue = remappingFunction.apply(key, oldValue);</span><br><span class="line">            <span class="keyword">if</span> (newValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                put(key, newValue);</span><br><span class="line">                <span class="keyword">return</span> newValue;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                remove(key);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Attempts to compute a mapping for the specified key and its current</span></span><br><span class="line"><span class="comment">     * mapped value (or &#123;<span class="doctag">@code</span> null&#125; if there is no current mapping). For</span></span><br><span class="line"><span class="comment">     * example, to either create or append a &#123;<span class="doctag">@code</span> String&#125; msg to a value mapping</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">compute</span><span class="params">(K key,</span></span></span><br><span class="line"><span class="function"><span class="params">            BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        V oldValue = get(key);</span><br><span class="line"></span><br><span class="line">        V newValue = remappingFunction.apply(key, oldValue);</span><br><span class="line">        <span class="keyword">if</span> (newValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// delete mapping</span></span><br><span class="line">            <span class="keyword">if</span> (oldValue != <span class="keyword">null</span> || containsKey(key)) &#123;</span><br><span class="line">                <span class="comment">// something to remove</span></span><br><span class="line">                remove(key);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// nothing to do. Leave things as they were.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// add or replace old mapping</span></span><br><span class="line">            put(key, newValue);</span><br><span class="line">            <span class="keyword">return</span> newValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If the specified key is not already associated with a value or is</span></span><br><span class="line"><span class="comment">     * associated with null, associates it with the given non-null value.</span></span><br><span class="line"><span class="comment">     * Otherwise, replaces the associated value with the results of the given</span></span><br><span class="line"><span class="comment">     * remapping function, or removes if the result is &#123;<span class="doctag">@code</span> null&#125;. This</span></span><br><span class="line"><span class="comment">     * method may be of use when combining multiple mapped values for a key.</span></span><br><span class="line"><span class="comment">     * For example, to either create or append a &#123;<span class="doctag">@code</span> String msg&#125; to a</span></span><br><span class="line"><span class="comment">     * value mapping:</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> V <span class="title">merge</span><span class="params">(K key, V value,</span></span></span><br><span class="line"><span class="function"><span class="params">            BiFunction&lt;? <span class="keyword">super</span> V, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        Objects.requireNonNull(value);</span><br><span class="line">        V oldValue = get(key);</span><br><span class="line">        V newValue = (oldValue == <span class="keyword">null</span>) ? value :</span><br><span class="line">                   remappingFunction.apply(oldValue, value);</span><br><span class="line">        <span class="keyword">if</span>(newValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            remove(key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            put(key, newValue);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-map的实现类HashMap的实现"><a href="#3-map的实现类HashMap的实现" class="headerlink" title="3. map的实现类HashMap的实现"></a>3. map的实现类HashMap的实现</h4><p>==<strong>HashMap: 线程不安全，效率高. 允许 key 或 value 为 null</strong>==<br>==在JDK1.6，JDK1.7中，HashMap采用位桶+链表实现，即使用<strong>链表处理冲突</strong>，同一hash值的链表都存储在一个链表里。但是当位于一个桶中的元素较多，即hash值相等的元素较多时，通过key值依次查找的效率较低。而<strong>JDK1.8中，HashMap采用位桶+链表+红黑树实现</strong>，<strong>当链表长度超过阈值（8）时，将链表转换为红黑树</strong>，这样大大减少了查找时间。==<br>==当链表数组的容量超过<strong>初始容量的0.75</strong>时，再散列将链表数组<strong>扩大2倍</strong>，把原链表数组的搬移到新的数组,HashMap底层采用散列表存储方式,即是数组+链表的存储方式,结构如下:==<br><img src="https://img-blog.csdnimg.cn/20181112221009982.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>为啥能允许key为空呢?还是得从源码入手    </p>
<pre><code>1. transient Node&lt;k,v&gt;[] table;//存储（位桶）的数组&lt;/k,v&gt; 的定义,其中 数组元素Node&lt;K,V&gt;实现了Entry接口,代码如下:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Basic hash bin node, used for most entries.  (See below for</span></span><br><span class="line"><span class="comment">     * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="comment">//Node是单向链表，它实现了Map.Entry接口  </span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//构造函数的Hash值, 建, 值, 下一个节点的指针</span></span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.hash = hash;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123; <span class="comment">//计算hashcode的方法</span></span><br><span class="line">            <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">            V oldValue = value;</span><br><span class="line">            value = newValue;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//判断两个node是否相等,若key和value都相等，返回true。可以与自身比较为true  </span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                    Objects.equals(value, e.getValue()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>2.源码中的数据域:
加载因子（默认0.75）：为什么需要使用加载因子，为什么需要扩容呢？因为如果填充比很大，说明利用的空间很多，如果一直不进行扩容的话，
链表就会越来越长，这样查找的效率很低，因为链表的长度很大（当然最新版本使用了红黑树后会改进很多），扩容之后，
将原来链表数组的每一个链表分成奇偶两个子链表分别挂在新链表数组的散列位置，这样就减少了每个链表的长度，增加查找效率
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMap</span>&lt;<span class="title">k</span>,<span class="title">v</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">k</span>,<span class="title">v</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">k</span>,<span class="title">v</span>&gt;, <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">362498820763181265L</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">//值为16  </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;<span class="comment">//最大容量  </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;<span class="comment">//填充比  </span></span><br><span class="line">    <span class="comment">//当add一个元素到某个位桶，其链表长度达到8时将链表转换为红黑树  </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;  </span><br><span class="line">    <span class="keyword">transient</span> Node&lt;k,v&gt;[] table;<span class="comment">//存储元素的数组  </span></span><br><span class="line">    <span class="keyword">transient</span> Set&lt;map.entry&lt;k,v&gt;&gt; entrySet;  </span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> size;<span class="comment">//存放元素的个数  </span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;<span class="comment">//被修改的次数fast-fail机制  </span></span><br><span class="line">    <span class="keyword">int</span> threshold;<span class="comment">//临界值 当实际大小(容量*填充比)超过临界值时，会进行扩容   </span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;<span class="comment">//填充比（......后面略）</span></span><br></pre></td></tr></table></figure>
<pre><code>3. HashMap的四种构造函数
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造函数1  </span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;  </span><br><span class="line">     <span class="comment">//指定的初始容量非负  </span></span><br><span class="line">     <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)  </span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(Illegal initial capacity:  +  </span><br><span class="line">                                            initialCapacity);  </span><br><span class="line">     <span class="comment">//如果指定的初始容量大于最大容量,置为最大容量  </span></span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)  </span><br><span class="line">         initialCapacity = MAXIMUM_CAPACITY;  </span><br><span class="line">     <span class="comment">//填充比为正  </span></span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(Illegal load factor:  +  </span><br><span class="line">                                           loadFactor);  </span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;  </span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);<span class="comment">//新的扩容临界值  </span></span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line"><span class="comment">//构造函数2  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);  </span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line"><span class="comment">//构造函数3  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted  </span></span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line"><span class="comment">//构造函数4用m的元素初始化散列映射  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;!--? extends K, ? extends V--&gt; m)</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;  </span><br><span class="line">    putMapEntries(m, <span class="keyword">false</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>4.老大put(key，value)来了
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;,</span></span><br><span class="line"><span class="comment">     *  or &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     *  HashMap map = new HashMap(); //返回结果如下</span></span><br><span class="line"><span class="comment">        System.out.println(map.put(1, 11)); //null</span></span><br><span class="line"><span class="comment">        System.out.println(map.put(2,22 )); //null</span></span><br><span class="line"><span class="comment">        System.out.println(map.put(2,33 )); //22 ,也就是返回改变前的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>put(K key, V value)的详解
下面简单说下添加键值对put(key,value)的过程：
1，判断键值对数组tab[]是否为空或为null，否则以默认大小resize()；
2，根据键值key计算hash值得到插入的数组索引i，如果tab[i]==null，直接新建节点添加，否则转入3
3，判断当前数组中处理hash冲突的方式为链表还是红黑树(check第一个节点类型即可),分别处理
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evict if false, the table is in creation mode(表处于创建模式).</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">            <span class="comment">/*如果table的在（n-1）&amp;hash的值是空，就新建一个节点插入在该位置*/</span>  </span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">             <span class="comment">/*表示有冲突,开始处理冲突*/</span>  </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">             <span class="comment">/*检查第一个Node，p是不是要找的值*/</span></span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">/*指针为空就挂在后面*/</span>  </span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="comment">//如果冲突的节点数已经达到8个，看是否需要改变冲突节点的存储结构，　　　　　　　　　　　　　  </span></span><br><span class="line">　　　　　　　　　　　　   <span class="comment">//treeifyBin首先判断当前hashMap的长度，如果不足64，只进行  </span></span><br><span class="line">                       <span class="comment">//resize，扩容table，如果达到64，那么将冲突的存储结构为红黑树  </span></span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">/*如果有相同的key值就结束遍历*/</span>  </span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/*就是链表上有相同的key值*/</span>  </span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue; <span class="comment">//返回存在的Value值 </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="comment">/*如果当前大小大于门限，门限原本是初始容量*0.75*/</span>  </span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize(); <span class="comment">//扩容两倍  </span></span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>5. HasMap的扩容机制resize(); 构造hash表时，如果不指明初始大小，默认大小为16（即Node数组大小16），如果Node[]数组中的元素达到
（填充比*Node.length）重新调整HashMap大小 变为原来2倍大小,扩容很耗时源码如下:（填充比*Node.length）重新调整HashMap大小 
变为原来2倍大小,扩容很耗时源码如下:变为原来2倍大小,扩容很耗时源码如下:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">    * Initializes or doubles table size.  If null, allocates in </span></span><br><span class="line"><span class="comment">    * accord with initial capacity target held in field threshold. </span></span><br><span class="line"><span class="comment">    * Otherwise, because we are using power-of-two expansion, the </span></span><br><span class="line"><span class="comment">    * elements from each bin must either stay at same index, or move </span></span><br><span class="line"><span class="comment">    * with a power of two offset in the new table. </span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the table </span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">   <span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;  </span><br><span class="line">       Node&lt;K,V&gt;[] oldTab = table;  </span><br><span class="line">       <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;  </span><br><span class="line">       <span class="keyword">int</span> oldThr = threshold;  </span><br><span class="line">       <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;  </span><br><span class="line">      </span><br><span class="line"><span class="comment">/*如果旧表的长度不是空*/</span>  </span><br><span class="line">       <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">           <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;  </span><br><span class="line">               threshold = Integer.MAX_VALUE;  </span><br><span class="line">               <span class="keyword">return</span> oldTab;  </span><br><span class="line">           &#125;  </span><br><span class="line"><span class="comment">/*把新表的长度设置为旧表长度的两倍，newCap=2*oldCap*/</span>  </span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;  </span><br><span class="line">                    oldCap &gt;= DEFAULT_INITIAL_CAPACITY)  </span><br><span class="line">      <span class="comment">/*把新表的门限设置为旧表门限的两倍，newThr=oldThr*2*/</span>  </span><br><span class="line">               newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold  </span></span><br><span class="line">       &#125;  </span><br><span class="line">    <span class="comment">/*如果旧表的长度的是0，就是说第一次初始化表*/</span>  </span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold  </span></span><br><span class="line">           newCap = oldThr;  </span><br><span class="line">       <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults  </span></span><br><span class="line">           newCap = DEFAULT_INITIAL_CAPACITY;  </span><br><span class="line">           newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);  </span><br><span class="line">       &#125;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">       <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;  </span><br><span class="line">           <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;<span class="comment">//新表长度乘以加载因子  </span></span><br><span class="line">           newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?  </span><br><span class="line">                     (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);  </span><br><span class="line">       &#125;  </span><br><span class="line">       threshold = newThr;  </span><br><span class="line">       <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)  </span><br><span class="line"><span class="comment">/*下面开始构造新表，初始化表中的数据*/</span>  </span><br><span class="line">       Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];  </span><br><span class="line">       table = newTab;<span class="comment">//把新表赋值给table  </span></span><br><span class="line">       <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;<span class="comment">//原表不是空要把原表中数据移动到新表中      </span></span><br><span class="line">           <span class="comment">/*遍历原来的旧表*/</span>        </span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;  </span><br><span class="line">               Node&lt;K,V&gt; e;  </span><br><span class="line">               <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                   oldTab[j] = <span class="keyword">null</span>;  </span><br><span class="line">                   <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)<span class="comment">//说明这个node没有链表直接放在新表的e.hash &amp; (newCap - 1)位置  </span></span><br><span class="line">                       newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;  </span><br><span class="line">                   <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)  </span><br><span class="line">                       ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);  </span><br><span class="line"><span class="comment">/*如果e后边有链表,到这里表示e后面带着个单链表，需要遍历单链表，将每个结点重*/</span>  </span><br><span class="line">                   <span class="keyword">else</span> &#123; <span class="comment">// preserve order保证顺序  </span></span><br><span class="line">                <span class="comment">////新计算在新表的位置，并进行搬运  </span></span><br><span class="line">                       Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;  </span><br><span class="line">                       Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;  </span><br><span class="line">                       Node&lt;K,V&gt; next;  </span><br><span class="line">                      </span><br><span class="line">                       <span class="keyword">do</span> &#123;  </span><br><span class="line">                           next = e.next;<span class="comment">//记录下一个结点  </span></span><br><span class="line">          <span class="comment">//新表是旧表的两倍容量，实例上就把单链表拆分为两队，  </span></span><br><span class="line">　　　　　　　　　　　　　<span class="comment">//e.hash&amp;oldCap为偶数一队，e.hash&amp;oldCap为奇数一对  </span></span><br><span class="line">                           <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;  </span><br><span class="line">                               <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)  </span><br><span class="line">                                   loHead = e;  </span><br><span class="line">                               <span class="keyword">else</span>  </span><br><span class="line">                                   loTail.next = e;  </span><br><span class="line">                               loTail = e;  </span><br><span class="line">                           &#125;  </span><br><span class="line">                           <span class="keyword">else</span> &#123;  </span><br><span class="line">                               <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)  </span><br><span class="line">                                   hiHead = e;  </span><br><span class="line">                               <span class="keyword">else</span>  </span><br><span class="line">                                   hiTail.next = e;  </span><br><span class="line">                               hiTail = e;  </span><br><span class="line">                           &#125;  </span><br><span class="line">                       &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);  </span><br><span class="line">                      </span><br><span class="line">                       <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;<span class="comment">//lo队不为null，放在新表原位置  </span></span><br><span class="line">                           loTail.next = <span class="keyword">null</span>;  </span><br><span class="line">                           newTab[j] = loHead;  </span><br><span class="line">                       &#125;  </span><br><span class="line">                       <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;<span class="comment">//hi队不为null，放在新表j+oldCap位置  </span></span><br><span class="line">                           hiTail.next = <span class="keyword">null</span>;  </span><br><span class="line">                           newTab[j + oldCap] = hiHead;  </span><br><span class="line">                       &#125;  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">return</span> newTab;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<pre><code>6. get(key)方法时获取key的hash值，计算hash&amp;(n-1)得到在链表数组中的位置first=tab[hash&amp;(n-1)],先判断first的key是否与参数key相等，
 不等就遍历后面的链表找到相同的key值返回对应的Value值即可不等就遍历后面的链表找到相同的key值返回对应的Value值即可
 get(Object key)的源码实现get(Object key)的源码实现:
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;  </span><br><span class="line">        Node&lt;K,V&gt; e;  </span><br><span class="line">        <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;  </span><br><span class="line">    &#125;  </span><br><span class="line">      <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * Implements Map.get and related methods </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hash hash for key </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the key </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the node, or null if none </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;  </span><br><span class="line">        Node&lt;K,V&gt;[] tab;<span class="comment">//Entry对象数组  </span></span><br><span class="line">    Node&lt;K,V&gt; first,e; <span class="comment">//在tab数组中经过散列的第一个位置  </span></span><br><span class="line">    <span class="keyword">int</span> n;  </span><br><span class="line">    K k;  </span><br><span class="line">    <span class="comment">/*找到插入的第一个Node，方法是hash值和n-1相与，tab[(n - 1) &amp; hash]*/</span>  </span><br><span class="line">    <span class="comment">//也就是说在一条链上的hash值相同的  </span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;(first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;  </span><br><span class="line">    <span class="comment">/*检查第一个Node是不是要找的Node*/</span>  </span><br><span class="line">            <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node  </span></span><br><span class="line">                ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))<span class="comment">//判断条件是hash值要相同，key值要相同  </span></span><br><span class="line">                <span class="keyword">return</span> first;  </span><br><span class="line">      <span class="comment">/*检查first后面的node*/</span>  </span><br><span class="line">            <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)  </span><br><span class="line">                    <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);  </span><br><span class="line">                <span class="comment">/*遍历后面的链表，找到key值和hash值都相同的Node*/</span>  </span><br><span class="line">                <span class="keyword">do</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;  </span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))  </span><br><span class="line">                        <span class="keyword">return</span> e;  </span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>7.JDK1.8 使用红黑数的改进(可以对比平衡二叉树,有许多相同点),排好了序的
</code></pre><p>在Java jdk8中对HashMap的源码进行了优化，在jdk7中，HashMap处理“碰撞”的时候，都是采用链表来存储，当碰撞的点很多时，<strong>查询时间是O（n）</strong>。<br>在jdk8中，HashMap处理“碰撞”增加了红黑树这种数据结构，当碰撞结点较少时，采用链表存储，当较大时（&gt;8个），采用红黑树（特点是查询时间是O（<strong>log2 n</strong>））存储（有一个阀值控制，大于阀值(8个)，将链表存储转换成红黑树存储）<br><img src="https://img-blog.csdnimg.cn/20181112225944761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>你可能还知道哈希碰撞会对hashMap的性能带来灾难性的影响。如果多个hashCode()的值落到同一个桶内的时候，这些值是存储到一个链表中的。最坏的情况下，<strong>所有的key都映射到同一个桶中</strong>，这样hashmap就退化成了一个链表——查找时间从O(1)到O(n)。</li>
<li><p>随着HashMap的大小的增长，get()方法的开销也越来越大。由于所有的记录都在同一个桶里的超长链表内，平均查询一条记录就需要遍历一半的列表。</p>
</li>
<li><p><strong>JDK1.8HashMap的红黑树是这样解决的：</strong></p>
<p> 如果某个桶中的记录过大的话（当前是TREEIFY_THRESHOLD = 8），HashMap会动态的使用一个专门的<strong>treemap</strong>(<strong>实现红黑数的数据结构</strong>)实现来替换掉它。这样做的结果会更好，是O(log2 n)，而不是糟糕的O(n)。</p>
<p> 它是如何工作的？前面产生冲突的那些KEY对应的记录只是简单的追加到一个链表后面，这些记录只能通过遍历来进行查找。但是超过这个阈值后HashMap开始将列表升级成一个二叉树，<strong>使用哈希值作为树的分支变量,hashcode值取余法等等</strong>，如果两个哈希值不等，但指向同一个桶的话，较大的那个会插入到右子树里。如果哈希值相等，HashMap<strong>希望key值最好是实现了Comparable接口的</strong>，这样它可以按照顺序来进行插入。这对HashMap的key来说并不是必须的，不过如果实现了当然最好。如果没有实现这个接口，在出现严重的哈希碰撞的时候，你就并别指望能获得性能提升了。</p>
<h4 id="4-HashTable的实现"><a href="#4-HashTable的实现" class="headerlink" title="4. HashTable的实现"></a>4. HashTable的实现</h4><p>==<strong>线程安全，效率低. 不允许 key 或 value 为 null</strong>==</p>
<p>  为啥有上面的特点,从源码来看看</p>
<h5 id="4-1-put-key-value-方法的实现"><a href="#4-1-put-key-value-方法的实现" class="headerlink" title="4-1 put(key, value)方法的实现"></a>4-1 put(key, value)方法的实现</h5><p><img src="https://img-blog.csdnimg.cn/20181112235845901.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Make sure the value is not null</span></span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Makes sure the key is not already in the hashtable.</span></span><br><span class="line">        Entry&lt;?,?&gt; tab[] = table;</span><br><span class="line">        <span class="keyword">int</span> hash = key.hashCode(); <span class="comment">//如果key为空,抛出NullPointerException();异常,所以没有判断</span></span><br><span class="line">        <span class="comment">//&amp;运算为两个数的二进制的相同数的结果,都从低位开始,如:(4 &amp; 12)---&gt;(100 &amp; 1100)---&gt;100---&gt;4</span></span><br><span class="line">        <span class="keyword">int</span> index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length; <span class="comment">//下标为hashcode值取模法,得到在hash表里面的位置</span></span><br><span class="line">        </span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index];</span><br><span class="line">        <span class="keyword">for</span>(; entry != <span class="keyword">null</span> ; entry = entry.next) &#123; <span class="comment">//散列表的数组部分不为空</span></span><br><span class="line">            <span class="keyword">if</span> ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123; <span class="comment">//找到了桶位,该插入到后面的链表啦!</span></span><br><span class="line">            <span class="comment">//下面三条语句就是将桶位后第一个entry换成插入的,并把原来第一个值返回</span></span><br><span class="line">                V old = entry.value;</span><br><span class="line">                entry.value = value;</span><br><span class="line">                <span class="keyword">return</span> old;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addEntry(hash, key, value, index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>  上面的已经很好的解释了hashTable的特点了:线程安全，效率低. 不允许 key 或 value 为 null</p>
<h4 id="5-Properties的实现"><a href="#5-Properties的实现" class="headerlink" title="5. Properties的实现"></a>5. Properties的实现</h4><p>==Properties是Hashtable 的子类，但是key 和 value 都是 string== , 也就是我们常用的那个Properties文件啦!里面果然是键值对key-value的形式啦!</p>
<h2 id="四-set接口的源码实现"><a href="#四-set接口的源码实现" class="headerlink" title="四. set接口的源码实现"></a>四. set接口的源码实现</h2><p><img src="https://img-blog.csdnimg.cn/20181112203651187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-set基本概念"><a href="#1-set基本概念" class="headerlink" title="1. set基本概念"></a>1. set基本概念</h4><p>==Set 接口继承 Collection，使用自己<strong>内部的一个排列机制</strong>。Set 接口中的<strong>元素无序不可重复</strong>:不包含重复元素,<strong>最多包含一个 null</strong>,<strong>元素没有顺序</strong> 。==</p>
<h4 id="2-set接口的基本方法"><a href="#2-set接口的基本方法" class="headerlink" title="2. set接口的基本方法"></a>2. set接口的基本方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A collection that contains no duplicate elements.  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the number of elements in this set (its cardinality). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this set contains no elements.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this set contains the specified element.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an iterator over the elements in this set.  The elements are</span></span><br><span class="line"><span class="comment">     * returned in no particular order (unless this set is an instance of some</span></span><br><span class="line"><span class="comment">     * class that provides a guarantee).</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an array containing all of the elements in this set.</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    Object[] toArray();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an array containing all of the elements </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; T[] toArray(T[] a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds the specified element to this set if it is not already present(optional operation).  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the specified element from this set if it is present</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this set contains all of the elements of the</span></span><br><span class="line"><span class="comment">     * specified collection. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds all of the elements in the specified collection to this set if</span></span><br><span class="line"><span class="comment">     * they're not already present (optional operation). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retains only the elements in this set that are contained in the</span></span><br><span class="line"><span class="comment">     * specified collection (optional operation).  In other words, removes</span></span><br><span class="line"><span class="comment">     * from this set all of its elements that are not contained in the</span></span><br><span class="line"><span class="comment">     * specified collection.  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes from this set all of its elements that are contained in the</span></span><br><span class="line"><span class="comment">     * specified collection (optional operation). </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes all of the elements from this set (optional operation).</span></span><br><span class="line"><span class="comment">     * The set will be empty after this call returns.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UnsupportedOperationException if the &lt;tt&gt;clear&lt;/tt&gt; method</span></span><br><span class="line"><span class="comment">     *         is not supported by this set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares the specified object with this set for equality.  Returns</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;true&lt;/tt&gt; if the specified object is also a set, the two sets</span></span><br><span class="line"><span class="comment">     * have the same size, and every member of the specified set is</span></span><br><span class="line"><span class="comment">     * contained in this set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the hash code value for this set.  The hash code of a set is</span></span><br><span class="line"><span class="comment">     * defined to be the sum of the hash codes of the elements in the set,</span></span><br><span class="line"><span class="comment">     * where the hash code of a &lt;tt&gt;null&lt;/tt&gt; element is defined to be zero.</span></span><br><span class="line"><span class="comment">     * This ensures that &lt;tt&gt;s1.equals(s2)&lt;/tt&gt; implies that</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;s1.hashCode()==s2.hashCode()&lt;/tt&gt; for any two sets &lt;tt&gt;s1&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * and &lt;tt&gt;s2&lt;/tt&gt;, as required by the general contract(约定,合同,契约) of</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a &#123;<span class="doctag">@code</span> Spliterator&#125; over the elements in this set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Spliterators.spliterator(<span class="keyword">this</span>, Spliterator.DISTINCT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-set的一个实现类HashSet的实现"><a href="#3-set的一个实现类HashSet的实现" class="headerlink" title="3. set的一个实现类HashSet的实现"></a>3. set的一个实现类HashSet的实现</h4><p>继承结构:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure></p>
<p>HashSet 是 Set 接口的一个<strong>子类</strong>，主要的特点是：里面不能存放重复元素(<strong>元素不能重复</strong>)，<strong>而且采用散列的存储方法，所以没有顺序</strong>。这里所说的没有顺序是指：<strong>元素插入的顺序与输出的顺序不一致</strong>。 使用重写 equals 和 hashcode 来实现自定义的类型的去重。Java 中规定，两个内容相同的对象应该具有相等的 hashcode,但是hashcode相等,不一定是同一个对象</p>
<blockquote>
<p>那么问题来了,set与它的各个实现类是如何实现元素不重复的呢?散列的存储方式又是如何存储的呢?下面让我们通过java源码一探这两位神秘的大哥是如何实现的.</p>
</blockquote>
<p>JDK API中是这样描述的:HashSet实现 Set 接口，<strong>由哈希表（实际上是一个 HashMap 实例）支持</strong>。它不保证 set 的迭代顺序；特别是<strong>它不保证该顺序恒久不变。此类允许使用 null 元素</strong>, HashSet<strong>不是同步的</strong>(<strong>线程不安全</strong>)，需要外部保持线程之间的同步问题。而从HashSet的构造函数也可以看出,它与HashMap的关系不一般,HashSet的构造函数如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment">     * default initial capacity (16) and load factor (0.75).(默认容量为16,加载因子为0.75)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new set containing the elements in the specified</span></span><br><span class="line"><span class="comment">     * collection.  The &lt;tt&gt;HashMap&lt;/tt&gt; is created with default load factor</span></span><br><span class="line"><span class="comment">     * (0.75) and an initial capacity sufficient to contain the elements in</span></span><br><span class="line"><span class="comment">     * the specified collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment">     * the specified initial capacity and the specified load factor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment">     * the specified initial capacity and default load factor (0.75).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty linked hash set.  (This package private</span></span><br><span class="line"><span class="comment">     * constructor is only used by LinkedHashSet.) </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    HashSet(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> dummy) &#123;</span><br><span class="line">        map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>观察可知:HashSet与HashMap果然酷似双胞胎, 其实HashSet底层是通过HashMap实现的, 通过构造函数构造出了一个HashMap
</code></pre><h5 id="3-1-添加元素的实现"><a href="#3-1-添加元素的实现" class="headerlink" title="3-1 添加元素的实现"></a>3-1 添加元素的实现</h5><pre><code>函数add(E e)实现元素的插入
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds the specified element to this set if it is not already present.</span></span><br><span class="line"><span class="comment">     * If this set already contains the element, the call leaves the set</span></span><br><span class="line"><span class="comment">     * unchanged and returns &lt;tt&gt;false&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e element to be added to this set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;tt&gt;true&lt;/tt&gt; if this set did not already contain the specified element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//它的value始终是PRESENT</span></span><br><span class="line">        <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Dummy(傀儡,假的) value to associate with an Object in the backing Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-2-移除元素remove-Object-o-的实现"><a href="#3-2-移除元素remove-Object-o-的实现" class="headerlink" title="3-2 移除元素remove(Object o)的实现"></a>3-2 移除元素remove(Object o)的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> map.remove(o)==PRESENT;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Removes the mapping for the specified key from this map if present.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span>  key key whose mapping is to be removed from the map</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">       Node&lt;K,V&gt; e;</span><br><span class="line">       <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</span><br><span class="line">           <span class="keyword">null</span> : e.value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Implements Map.remove and related methods</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> value the value to match if matchValue, else ignored</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> matchValue if true only remove if value is equal</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> movable if false do not move other nodes while removing</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line">       <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">           (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123; <span class="comment">// 遍历桶位,也就是散列表的数组部分</span></span><br><span class="line">           Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line">           <span class="keyword">if</span> (p.hash == hash &amp;&amp;   ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))  <span class="comment">//找到桶位</span></span><br><span class="line">               node = p;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123; <span class="comment">//桶位后面存在链表节点</span></span><br><span class="line">               <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode) <span class="comment">// 如果是采用红黑数的模式存储</span></span><br><span class="line">                   node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">               <span class="keyword">else</span> &#123; <span class="comment">// 链表结构存储</span></span><br><span class="line">                   <span class="keyword">do</span> &#123;</span><br><span class="line">                       <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                           ((k = e.key) == key ||</span><br><span class="line">                            (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123; <span class="comment">//在链表里面找到元素</span></span><br><span class="line">                           node = e;</span><br><span class="line">                           <span class="keyword">break</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                       p = e;</span><br><span class="line">                   &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                                (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123; <span class="comment">//红黑数存储模式</span></span><br><span class="line">               <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                   ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                   tab[index] = node.next;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                   p.next = node.next;</span><br><span class="line">               ++modCount;</span><br><span class="line">               --size;</span><br><span class="line">               afterNodeRemoval(node);</span><br><span class="line">               <span class="keyword">return</span> node; <span class="comment">//返回移除的节点</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>通过以上分析不难得出HashSet的特点了 : 元素不能重复 , 而且采用散列的存储方法，所以没有顺序。这里所说的没有顺序是指：<strong>元素插入的顺序与输出的顺序不一致</strong>.</p>
<h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五. 总结"></a>五. 总结</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/15/基于java的容器底层原理实现/" data-id="cjoilhtw1001ohwu7rdqmyw2j" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java容器底层实现/">java容器底层实现</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-高性能Java-RPC框架Dubbo与zookeeper的使用-1" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/15/高性能Java-RPC框架Dubbo与zookeeper的使用-1/" class="article-date">
  <time class="post-time" datetime="2018-11-15T12:48:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">15</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/15/高性能Java-RPC框架Dubbo与zookeeper的使用-1/">高性能Java RPC框架Dubbo与zookeeper的使用</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/分布式服务/">分布式服务</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/15/高性能Java-RPC框架Dubbo与zookeeper的使用-1/" class="leancloud_visitors" data-flag-title="高性能Java RPC框架Dubbo与zookeeper的使用">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-什么是RPC"><a href="#一-什么是RPC" class="headerlink" title="一. 什么是RPC"></a>一. 什么是RPC</h2><h4 id="1-RPC-协议-Remote-Procedure-Call-Protocol"><a href="#1-RPC-协议-Remote-Procedure-Call-Protocol" class="headerlink" title="1. RPC  协议(Remote Procedure Call Protocol)"></a>1. RPC  协议(Remote Procedure Call Protocol)</h4><p>远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC 协议假定某些传输协议的存在，如 TCP 或 UDP，为通信程序之间携带信息数据。在 OSI 网络通信模型中，<strong>RPC 跨越了传输层和应用层</strong>。RPC 使得开发包括网络分布式程序在内的应用程序更加容易。<br>RPC 采用<strong>客户机/服务器模式</strong>。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。</p>
<h4 id="2-RPC-框架"><a href="#2-RPC-框架" class="headerlink" title="2. RPC  框架"></a>2. RPC  框架</h4><p>在单机时代一台电脑运行多个进程，进程之间无法通讯，显然这会浪费很多资源，因此后来出现 IPC(Inter-process communication： 单机中运行的进程之间的相互通信 )，这样就能允许<strong>进程之间进行通讯</strong>，比如在一台计算机中的 A 进程写了一个吃饭的方法，那在以前如果在 B 进程中也要有一个吃饭的方法，必须要在 B 进程中进行创建，但有了 RPC 后 B 只需要调用 A 进程的程序即可完成，再到后来网络时代的出现， 大家电脑都连起来，这时可不可以调用其他电脑上的进程呢，当然可以，这样 RPC 框架就出现了。<br>严格意义上来讲：Unix的生态系统中 RPC 可以在同一台电脑上不同进程进行，也可以在不同电脑上进行；而在windows 里面同一台电脑上不同进程间的通讯还可以采用 LPC(本地访问)。综上：RPC 或 LPC是上层建筑，IPC 是底层基础。<br><strong>RPC 框架有很多：比如 Thrift、dubbo、grpc 等。</strong></p>
<h4 id="3-RPC-与-HTTP-、TCP-、UDP-、Socket-的区别"><a href="#3-RPC-与-HTTP-、TCP-、UDP-、Socket-的区别" class="headerlink" title="3. RPC 与 HTTP 、TCP 、UDP 、Socket 的区别"></a>3. RPC 与 HTTP 、TCP 、UDP 、Socket 的区别</h4><p>==<strong>TCP/UDP:</strong>== 都是传输协议，主要区别是 tcp 协议连接需要 <strong>3 次握手，断开需要四次挥手</strong>，是通过<strong>流</strong>来传输的，就是确定连接后，一直发送信息，传完后断开。<strong>udp 不需要进行连接</strong>，直接把信息封装成多个报文，直接发送。所以 udp 的<strong>速度更快</strong>写，但是<strong>不保证数据的完整性</strong>。<br>==<strong>HTTP:</strong>== 超文本传输协议是一种应用层协议，建立在 TCP 协议之上<br>==<strong>Socket：</strong>== 是在应用程序层面上对 TCP/IP 协议的封装和应用。其实是一个调用接口，方便程序员使用 TCP/IP 协议栈而已。程序员通过 socket 来使用 tcp/ip 协议。但是 socket 并不是一定要使用 tcp/ip 协议，Socket 编程接口在设计的时候，就希望也能适应其他的网络协议。<br>==<strong>小结：</strong>== 我们把网络传输类比于一条公路，那 TCP/UDP 就是货车，HTTP 就是货物，而 socket就是发动机。<br>RPC 是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。所以 RPC 的实现可以通过不同的协议去实现比如可以使 http、RMI 等。</p>
<h4 id="4-RPC-的运行流程"><a href="#4-RPC-的运行流程" class="headerlink" title="4. RPC 的运行流程"></a>4. RPC 的运行流程</h4><p><strong>首先，</strong> 要解决通讯的问题，主要是通过在客户端和服务器之间建立 TCP 连接，远程过程调用的所有交换的数据都在这个连接里传输。连接可以是按需连接，调用结束后就断掉，也可以是长连接，多个远程过程调用共享同一个连接。<br><strong>第二，</strong> 要解决寻址的问题，也就是说，A 服务器上的应用怎么告诉底层的 RPC 框架，如何连接到 B 服务器（如主机或 IP 地址）以及特定的端口，方法的名称名称是什么，这样才能完成调用。比如基于Web服务协议栈的RPC，就要提供一个endpoint URI，或者是从UDDI(一种目录服务，通过该目录服务进行服务注册与搜索)服务上查找。如果是 RMI 调用的话，还需要一个 RMI Registry 来注册服务的地址。<br><strong>第三，</strong> 当 A 服务器上的应用发起远程过程调用时，方法的参数需要通过底层的网络协议如 TCP 传递到 B 服务器，由于网络协议是基于二进制的，内存中的参数的值要序列化成二进制的形式，也就是序列化（Serialize）或编组（marshal），通过寻址和传输将序列化的二进制发送给 B 服务器。<br><strong>第四，</strong> B 服务器收到请求后，需要对参数进行反序列化（序列化的逆操作），恢复为内存中的表达方式，然后找到对应的方法（寻址的一部分）进行本地调用，然后得到返回值。<br><strong>第五，</strong> 返回值还要发送回服务器 A 上的应用，也要经过序列化的方式发送，服务器 A 接到后，再反序列化，恢复为内存中的表达方式，交给 A 服务器上的应用<br><img src="https://img-blog.csdnimg.cn/20181106215946155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>JAVAEE 里面的 stub 是为屏蔽客户调用远程主机上的对象，必须提供某种方式来模拟本地对象,这种本地对象称为<strong>存根(stub),</strong> 存根负责接收本地方法调用,并将它们委派给各自的具体实现对象<br><strong>Skeleton：服务器的骨架</strong></p>
<h4 id="5-RPC-基于RMI的简单实现"><a href="#5-RPC-基于RMI的简单实现" class="headerlink" title="5. RPC  基于RMI的简单实现"></a>5. RPC  基于RMI的简单实现</h4><h5 id="5-1-首先建一个多模块的maven项目-结构如下"><a href="#5-1-首先建一个多模块的maven项目-结构如下" class="headerlink" title="5-1 首先建一个多模块的maven项目, 结构如下:"></a>5-1 首先建一个多模块的maven项目, 结构如下:</h5><p><img src="https://img-blog.csdnimg.cn/20181106220424377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="父工程包含三个子模块"></p>
<h5 id="5-2-rpc-rmi-api模块实现-就是提供调用的接口-结构图如下"><a href="#5-2-rpc-rmi-api模块实现-就是提供调用的接口-结构图如下" class="headerlink" title="5-2 rpc_rmi_api模块实现, 就是提供调用的接口, 结构图如下:"></a>5-2 rpc_rmi_api模块实现, 就是提供调用的接口, 结构图如下:</h5><p><img src="https://img-blog.csdnimg.cn/20181106220723297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="User类-必须实现序列化接口"><a href="#User类-必须实现序列化接口" class="headerlink" title="User类:(必须实现序列化接口)"></a>User类:(必须实现序列化接口)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6290816946970912418L</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String userPwd;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String userName, String userPwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.userPwd = userPwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", userName='"</span> + userName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", userPwd='"</span> + userPwd + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userPwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserPwd</span><span class="params">(String userPwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userPwd = userPwd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="UserService接口-相关规定看注释"><a href="#UserService接口-相关规定看注释" class="headerlink" title="UserService接口:(相关规定看注释)"></a>UserService接口:(相关规定看注释)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123; <span class="comment">//规定继承Remote父类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserById</span><span class="params">(Integer userId)</span> <span class="keyword">throws</span> RemoteException</span>; <span class="comment">//规定抛出异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-3-rpc-rmi-provider的模块实现-结构图如下-主要提供服务"><a href="#5-3-rpc-rmi-provider的模块实现-结构图如下-主要提供服务" class="headerlink" title="5-3 rpc_rmi_provider的模块实现,结构图如下:(主要提供服务)"></a>5-3 rpc_rmi_provider的模块实现,结构图如下:(主要提供服务)</h5><p><img src="https://img-blog.csdnimg.cn/20181106221311682.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="UserServiceImp类实现-要继承UnicastRemoteObject-类-规定的"><a href="#UserServiceImp类实现-要继承UnicastRemoteObject-类-规定的" class="headerlink" title="UserServiceImp类实现: (要继承UnicastRemoteObject 类,规定的)"></a>UserServiceImp类实现: (要继承UnicastRemoteObject 类,规定的)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImp</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, User&gt; users = <span class="keyword">new</span> HashMap&lt;Integer, User&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImp</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>&#123;</span><br><span class="line"></span><br><span class="line">        users.put(<span class="number">1</span>,<span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"admin"</span>,<span class="string">"123456"</span>));</span><br><span class="line">        users.put(<span class="number">2</span>,<span class="keyword">new</span> User(<span class="number">2</span>,<span class="string">"shsxt"</span>,<span class="string">"123456"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserById</span><span class="params">(Integer userId)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Publisher类的实现-发布服务端"><a href="#Publisher类的实现-发布服务端" class="headerlink" title="Publisher类的实现:(发布服务端)"></a>Publisher类的实现:(发布服务端)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, AlreadyBoundException, MalformedURLException </span>&#123;</span><br><span class="line">        <span class="comment">//指定服务端口</span></span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">8989</span>);</span><br><span class="line">        <span class="comment">//发布服务</span></span><br><span class="line">        Naming.bind(<span class="string">"rmi://192.168.1.158:8989/userService"</span>, <span class="keyword">new</span> UserServiceImp());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"成功发布服务!!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-4-rpc-rmi-consumer结构图如下-客户端的调用"><a href="#5-4-rpc-rmi-consumer结构图如下-客户端的调用" class="headerlink" title="5-4 rpc_rmi_consumer结构图如下:(客户端的调用)"></a>5-4 rpc_rmi_consumer结构图如下:(客户端的调用)</h5><p><img src="https://img-blog.csdnimg.cn/20181106221854691.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="App-类的实现-调用服务端"><a href="#App-类的实现-调用服务端" class="headerlink" title="App 类的实现:(调用服务端)"></a>App 类的实现:(调用服务端)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> RemoteException, NotBoundException, MalformedURLException </span>&#123;</span><br><span class="line">        UserService userService = (UserService) Naming.lookup(<span class="string">"rmi://192.168.1.158:8989/userService"</span>);</span><br><span class="line">        System.out.println(userService.queryUserById(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>结果:</strong><br><img src="https://img-blog.csdnimg.cn/20181106223301935.png" alt="在这里插入图片描述"></p>
<h2 id="二-Dubbo框架"><a href="#二-Dubbo框架" class="headerlink" title="二. Dubbo框架"></a>二. Dubbo框架</h2><h4 id="1-框架基本概念"><a href="#1-框架基本概念" class="headerlink" title="1. 框架基本概念"></a>1. 框架基本概念</h4><p><strong>官网: <a href="http://dubbo.apache.org/en-us/" target="_blank" rel="noopener">http://dubbo.apache.org/en-us/</a></strong><br><strong>A high performance Java RPC framework —-一个高效的远程调用框架</strong><br><img src="https://img-blog.csdnimg.cn/20181106222414120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Dubbo 是由阿里巴巴开源的一个高性能、基于 Java 开源的远程调用框架。正如在许多RPC 系统中一样，dubbo 是基于定义服务的概念，指定可以通过参数和返回类型远程调用的方法。在服务器端，服务器实现这个接口，并运行一个 dubbo 服务器来处理客户端调用。在客户端，客户机有一个存根，它提供与服务器相同的方法。<br>==<strong>dubbo的架构图:</strong>==<br><img src="https://img-blog.csdnimg.cn/20181106222954442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Dubbo 提供三个核心功能：基于接口的远程调用、容错和负载均衡，以及服务的自动注<br>册与发现。Dubbo 框架广泛的在阿里巴巴内部使用，以及京东、当当、去哪儿、考拉等都在<br>使用。</p>
<h4 id="2-Dubbo快速入门"><a href="#2-Dubbo快速入门" class="headerlink" title="2. Dubbo快速入门"></a>2. Dubbo快速入门</h4><p>这里也是从实战出发,搭建一个简单的远程调用小实例,  首先也是要创建一个maven的多模块项目, 结果图如下:<br><img src="https://img-blog.csdnimg.cn/20181106223633447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>下面来一个模块一个模块的列出来:</p>
<h5 id="2-1-dubbo-api-模块的结构图如下-也是提供方法调用接口"><a href="#2-1-dubbo-api-模块的结构图如下-也是提供方法调用接口" class="headerlink" title="2-1 dubbo_api 模块的结构图如下:(也是提供方法调用接口)"></a>2-1 dubbo_api 模块的结构图如下:(也是提供方法调用接口)</h5><p><img src="https://img-blog.csdnimg.cn/20181106224027575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>大家不用像我建的那么深,我的错误; 里面的User与UserService与上面的rmi一样;</p>
<h5 id="2-2-dubbo-provider的结构图如下"><a href="#2-2-dubbo-provider的结构图如下" class="headerlink" title="2-2 dubbo_provider的结构图如下:"></a>2-2 dubbo_provider的结构图如下:</h5><p><img src="https://img-blog.csdnimg.cn/20181106224434651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="UserServiceImp类的实现-与上面不一样的是不用继承那个鬼类啦"><a href="#UserServiceImp类的实现-与上面不一样的是不用继承那个鬼类啦" class="headerlink" title="UserServiceImp类的实现:(与上面不一样的是不用继承那个鬼类啦!)"></a>UserServiceImp类的实现:(与上面不一样的是不用继承那个鬼类啦!)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImp</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, User&gt; users = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        users.put(<span class="number">1</span>,<span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"admin"</span>,<span class="string">"123456"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserById</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Publisher类的实现-与上面完全不同"><a href="#Publisher类的实现-与上面完全不同" class="headerlink" title="Publisher类的实现,与上面完全不同:"></a>Publisher类的实现,与上面完全不同:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"provider.xml"</span>);</span><br><span class="line">        context.start();</span><br><span class="line">        System.out.println(<span class="string">"服务发布成功!!!"</span>);</span><br><span class="line">        System.in.read(); <span class="comment">//按任意键退出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="配置文件provider-xml的实现"><a href="#配置文件provider-xml的实现" class="headerlink" title="配置文件provider.xml的实现"></a>配置文件provider.xml的实现</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns:dubbo=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span><br><span class="line">       xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://code.alibabatech.com/schema/dubbo</span></span><br><span class="line"><span class="string">       http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">"com.shsxt.provider"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">        dubbo 环境配置</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--应用名称--&gt;</span><br><span class="line">    &lt;dubbo:application name="dubbo_provider"&gt;&lt;/dubbo:application&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--注册中心配置:广播地址--&gt;</span><br><span class="line">    &lt;dubbo:registry address="multicast://224.5.6.7:1234"&gt;&lt;/dubbo:registry&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定公布的服务使用的协议与端口号--&gt;</span><br><span class="line">    &lt;dubbo:protocol name="dubbo" port="20880"&gt;&lt;/dubbo:protocol&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置公布的服务--&gt;</span><br><span class="line">    &lt;dubbo:service interface="com.shsxt.api.service.UserService" ref="userServiceImp"&gt;&lt;/dubbo:service&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-dubbo-consumer-模块买的实现-结构图如下"><a href="#2-3-dubbo-consumer-模块买的实现-结构图如下" class="headerlink" title="2-3 dubbo_consumer 模块买的实现, 结构图如下:"></a>2-3 dubbo_consumer 模块买的实现, 结构图如下:</h5><p><img src="https://img-blog.csdnimg.cn/20181106225118199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="UserController类的实现"><a href="#UserController类的实现" class="headerlink" title="UserController类的实现"></a>UserController类的实现</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserById</span><span class="params">(Integer userId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.queryUserById(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="App类的实现"><a href="#App类的实现" class="headerlink" title="App类的实现"></a>App类的实现</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"consumer.xml"</span>);</span><br><span class="line">        UserController userController = (UserController) context.getBean(<span class="string">"userController"</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(userController.queryUserById(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="配置文件consumer-xml的代码-注意与provider-xml比较一下区别"><a href="#配置文件consumer-xml的代码-注意与provider-xml比较一下区别" class="headerlink" title="配置文件consumer.xml的代码(注意与provider.xml比较一下区别)"></a>配置文件consumer.xml的代码(注意与provider.xml比较一下区别)</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns:dubbo=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span><br><span class="line">       xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://code.alibabatech.com/schema/dubbo</span></span><br><span class="line"><span class="string">       http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">"com.shsxt.consumer"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">       dubbo 环境配置</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置应用名称--&gt;</span><br><span class="line">    &lt;dubbo:application name="dubbo_consumer"&gt;&lt;/dubbo:application&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定注册中心--&gt;</span><br><span class="line">   &lt;dubbo:registry address="multicast://224.5.6.7:1234"&gt;&lt;/dubbo:registry&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!--配置订阅的服务列表--&gt;</span><br><span class="line">    &lt;dubbo:reference id="userService" interface="com.shsxt.api.service.UserService"&gt;&lt;/dubbo:reference&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-最后在主项目的pom-xml中加入下面依赖-主项目中有单元测试-其他三个子模块的单元测试可以删除掉"><a href="#2-4-最后在主项目的pom-xml中加入下面依赖-主项目中有单元测试-其他三个子模块的单元测试可以删除掉" class="headerlink" title="2-4 最后在主项目的pom.xml中加入下面依赖:(主项目中有单元测试,其他三个子模块的单元测试可以删除掉)"></a>2-4 最后在主项目的pom.xml中加入下面依赖:(主项目中有单元测试,其他三个子模块的单元测试可以删除掉)</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">           &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!--引入dubbo依赖--&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;2.5.6&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<h2 id="三-几种重要配置的介绍"><a href="#三-几种重要配置的介绍" class="headerlink" title="三. 几种重要配置的介绍"></a>三. 几种重要配置的介绍</h2><h4 id="1-dubbo-application"><a href="#1-dubbo-application" class="headerlink" title="1. dubbo:application"></a>1. dubbo:application</h4><p><strong>应⽤信息配置。对应的配置类:com.alibaba.dubbo.config.ApplicationConfig</strong>,下面是官网的大致配置介绍,详细介绍直接去官网查看: <a href="http://dubbo.apache.org/en-us/docs/user/references/xml/dubbo-service.html" target="_blank" rel="noopener">http://dubbo.apache.org/en-us/docs/user/references/xml/dubbo-service.html</a><br><img src="https://img-blog.csdnimg.cn/20181107111020807.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	标签					目的										介绍</span><br><span class="line">dubbo:service	     服务出口	  		 用于导出服务，定义服务元数据，使用多个协议导出服务，向多个注册表注册服务</span><br><span class="line">dubbo:reference	 	 服务参考	 		 用于创建远程代理，订阅多个注册表</span><br><span class="line">dubbo:protocol	     协议配置	  		 在供应商方面配置服务协议，消费者方面如下。</span><br><span class="line">dubbo:application	 应用程序配置	 		 适用于提供者和消费者。</span><br><span class="line">dubbo:module	     模块配置    	  	 可选的。</span><br><span class="line">dubbo:registry		 注册中心			 注册表信息：地址，协议等</span><br><span class="line">dubbo:monitor		 监控中心			 监控信息：地址，地址等。可选。</span><br><span class="line">dubbo:provider		 提供商的默认配置		 ServiceConfigs的默认配置。可选的。</span><br><span class="line">dubbo:consumer	 	 消费者的默认配置	 	 ReferenceConfigs的默认配置。可选的。</span><br><span class="line">dubbo:method		 方法级别配置			 ServiceConfig和ReferenceConfig的方法级别配置。</span><br><span class="line">dubbo:argument	 	 参数配置			 用于指定方法参数配置。</span><br></pre></td></tr></table></figure></p>
<h4 id="2-dubbo-registry"><a href="#2-dubbo-registry" class="headerlink" title="2. dubbo:registry"></a>2. dubbo:registry</h4><p>注册中⼼配置。对应的配置类： com.alibaba.dubbo.config.RegistryConfig。同时如果有多个不 同的注册 中⼼, 可以声 明多个 <a href="dubbo:registry" target="_blank" rel="noopener">dubbo:registry</a> 标签 ,并在 <a href="dubbo:service" target="_blank" rel="noopener">dubbo:service</a> 或<a href="dubbo:reference" target="_blank" rel="noopener">dubbo:reference</a> 的 registry 属性指定使⽤的注册⼼。</p>
<h4 id="3-dubbo-protocol"><a href="#3-dubbo-protocol" class="headerlink" title="3. dubbo:protocol"></a>3. dubbo:protocol</h4><p>服务提供者协议配置。对应的配置类:com.alibaba.dubbo.config.ProtocolConfig,同时， 如果需要⽀持多协议， 可以声明多个 <a href="dubbo:protocol" target="_blank" rel="noopener">dubbo:protocol</a> 标签， 并在 <a href="dubbo:service" target="_blank" rel="noopener">dubbo:service</a> 中通过protocol 属性指定使⽤的协议</p>
<h4 id="4-dubbo-service"><a href="#4-dubbo-service" class="headerlink" title="4. dubbo:service"></a>4. dubbo:service</h4><p>服务提供者暴露服务配置。对应的配置类:com.alibaba.dubbo.config.ServiceConfig</p>
<h4 id="5-dubbo-reference"><a href="#5-dubbo-reference" class="headerlink" title="5. dubbo:reference"></a>5. dubbo:reference</h4><p>服务消费者引⽤服务配置。对应的配置类： com.alibaba.dubbo.config.ReferenceConfig</p>
<h2 id="四-zookeeper安装与注册中心配置"><a href="#四-zookeeper安装与注册中心配置" class="headerlink" title="四. zookeeper安装与注册中心配置"></a>四. zookeeper安装与注册中心配置</h2><p><img src="https://img-blog.csdnimg.cn/20181107112547214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>上面为zookeeper的主要工作结构图</p>
<h5 id="流程说明"><a href="#流程说明" class="headerlink" title="流程说明:"></a>流程说明:</h5><ul>
<li>服务提供者启动时: 向/dubbo/com.foo.BarService/providers 目录下写入自己的 URL 地址</li>
<li>服务消费者启动时: 订阅  /dubbo/com.foo.BarService/providers 目录下的提供者 URL 地址。并向 /dubbo/com.foo.BarService/consumers 目录下写入自己的URL 地址</li>
<li>监控中心启动时: 订阅  /dubbo/com.foo.BarService 目录下的所有提供者和消费者 URL 地址。<h5 id="支持以下功能："><a href="#支持以下功能：" class="headerlink" title="支持以下功能："></a>支持以下功能：</h5></li>
<li>当提供者出现断电等异常停机时，注册中心能自动删除提供者信息</li>
<li>当注册中心重启时，能自动恢复注册数据，以及订阅请求</li>
<li>当会话过期时，能自动恢复注册数据，以及订阅请求</li>
<li>当设置  &lt;dubbo:registry check=”false” /&gt; 时，记录失败注册和订阅请求，后台定时重试</li>
<li>可 通 过  &lt;dubbo:registry username=”admin” password=”1234” /&gt; 设 置zookeeper 登录信息</li>
<li>可通过  &lt;dubbo:registry group=”dubbo” /&gt; 设置 zookeeper 的根节点，不设置将使用无根树</li>
<li><p>支持  <em> 号通配符  &lt;dubbo:reference group=”</em>“ version=”*” /&gt; ，可订阅服务的所有分组和所有版本的提供者</p>
<h4 id="1-zookeeper的下载及安装-linux环境"><a href="#1-zookeeper的下载及安装-linux环境" class="headerlink" title="1. zookeeper的下载及安装(linux环境)"></a>1. zookeeper的下载及安装(linux环境)</h4><p>为啥是linux呢? 简单+不卡啊!</p>
<h5 id="1-1-下载"><a href="#1-1-下载" class="headerlink" title="1-1 下载"></a>1-1 下载</h5><p> 在你认为合适的位置建一个文件夹: mkdir + 文件夹名<br> 进入该目录进行下载操作:  wget  <a href="http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz" target="_blank" rel="noopener">http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz</a></p>
<h5 id="1-2-解压"><a href="#1-2-解压" class="headerlink" title="1-2 解压"></a>1-2 解压</h5><p> tar  -zvxf  + 你要解压的压缩包<br>解压完成后的目录结构<br><img src="https://img-blog.csdnimg.cn/20181107123401447.png" alt="在这里插入图片描述"></p>
<h5 id="1-3-启动前的热身运动"><a href="#1-3-启动前的热身运动" class="headerlink" title="1-3 启动前的热身运动"></a>1-3 启动前的热身运动</h5><p>如果你直接去bin目录启动zookeeper服务器的话会报错, 错误为:不能在conf中找到zoo.cfg这个配置文件, 因为一开始conf里面只有一个zoo_sample_cfg , 所以我们先在conf目录下赋值一份, 名为zoo.cfg</p>
<p> cp  zoo_sample_cfg  zoo.cfg<br><img src="https://img-blog.csdnimg.cn/20181107123754299.png" alt="在这里插入图片描述"></p>
<p> 用vim命令打开zoo.cfg文件,  vim zoo.cfg  内容如下:<br><img src="https://img-blog.csdnimg.cn/20181107123945404.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>每个配置对应的解释详细也能看懂,就不介绍了,可以不用改就可以跑去bin目录下启动啦!</p>
<h5 id="1-4-正式启动-bin目录下"><a href="#1-4-正式启动-bin目录下" class="headerlink" title="1-4 正式启动(bin目录下)"></a>1-4 正式启动(bin目录下)</h5><p>  ./zkServer.sh start  (注意是要加start的) 启动服务端<br> ./zkCli.sh  为启动客户端</p>
<h4 id="2-对应的java配置"><a href="#2-对应的java配置" class="headerlink" title="2. 对应的java配置"></a>2. 对应的java配置</h4><h5 id="2-1-在-provider和consumer-中增加-zookeeper-客户端-jar-包依赖："><a href="#2-1-在-provider和consumer-中增加-zookeeper-客户端-jar-包依赖：" class="headerlink" title="2-1 在 provider和consumer 中增加 zookeeper 客户端 jar 包依赖："></a>2-1 在 provider和consumer 中增加 zookeeper 客户端 jar 包依赖：</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--zookeeper配置--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--zkclient客户端--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.github.sgroschupf&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;zkclient&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>上面使用了zkclient客户端连接,除了这个还可以使用curator客户端连接, 相应的依赖为:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.netflix.curator&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.1.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-Zookeeper-单机配置"><a href="#2-2-Zookeeper-单机配置" class="headerlink" title="2-2 Zookeeper 单机配置"></a>2-2 Zookeeper 单机配置</h5><p>就是改对应的provider与consumer模块的xml配置即可<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address=<span class="string">"zookeeper://10.20.153.10:2181"</span> /&gt;</span><br><span class="line">&lt;dubbo:registry protocol=<span class="string">"zookeeper"</span> address=<span class="string">"10.20.153.10:2181"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="2-3-Zookeeper-集群配置"><a href="#2-3-Zookeeper-集群配置" class="headerlink" title="2-3 Zookeeper  集群配置"></a>2-3 Zookeeper  集群配置</h5><p>不同的ip用逗号隔开<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address=<span class="string">"zookeeper://10.20.153.10:2181?backup=10.20.153.11:2181,10.20.153.12:2181"</span> /&gt;</span><br><span class="line">&lt;dubbo:registry protocol=<span class="string">"zookeeper"</span> address=<span class="string">"10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="2-4-同一-Zookeeper分成多组注册中心"><a href="#2-4-同一-Zookeeper分成多组注册中心" class="headerlink" title="2-4 同一 Zookeeper分成多组注册中心"></a>2-4 同一 Zookeeper分成多组注册中心</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry id=<span class="string">"chinaRegistry"</span> protocol=<span class="string">"zookeeper"</span> address=<span class="string">"10.20.153.10:2181"</span> group=<span class="string">"china"</span> /&gt;</span><br><span class="line">&lt;dubbo:registry id=<span class="string">"intlRegistry"</span> protocol=<span class="string">"zookeeper"</span> address=<span class="string">"10.20.153.10:2181"</span> group=<span class="string">"intl"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>我们上面的为单机版的就行,然后启动java里面的服务端与客户程序的代码就行了, 因为zookeeper管理dubbo为树形结构,使用可以查看注册中心的服务情况, 如下用ls 命令查看就行, 查看根节点为: </p>
<pre><code>ls /dubbo  (记得前面加/) 想查看哪一级的进哪一级查看就行
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181107132024548.png" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/15/高性能Java-RPC框架Dubbo与zookeeper的使用-1/" data-id="cjoilhttu000thwu7w395cdze" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dubbo/">dubbo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis基本概念与操作" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/15/redis基本概念与操作/" class="article-date">
  <time class="post-time" datetime="2018-11-15T12:47:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">15</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/15/redis基本概念与操作/">redis基本概念与操作</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/15/redis基本概念与操作/" class="leancloud_visitors" data-flag-title="redis基本概念与操作">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Redis入门"><a href="#一-Redis入门" class="headerlink" title="一.Redis入门"></a>一.Redis入门</h2><h6 id="中文官网：-http-www-redis-cn"><a href="#中文官网：-http-www-redis-cn" class="headerlink" title="中文官网： http://www.redis.cn/"></a>中文官网： <a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></h6><h4 id="1-什么是Redis呢"><a href="#1-什么是Redis呢" class="headerlink" title="1. 什么是Redis呢?"></a>1. 什么是Redis呢?</h4><p>Redis 是一个开源软件拥有（ Berkly Software Distribution 许可 ），它是一个 内存数据结构存贮，通常被用于 数据库 ， 缓存 ， 消息代理。 。 它支持： 字符串 ， 哈希 ， 列表 ， 集合 ， 数组集合 ， 位图 ， 高压缩算法以及地图索引等数据结构。Redis 支持集群，lua 脚本，以及  LRU（近期最少使用 Least Recently Used ）淘汰算法，事物以及不同级别的 磁盘持久化，能够提供一个高可用的 Redis Sentinel 的集群方案。<br>==从这段简介中我们应该掌握一下几点：==</p>
<ol>
<li>Redis 是把数据存放在内存当中，所以它的运行速度会非常快</li>
<li>Redis 具有多种数据存储结构  </li>
<li>Redis  具有持久化的功能Redis  具有持久化的功能</li>
<li>Redis 上的数据可以设置过期</li>
<li>Redis 支持集群，而且可以自动切换</li>
<li>跨平台 支持多种语言客户端</li>
</ol>
<p>==Redis 用途：==</p>
<p>缓存（StackOverFlow），数据库(微博)，消息中间件（队列，微博）, 短信验证等等</p>
<h4 id="2-Redis的安装"><a href="#2-Redis的安装" class="headerlink" title="2. Redis的安装"></a>2. Redis的安装</h4><p>安装官网参考网址：<a href="http://www.redis.cn/download.html" target="_blank" rel="noopener">http://www.redis.cn/download.html</a><br>安装平台：centos6.7</p>
<h5 id="2-1-下载并解压"><a href="#2-1-下载并解压" class="headerlink" title="2-1 下载并解压"></a>2-1 下载并解压</h5><pre><code>通过 xshell 建立连接，下载 redis 并执行解压
通过 wget 命令 下载网络上对应节点资源
wget  http://download.redis.io/releases/redis-3.2.8.tar.gz
tar  zvxf  redis-3.2.8.tar.gz
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181103152513738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103152531546.png" alt="在这里插入图片描述"></p>
<h5 id="2-2-解压后执行编译与安装"><a href="#2-2-解压后执行编译与安装" class="headerlink" title="2-2 解压后执行编译与安装"></a>2-2 解压后执行编译与安装</h5><p>注意：执行  make  命令前 果 如果 s centos  没有 c gcc  环境在编译与安装期间会出错原因是没有  gcc  环境造成！过 安装通过 m yum  安装  Gcc</p>
<pre><code>yum install gcc
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181103152817118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103152830491.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/2018110315283825.png" alt="在这里插入图片描述"></p>
<h5 id="2-3-删除原始解压文件-重新解压文件-并进入加压后文件夹下执行安装"><a href="#2-3-删除原始解压文件-重新解压文件-并进入加压后文件夹下执行安装" class="headerlink" title="2-3 删除原始解压文件 重新解压文件 并进入加压后文件夹下执行安装"></a>2-3 删除原始解压文件 重新解压文件 并进入加压后文件夹下执行安装</h5><p><img src="https://img-blog.csdnimg.cn/20181103152907411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103152928140.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103152938787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="2-4-启动redis服务"><a href="#2-4-启动redis服务" class="headerlink" title="2-4 启动redis服务"></a>2-4 启动redis服务</h5><p>当 redis 文件被成功编译并安装后，执行 redis 服务启动，对于 redis 服务启动有两种方式    </p>
<ul>
<li>==方式一:当前操作窗口启动==（ 此时启动之后当前窗口无法再继续其他操作 !!!）<br><img src="https://img-blog.csdnimg.cn/20181103153118977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>==方式二:以后台进程方式启动==<br>以后台进程方式启动 redis ,此时需要修改 redis.conf 配置文件中 daemonize 默认属性 no 修改为 yes 通过 vim 命令打开 redis3.2.8 文件夹下 redis.conf 文件<br>==vim redis.conf==<br><img src="https://img-blog.csdnimg.cn/20181103153133653.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103153140205.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>==修改后保存并退出,  后台启动 redis 服务==<br><img src="https://img-blog.csdnimg.cn/20181103153232726.png" alt="在这里插入图片描述"><br>通过 linux 客户端连接 redis 服务<br>在 src 目录执行命令 ./redis-cli  连接 redis 服务器<br><img src="https://img-blog.csdnimg.cn/20181103153244307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>至此，redis 环境搭建成功，并可以通过 redis 客户端命令行操作 redis 服务器啦！！！<h4 id="3-key相关指令介绍"><a href="#3-key相关指令介绍" class="headerlink" title="3.key相关指令介绍"></a>3.key相关指令介绍</h4>==<strong>exists key</strong>==  检测指定 key 是否存在，返回 1 表示存在， 0 不存在<br>==<strong>del key1 key2 …… keyN</strong>==  删除给定 key,返回删除 key 的数目， 0 表示给定 key 都不存在<br>==<strong>type key</strong>==  返回给定 key 值的类型。 返回 none 表示 key 不存在,string 字符类型， list 链表类型 set 无序集合类型……<br>==<strong>keys pattern</strong>==  返回匹配指定模式的所有 key<br>==<strong>randomkey</strong>== 返回从当前数据库中随机选择的一个 key,如果当前数据库是空的，返回空串<br>==<strong>rename oldkey newkey</strong>== 重命名一个 key,如果 newkey 存在，将会被覆盖，返回1 表示成功，0 失败。可能是 oldkey 不存在或者和 newkey 相同。<br>==<strong>renamenx oldkey newkey</strong>== 同上，但是如果 newkey 存在返回失败。<br>==<strong>expire key seconds</strong>== 为 key 指定过期时间， 单位是秒。 返回 1 成功， 0 表示key 已经设置过过期时间或者不存在。<br>==<strong>ttl key</strong>== 返回设置过过期时间 key 的剩余过期秒数。 -1 表示 key 不存在或者未设置过期时间。<br>==<strong>select db-index</strong>== 通过索引选择数据库， 默认连接的数据库是 0,默认数据库数是16 个。 返回 1表示成功， 0 失败。<br>==<strong>move key db-index</strong>== 将 key 从当前数据库移动到指定数据库。返回 1 表示成功。0 表示 key不存在或者已经在指定数据库中。<br><img src="https://img-blog.csdnimg.cn/20181103153338721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103153347150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h2 id="二-Redis的五种基本数据类型-重要"><a href="#二-Redis的五种基本数据类型-重要" class="headerlink" title="二.Redis的五种基本数据类型(重要)"></a>二.Redis的五种基本数据类型(重要)</h2><h5 id="redis-提供五种数据类型：-string-hash-list-set-及sorted-set"><a href="#redis-提供五种数据类型：-string-hash-list-set-及sorted-set" class="headerlink" title="==redis 提供五种数据类型： string,hash,list,set 及sorted set=="></a>==redis 提供五种数据类型： string,hash,list,set 及sorted set==</h5><h4 id="1-String-类型"><a href="#1-String-类型" class="headerlink" title="1. String 类型"></a>1. String 类型</h4><h5 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1-1 概述"></a>1-1 概述</h5>string 是最基本的类型，而且 string 类型是二进制安全的。意思是 redis 的string 可以包含任何数据。比如 jpg 图片或者序列化的对象。从内部实现来看其实string 可以看作 byte 组，最大上限是 1G 字节。1G=1024MB<h5 id="1-2-基本操作指令"><a href="#1-2-基本操作指令" class="headerlink" title="1-2 基本操作指令"></a>1-2 基本操作指令</h5></li>
<li><strong>set key value</strong> 设置 key 对应 string 类型的值， 返回 1 表示成功， 0 失败。</li>
<li><strong>setnx key value</strong> 如果 key 不存在， 设置 key 对应 string 类型的值。 如果key 已经存在，返回 0。</li>
<li><strong>get key</strong> 获取 key 对应的 string 值,如果 key 不存在返回 nil</li>
<li><strong>getset key value</strong> 先获取 key 的值，再设置 key 的值。如果 key 不存在返回 nil。</li>
<li><strong>mget key1 key2 ……keyN</strong> 一次获取多个 key 的值，如果对应 key 不存在，则对应返回 nil。</li>
<li><strong>mset key1 value1 ……keyN valueN</strong> 一次设置多个 key 的值，成功返回 1表示所有的值都设置了，失败返回 0 表示没有任何值被设置。</li>
<li><strong>msetnx key1 value1 ……keyN valueN</strong> 一次设置多个 key 的值，但是不会覆盖已经存在的 key</li>
<li><strong>incr key</strong> 对 key 的值做++操作， 并返回新的值。 注意 incr 一个不是 int 的value 会返回错误， incr 一个不存在的 key，则设置 key 值为 1。</li>
<li><strong>decr key</strong> 对 key 的值做–操作， decr 一个不存在 key，则设置 key 值为-1。</li>
<li><strong>incrby key integer</strong> 对 key 加上指定值 ， key 不存在时候会设置 key，并认为原来的 value 是 0。</li>
<li><strong>decrby key integer</strong> 对 key 减去指定值。decrby 完全是为了可读性，我们完全可以通过 incrby 一个负值来实现同样效果，反之一样<h5 id="1-3应用场景"><a href="#1-3应用场景" class="headerlink" title="1-3应用场景"></a>1-3应用场景</h5>String 是最常用的一种数据类型，普通的 key/value 存储都可以归为此类，value 其实不仅是 String,也可以是数字：比如想知道什么时候封锁一个 IP 地址(访问超过几次)。INCRBY 命令让这些变得很容易，通过原子递增保持计数。等等…..<h4 id="2-Hash-类型"><a href="#2-Hash-类型" class="headerlink" title="2. Hash 类型"></a>2. Hash 类型</h4><h5 id="2-1-Hash的基本指令操作"><a href="#2-1-Hash的基本指令操作" class="headerlink" title="2-1 Hash的基本指令操作"></a>2-1 Hash的基本指令操作</h5></li>
<li><strong>hset key field value</strong> 设置 hash field 为指定值，如果 key 不存在，则创建</li>
<li><strong>hget key field</strong> 获取指定的 hash field。</li>
<li><strong>hmget key filed1….fieldN</strong> 获取全部指定的 hash filed。</li>
<li><strong>hmset key filed1 value1 ……filedN valueN</strong> 同时设置hash的多个 field。</li>
<li><strong>hincrby key field integer</strong> 将指定的 hash filed 加上指定值。成功返回 hashfiled 变更后的值。</li>
<li><strong>hexists key field</strong> 检测指定 field 是否存在。</li>
<li><strong>hdel key field</strong> 删除指定的 hash field。</li>
<li><strong>hlen key</strong> 返回指定 hash 的 field 数量</li>
<li><strong>hkeys key</strong> 返回 hash 的所有 field。</li>
<li><strong>hvals key</strong> 返回 hash 的所有 value。</li>
<li><strong>hgetall  key</strong> 返回 hash 的所有 filed 和 value。<br><img src="https://img-blog.csdnimg.cn/20181105102739855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181105102749988.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h5 id="2-2-应用场景"><a href="#2-2-应用场景" class="headerlink" title="2-2 应用场景"></a>2-2 应用场景</h5>我们简单举个实例来描述下 Hash 的应用场景，比如我们要存储一个用户信息对象数据，包<br>含以下信息：</li>
<li><p>用户 ID，为查找的 key，存储的 value 用户对象包含姓名 name，年龄 age，生日 birthday 等信息，如果用普通的 key/value 结构来存储，主要有以下 2 种存储方式：</p>
<ul>
<li><p>==第一种方式==将用户ID作为查找key,把其他信息封装成一个对象以序列化的方式存储，<br>如：set u001 “李三,18,20010101”<br>这种方式的缺点是，增加了序列化/反序列化的开销，并且在需要修改其中一项信息时，需要把整个对象取回，并且修改操作需要对并发进行保护，引入 CAS 等复杂问题。</p>
<ul>
<li><p>==第二种方法==是这个用户信息对象有多少成员就存成多少个 key-value 对儿，用用户 ID+对应属性的名称作为唯一标识来取得对应属性的值，如：</p>
<p>mset user:001:name “李三” user:001:age 18<br>user:001:birthday “20010101”</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>虽然省去了序列化开销和并发问题，但是用户 ID 为重复存储，如果存在大量这样的数据，内存浪费还是非常可观的。那么 Redis 提供的 Hash 很好的解决了这个问题，Redis 的 Hash 实际是内部存储的Value 为一个 HashMap，并提供了直接存取这个 Map 成员的接口，    如：</p>
<pre><code>hmset user:001 name &quot;李三&quot; age 18 birthday &quot;20010101&quot;
</code></pre><p>也就是说，Key 仍然是用户 ID,value 是一个 Map，这个 Map 的 key 是成员的属性名，value 是属性值，这样对数据的修改和存取都可以直接通过其内部 Map 的 Key(Redis 里称内部 Map 的 key 为 field), 也就是通过key(用户 ID) + field(属性标签) 操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题。很好的解决了问题。这里同时需要注意，Redis 提供了接口(hgetall)可以直接取到全部的属性数据,但是如果内部 Map 的成员很多，那么涉及到遍历整个内部 Map 的操作，由于 Redis 单线程模型的缘故，这个遍历操作可能会比较耗时，而另其它客户端的请求完全不响应，这点需要格外注意。</p>
</li>
<li>实现方式：上面已经说到 Redis Hash 对应 Value 内部实际就是一个 HashMap，实际这里会有2 种不同实现，这个 Hash 的成员比较少时 Redis 为了节省内存会采用类似一维数组的方式来紧凑存储，而不会采用真正的 HashMap 结构，对应的 value redisObject 的encoding 为 zipmap,当成员数量增大时会自动转成真正的 HashMap。<h4 id="3-List-类型"><a href="#3-List-类型" class="headerlink" title="3. List 类型"></a>3. List 类型</h4><h5 id="3-1-List的基本操作指令"><a href="#3-1-List的基本操作指令" class="headerlink" title="3-1 List的基本操作指令"></a>3-1 List的基本操作指令</h5></li>
<li><strong>lpush key string</strong> 在 key 对应 list 的头部添加字符串元素，返回 1 表示成功， 0表示 key 存在且不是 list 类型。</li>
<li><strong>rpush key string</strong> 在 key 对应 list 的尾部添加字符串元素。</li>
<li><strong>llen key</strong> 返回 key 对应 list 的长度， 如果 key 不存在返回 0， 如果 key 对应类型不是 list 返回错误。</li>
<li><strong>lrange key start end</strong> 返回指定区间内的元素， 下标从 0 开始， 负值表示从后面计算， -1 表示倒数第一个元素 ， key 不存在返回空列表。</li>
<li><strong>ltrim key start end</strong> 截取 list 指定区间内元素，成功返回 1， key 不存在返回错误。</li>
<li><strong>lset key indexvalue</strong> 设置 list 中指定下标的元素值，成功返回 1， key 或者下标不存在返回错误。</li>
<li><strong>lrem key count value</strong> 从 List 的头部 （ count 正数）或尾部 （ count 负数）删除一定数量 （ count）匹配 value 的元素，返回删除的元素数量。 count 为 0时候删除全部。<strong>例子:适合删除重复的值如:  1 1 1 1 1 1 1 , lrem test 3 1b这样会删掉3个1</strong></li>
<li><strong>lpop key</strong> 从 list 的头部删除并返回删除元素。如果 key 对应 list 不存在或者是空返回 nil，如果 key 对应值不是 list 返回错误。</li>
<li><strong>rpop key</strong> 从 list 的尾部删除并返回删除元素。</li>
<li><strong>blpop key1 ……keyN timeout</strong> 从左到右扫描，返回对第一个非空 list 进行</li>
<li><strong>lpop</strong> 操作并返回，比如 blpop list1 list2 list3 0 ,如果 list 不存在 list2,list3 都是非空则对 list2 做 lpop 并返回从 list2 中删除的元素。如果所有的 list 都是空或不存在，则会阻塞 timeout 秒， timeout 为 0 表示一直阻塞。当阻塞时，如果有 client 对 key1…keyN 中的任意 key 进行 push 操作， 则第一在这个 key 上被阻塞的 client 会立即返回。 如果超时发生， 则返回 nil。有点像unix 的 select 或者 poll。</li>
<li><strong>brpop</strong> 同 blpop，一个是从头部删除一个是从尾部删除<br><img src="https://img-blog.csdnimg.cn/20181105103828831.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181105103856697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h5 id="3-2-应用场景"><a href="#3-2-应用场景" class="headerlink" title="3-2 应用场景"></a>3-2 应用场景</h5><img src="https://img-blog.csdnimg.cn/20181105103929391.png" alt="在这里插入图片描述"><br>Lists 的另一个应用就是队列，可以利用 Lists 的 PUSH 操作，将任务存在 List 中，然后工作线程再用 POP 操作将任务取出进行执行。<br>实现方式：<br>Redis list 的实现为一个双向链表，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销，Redis 内部的很多实现，包括发送缓冲队列等也都是用的这个数据结构。<h4 id="4-Set-类型"><a href="#4-Set-类型" class="headerlink" title="4. Set 类型"></a>4. Set 类型</h4><h5 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4-1 概述"></a>4-1 概述</h5>是<strong>无序集合</strong>，最大可以包含(2 的 32 次方-1)个元素。 set 的是通过 hashtable ( <strong>HashMap: 线程不安全，效率高. 允许 key 或 value 为 null HashTable:线程安全，效率低. 不允许 key 或 value 为 null</strong>)实现的，所以添加， 删除， 查找的复杂度都是 O(1)。 hash table 会随着添加或者删除自动的调整大小。需要注意的是调整 hashtable 大小时候需要同步（获取写锁）会阻塞其他读写操作。可能不久后就会改用跳表（ skip list）来实现。 跳表已经在 sortedsets 中使用了。关于 set 集合类型除了基本的添加删除操作， 其它有用的操作还包含集合的取并集(union)， 交集(intersection)，差集(difference)。通过这些操作可以很容易的实现 SNS 中的<strong>好友推荐</strong>和 blog 的 tag 功能<h5 id="4-2-Set基本操作指令"><a href="#4-2-Set基本操作指令" class="headerlink" title="4-2 Set基本操作指令"></a>4-2 Set基本操作指令</h5></li>
<li><strong>sadd key member</strong> 添加一个 string 元素到 key 对应 set 集合中，成功返回 1,如果元素以及在集合中则返回 0， key 对应的 set 不存在则返回错误。</li>
<li><strong>srem key member</strong> 从 key 对应 set 中移除指定元素，成功返回 1，如果 member在集合中不存在或者 key 不存在返回 0，如果 key 对应的不是 set 类型的值返回错误。</li>
<li><strong>spop key</strong> 删除并返回 key 对应 set 中随机的一个元素,如果 set 是空或者 key不存在返回 nil。</li>
<li><strong>srandmember key</strong> 同 spop，随机取 set 中的一个元素，但是不删除元素。</li>
<li><strong>smove srckey dstkey member</strong> 从 srckey 对应 set 中移除 member 并添加到</li>
<li><strong>stkey</strong> 对应 set 中，整个操作是原子的。 成功返回 1,如果 member 在 srckey 中不存在返回 0， 如果 key 不是 set 类型返回错误。</li>
<li><strong>scard key</strong> 返回 set 的元素个数，如果 set 是空或者 key 不存在返回 0。</li>
<li><strong>sismember key member</strong> 判断 member 是否在 set 中，存在返回 1， 0 表示不存在或者 key 不存在。</li>
<li><strong>sinter key1 key2 …… keyN</strong> 返回所有给定 key 的交集。</li>
<li><strong>sinterstore dstkey key1 ……. keyN</strong> 返回所有给定 key 的交集， 并保存交集存到 dstkey 下。<strong>(关键词不区分大小写的)</strong></li>
<li><strong>sunion key1 key2 …… keyN</strong> 返回所有给定 key 的并集。</li>
<li><strong>sunionstore dstkey key1 ……keyN</strong> 返回所有给定 key 的并集， 并保存并集到 dstkey 下。</li>
<li><strong>sdiff key1 key2 ……keyN</strong> 返回所有给定 key 的差集。</li>
<li><strong>sdiffstore dstkey key1 ……keyN</strong> 返回所有给定 key 的差集，并保存差集到 dstkey 下。</li>
<li><strong>smembers key</strong> 返回 key 对应 set 的所有元素，结果是无序的。<br><img src="https://img-blog.csdnimg.cn/20181105104743999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h5 id="4-3-应用场景"><a href="#4-3-应用场景" class="headerlink" title="4-3 应用场景"></a>4-3 应用场景</h5>Redis set 对外提供的功能与 list 类似是一个列表的功能，特殊之处在于 <strong>set 是可以自动排重的</strong>，当你需要存储一个列表数据，又不希望出现重复数据时，set 是一个很好的选择，并且 set 提供了判断某个成员是否在一个 set 集合内的重要接口，这个也是 list所不能提供的。<br>比如在微博应用中，每个人的好友存在一个集合（set）中，这样求两个人的共同好友的操作，可能就只需要用求交集命令即可。 （新浪微博关注<strong>共同好友</strong>）Redis 还为集合提供了求<strong>交集、并集、差集</strong>等操作。<br>实现方式：set 的内部实现是一个 value 永远为 null 的 HashMap，实际就是通过计hash的方式来快速排重的, 这也是set能提供判断一个成员是否在集合内的原因<h4 id="5-Sorted-Set-类型"><a href="#5-Sorted-Set-类型" class="headerlink" title="5. Sorted Set 类型"></a>5. Sorted Set 类型</h4><h5 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5-1 概述"></a>5-1 概述</h5>Sorted Set 是有序集合， 它在 set 的基础上增加了一个顺序属性，这一属性在添加修改元素的时候可以指定， 每次指定后， 会自动重新按新的值调整顺序。 可以理解了有两列的 mysql 表，一列存 value，一列存顺序。操作中 key 理解为sorted set 的名字，最多包含 2&gt;32-1 个元素<h5 id="5-2-基本操作指令"><a href="#5-2-基本操作指令" class="headerlink" title="5-2 基本操作指令"></a>5-2 基本操作指令</h5></li>
<li><strong>zadd key score member</strong> 添加元素到集合，元素在集合中存在则更新对应 score。</li>
<li><strong>zrem key member</strong> 删除指定元素， 1 表示成功，如果元素不存在返回 0。</li>
<li><strong>zincrby key incrmember</strong> 增加对应 member 的 score 值， 然后移动元素并保持 skip list 保持有序。返回更新后的 score 值。</li>
<li><strong>zrank key member</strong> 返回指定元素在集合中的排名（下标）， 集合中元素是按 score从小到大排序的。</li>
<li><strong>zrevrankkey member</strong> 同上,但是集合中元素是按 score 从大到小排序。</li>
<li><strong>zrange key start end</strong> 类似 lrange 操作从集合中去指定区间的元素。返回的是有序结果</li>
<li><strong>zrevrange key start end</strong> 同上，返回结果是按 score 逆序的。</li>
<li><strong>zrangebyscore key min max</strong> 返回集合中 score 在给定区间的元素。<strong>(里面的区间为闭区间[])</strong></li>
<li><strong>zcount key min max</strong> 返回集合中 score 在给定区间的数量。</li>
<li><strong>zcard key</strong> 返回集合中元素个数。</li>
<li><p><strong>zscore key element</strong> 返回给定元素对应的 score</p>
<h5 id="5-3-应用场景"><a href="#5-3-应用场景" class="headerlink" title="5-3 应用场景"></a>5-3 应用场景</h5><p>以某个条件为权重，比如按顶的次数排序. ZREVRANGE 命令可以用来按照得分来获取前 100 名的用户，ZRANK 可以用来获取用户排名，非常直接而且操作容易。<br>Redis sorted set 的使用场景与 set 类似，区别是 set 不是自动有序的，而 sortedset 可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。</p>
<p>  比如:twitter 的 public timeline 可以以发表时间作为 score 来存储，这样获取时就是自动按时间排好序的。<br>  比如:全班同学成绩的 SortedSets，value 可以是同学的学号，而 score 就可以是其考试得分，这样数据插入集合的，就已经进行了天然的排序。<br>  比如网易云音乐排行榜实现；<br>另外还可以用 Sorted Sets 来做带权重的队列</p>
<p>  比如普通消息的 score 为 1，重要消息的 score 为 2，然后工作线程可以选择按 score 的倒序来获取工作任务。让重要的任务优先执行。<br>需要精准设定过期时间的应用</p>
<p>  比如你可以把上面说到的 sorted set 的 score 值设置成过期时间的时间戳，那么就可以简单地通过过期时间排序，定时清除过期数据了，<br>  不仅是清除 Redis 中的过期数据，你完全可以把 Redis 里这个过期时间当成是对数据库中数据的索引，用 Redis 来找出哪些数据<br>  需要过期删除，然后再精准地从数据库中删除相应的记录</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/15/redis基本概念与操作/" data-id="cjoilhtt9000dhwu7l3qhn6a4" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-全文检索技术Lucene" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/03/全文检索技术Lucene/" class="article-date">
  <time class="post-time" datetime="2018-11-03T03:52:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">03</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/03/全文检索技术Lucene/">全文检索技术Lucene</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/大数据技术/">大数据技术</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/03/全文检索技术Lucene/" class="leancloud_visitors" data-flag-title="全文检索技术Lucene">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Lucene-简介"><a href="#一-Lucene-简介" class="headerlink" title="一. Lucene  简介"></a>一. Lucene  简介</h2><h4 id="1-Lucene-是什么"><a href="#1-Lucene-是什么" class="headerlink" title="1. Lucene  是什么"></a>1. Lucene  是什么</h4><p>Lucene 是一个开放源代码的全文检索引擎工具包，但它不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎。说到底它是一个信息检索程序库，而不是应用产品。因此它并不像百度或者 google 那样，拿来就能用，它只是提供了一种工具让你能实现这些产品。</p>
<h4 id="2-Lucene-能做什么"><a href="#2-Lucene-能做什么" class="headerlink" title="2 . Lucene  能做什么"></a>2 . Lucene  能做什么</h4><p>要回答这个问题，先要了解 lucene 的本质。实际上 lucene 的功能很单一，说到底，就是我们给它若干个字符串，然后它为我们提供一个全文搜索服务，最后告诉我们要搜索的关键词出现在哪里。知道了这个本质，我们就可以发挥想象做任何符合这个条件的事情了。比如我们可以把站内新闻都索引了，做个资料库；也可以把一个数据库表的若干个字段索引起来，那就不用再担心因为“%like%”而锁表了；学完 lucene,你也可以写个自己的搜索引擎了……</p>
<h4 id="3-Lucene-速度测试"><a href="#3-Lucene-速度测试" class="headerlink" title="3 . Lucene  速度测试"></a>3 . Lucene  速度测试</h4><p>下面给出一些测试数据，如果你觉得可以接受，那么可以选择。<br>测试一：250 万记录，300M 左右文本，生成索引 380M 左右，800 线程下平均处理时间 300ms。<br>测试二：37000 记录，索引数据库中的两个 varchar 字段，索引文件2.6M，800 线程下平均处理时间 1.5ms。</p>
<h2 id="二-深入lucene"><a href="#二-深入lucene" class="headerlink" title="二. 深入lucene"></a>二. 深入lucene</h2><h4 id="1-为什么-lucene-这么快"><a href="#1-为什么-lucene-这么快" class="headerlink" title="1. 为什么 lucene  这么快"></a>1. 为什么 lucene  这么快</h4><pre><code>1、倒排索引
2、压缩算法
3、二元搜索
</code></pre><h4 id="2-倒排序索引"><a href="#2-倒排序索引" class="headerlink" title="2. 倒排序索引"></a>2. 倒排序索引</h4><pre><code>它是根据属性的值来查找记录。
这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址由于不是由记录来确定属性值，
而是由属性值来确定记录的位置，因而称为倒排索引(invertedindex) 如下简单的例子
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181102191025500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-工作方式"><a href="#3-工作方式" class="headerlink" title="3. 工作方式"></a>3. 工作方式</h4><p>Lucene 提供的服务实际包含两部分：一入一出。所谓入是写入，即将你提供的源（本质是字符串）写入索引或者将其从索引中删除；所谓出是读出，即向用户提供全文搜索服务，让用户可以通过关键词定位源。</p>
<h4 id="4-写入流程"><a href="#4-写入流程" class="headerlink" title="4. 写入流程"></a>4. 写入流程</h4><ul>
<li>源字符串首先经过 analyzer 处理，包括：分词，分成一个个单词去除 stopword（可选）。</li>
<li>将源中需要的信息加入 Document 的各个 Field（信息域）中，并把需要索引的 Field 索引起来，把需要存储的 Field 存储起来。</li>
<li>将索引写入磁盘。<h4 id="5-读出流程"><a href="#5-读出流程" class="headerlink" title="5. 读出流程"></a>5. 读出流程</h4></li>
<li>用户提供搜索关键词，经过 analyzer 处理。</li>
<li>对处理后的关键词搜索它的索引，找出对应的 Document。</li>
<li>用户根据需要从找到的 Document 中提取需要的 Field。<h4 id="6-Docement"><a href="#6-Docement" class="headerlink" title="6. Docement"></a>6. Docement</h4>用户提供的源是一条条记录，它们可以是文本文件, 字符串或者数据库表的一条记录等等。一条记录经过索引之后，就是以一个Document 的形式存储在索引文件中的, 用户进行搜索也是以Document 列表的形式返回。<h4 id="7-Field"><a href="#7-Field" class="headerlink" title="7. Field"></a>7. Field</h4>一个 Document 可以包含多个信息域，例如一篇文章可以包含“标题”、“正文”、“最后修改时间”等信息域，这些信息域就是通过 Field在 Document 中存储的。Field 有两个属性可选：存储和索引。通过存储属性你可以控制是否对这个 Field 进行存储；通过索引属性你可以控制是否对该Field 进行索引。这看起来似乎有些废话，事实上对这两个属性的正确组合很重要。<h4 id="8-实现原理"><a href="#8-实现原理" class="headerlink" title="8. 实现原理"></a>8. 实现原理</h4><h6 id="文本倒排处理："><a href="#文本倒排处理：" class="headerlink" title="文本倒排处理："></a>文本倒排处理：</h6><img src="https://img-blog.csdnimg.cn/20181102191108118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h6 id="Lucene-整体使用如图所示："><a href="#Lucene-整体使用如图所示：" class="headerlink" title="Lucene 整体使用如图所示："></a>Lucene 整体使用如图所示：</h6><img src="https://img-blog.csdnimg.cn/20181102191131374.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h4 id="9-环境配置"><a href="#9-环境配置" class="headerlink" title="9. 环境配置"></a>9. 环境配置</h4><h6 id="9-1-下载jar包的方式"><a href="#9-1-下载jar包的方式" class="headerlink" title="9-1 下载jar包的方式"></a>9-1 下载jar包的方式</h6>  下载 lucene jar<br>  官网：<a href="https://lucene.apache.org/" target="_blank" rel="noopener">https://lucene.apache.org/</a><br>  导入 jar 到项目中<br>  我下载的为7-5-0版本的zip,架包引入下面依赖中的jar就行,但是org.apache.commons.io<br>  必须从依赖库里面引入,本人建议你可以建个maven项目,然后只引入org.apache.commons.io<br>  依赖,其他的几个直接把你下载的zip解压,找到里面的对应架包引入就行,因为maven库里面的版本较低<h6 id="9-2或者加入依赖-相关依赖如下"><a href="#9-2或者加入依赖-相关依赖如下" class="headerlink" title="9-2或者加入依赖,相关依赖如下:"></a>9-2或者加入依赖,相关依赖如下:</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">      &lt;!--测试环境--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;<span class="regexp">/groupId&gt;</span></span><br><span class="line"><span class="regexp">            &lt;artifactId&gt;junit&lt;/</span>artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">4.12</span>&lt;<span class="regexp">/version&gt;</span></span><br><span class="line"><span class="regexp">            &lt;scope&gt;compile&lt;/</span>scope&gt;</span><br><span class="line">        &lt;<span class="regexp">/dependency&gt;</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        &lt;!-- https:/</span><span class="regexp">/mvnrepository.com/</span>artifact/org.apache.directory.studio/org.apache.commons.io --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.directory.studio&lt;<span class="regexp">/groupId&gt;</span></span><br><span class="line"><span class="regexp">            &lt;artifactId&gt;org.apache.commons.io&lt;/</span>artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">2.4</span>&lt;<span class="regexp">/version&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>dependency&gt;</span><br><span class="line">       </span><br><span class="line">       &lt;!-- http:<span class="comment">//mvnrepository.com/artifact/org.apache.lucene/lucene-analyzers-common --&gt;</span></span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.apache.lucene&lt;<span class="regexp">/groupId&gt;</span></span><br><span class="line"><span class="regexp">           &lt;artifactId&gt;lucene-analyzers-common&lt;/</span>artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">4.10</span><span class="number">.3</span>&lt;<span class="regexp">/version&gt;</span></span><br><span class="line"><span class="regexp">       &lt;/</span>dependency&gt;</span><br><span class="line">       </span><br><span class="line">       &lt;!-- http:<span class="comment">//mvnrepository.com/artifact/org.apache.lucene/lucene-queryparser --&gt;</span></span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.apache.lucene&lt;<span class="regexp">/groupId&gt;</span></span><br><span class="line"><span class="regexp">           &lt;artifactId&gt;lucene-queryparser&lt;/</span>artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">4.10</span><span class="number">.3</span>&lt;<span class="regexp">/version&gt;</span></span><br><span class="line"><span class="regexp">       &lt;/</span>dependency&gt;</span><br><span class="line">      </span><br><span class="line">       &lt;!-- http:<span class="comment">//mvnrepository.com/artifact/org.apache.lucene/lucene-core --&gt;</span></span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.apache.lucene&lt;<span class="regexp">/groupId&gt;</span></span><br><span class="line"><span class="regexp">           &lt;artifactId&gt;lucene-core&lt;/</span>artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">4.10</span><span class="number">.3</span>&lt;<span class="regexp">/version&gt;</span></span><br><span class="line"><span class="regexp">       &lt;/</span>dependency&gt;</span><br><span class="line">&lt;<span class="regexp">/dependencies&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="10-创建索引"><a href="#10-创建索引" class="headerlink" title="10.  创建索引"></a>10.  创建索引</h4><h6 id="Lucene的最重要的工作流程就是先给你查询的东西创建索引-也即给你要查询的数据按照Lucene的方式创建索引-这样才会搜索的更快-使用第一步让我们给数据创建索引-直接上代码啦-注释写的比较啰嗦"><a href="#Lucene的最重要的工作流程就是先给你查询的东西创建索引-也即给你要查询的数据按照Lucene的方式创建索引-这样才会搜索的更快-使用第一步让我们给数据创建索引-直接上代码啦-注释写的比较啰嗦" class="headerlink" title="==Lucene的最重要的工作流程就是先给你查询的东西创建索引,也即给你要查询的数据按照Lucene的方式创建索引,这样才会搜索的更快,使用第一步让我们给数据创建索引,直接上代码啦!!! 注释写的比较啰嗦.=="></a>==Lucene的最重要的工作流程就是先给你查询的东西创建索引,也即给你要查询的数据按照Lucene的方式创建索引,这样才会搜索的更快,使用第一步让我们给数据创建索引,直接上代码啦!!! 注释写的比较啰嗦.==</h6><p>两个成员变量:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//要搜索的目录路径</span></span><br><span class="line"><span class="built_in">String</span> pathSearch = <span class="string">"C://Users//威威//Desktop//课堂内容//第15周//day 5"</span>;</span><br><span class="line"><span class="comment">//索引要存放的路径</span></span><br><span class="line"><span class="built_in">String</span> pathIndex = <span class="string">"C://Users//威威//Desktop//课堂内容//第16周//day 5//testLucene"</span>;</span><br></pre></td></tr></table></figure></p>
<p>正式的建索引代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//索引存放的目录文件夹</span></span><br><span class="line">        File indexRepositoryFile = <span class="keyword">new</span> File(pathIndex);</span><br><span class="line">        <span class="comment">//得到目录的文件路径(不能直接用上面的path,不然会报错)</span></span><br><span class="line">        Path directoryPath = indexRepositoryFile.toPath();</span><br><span class="line">        <span class="comment">//lucene进行搜索的目录</span></span><br><span class="line">        Directory directory = FSDirectory.open(directoryPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//准备你想要搜索的目录文件</span></span><br><span class="line">        File searchFiles = <span class="keyword">new</span> File(pathSearch);</span><br><span class="line">        <span class="comment">//获取一个标准分词器</span></span><br><span class="line">        Analyzer analyzer = <span class="keyword">new</span> StandardAnalyzer();</span><br><span class="line">        <span class="comment">//配置indexWriterConfig</span></span><br><span class="line">        <span class="comment">//IndexWriterConfig indexWConfig = new IndexWriterConfig();</span></span><br><span class="line">        IndexWriterConfig indexWConfig = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        <span class="comment">//指定索引写入的模式</span></span><br><span class="line">        indexWConfig.setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);</span><br><span class="line">        <span class="comment">//通过索引目录与配置信息得到writer</span></span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(directory, indexWConfig);</span><br><span class="line">        <span class="comment">//遍历读取文件目录pathSearch里的所有文件,非常重要,如果直接遍历杜会报错(文件存在,但它是个目录)</span></span><br><span class="line">        Collection&lt;File&gt; files = FileUtils.listFiles(searchFiles, TrueFileFilter.INSTANCE,TrueFileFilter.INSTANCE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历读取目录里的所有文件</span></span><br><span class="line">        <span class="keyword">for</span>(File file : files)&#123;</span><br><span class="line">            <span class="comment">//得到文件名</span></span><br><span class="line">            String fileName = file.getName();</span><br><span class="line">            <span class="comment">//文件内容</span></span><br><span class="line">            String fileContent = FileUtils.readFileToString(file);</span><br><span class="line">            <span class="comment">//文件路径</span></span><br><span class="line">            String filePath = file.getPath();</span><br><span class="line">            <span class="comment">//文件大小</span></span><br><span class="line">            Long fileSize = FileUtils.sizeOf(file);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建一个document对象</span></span><br><span class="line">            Document document = <span class="keyword">new</span> Document();</span><br><span class="line">            <span class="comment">// 向Document对象中添加域信息</span></span><br><span class="line">            <span class="comment">// 参数：1、域的名称；2、域的值；3、是否存储；</span></span><br><span class="line">            Field nameField = <span class="keyword">new</span> TextField(<span class="string">"name"</span>,fileName,Store.YES );</span><br><span class="line">            Field contentField = <span class="keyword">new</span> TextField(<span class="string">"content"</span>, fileContent, Store.YES);</span><br><span class="line">            <span class="comment">// storedFiled默认存储</span></span><br><span class="line">            Field pathField = <span class="keyword">new</span> StoredField(<span class="string">"path"</span>,filePath );</span><br><span class="line">            Field sizeField = <span class="keyword">new</span> StoredField(<span class="string">"size"</span>,fileSize );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将域添加到document对象中</span></span><br><span class="line">            document.add(nameField);</span><br><span class="line">            document.add(contentField);</span><br><span class="line">            document.add(pathField);</span><br><span class="line">            document.add(sizeField);</span><br><span class="line">            <span class="comment">//将信息写入到检索库中</span></span><br><span class="line">            writer.addDocument(document);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭indexWriter</span></span><br><span class="line">        writer.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>点击运行会在你索引目录生成索引文件:<br><img src="https://img-blog.csdnimg.cn/20181103111125952.png" alt="在这里插入图片描述"></p>
<h4 id="11-查询索引"><a href="#11-查询索引" class="headerlink" title="11. 查询索引"></a>11. 查询索引</h4><h6 id="上面索引建立好了-此时你要全文检索-检索已经建好索引的目录就行了-不再索引源文件的目录"><a href="#上面索引建立好了-此时你要全文检索-检索已经建好索引的目录就行了-不再索引源文件的目录" class="headerlink" title="上面索引建立好了,此时你要全文检索,检索已经建好索引的目录就行了,不再索引源文件的目录."></a>上面索引建立好了,此时你要全文检索,检索已经建好索引的目录就行了,不再索引源文件的目录.</h6><p>正式搜索代码:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public <span class="keyword">void</span> search() throws IOException, ParseException &#123;</span><br><span class="line">        <span class="comment">//指定索引的目录并打开,路径不能直接给,必须转化一下</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(pathIndex);</span><br><span class="line">        Path path = file.toPath();</span><br><span class="line">        Directory directory = FSDirectory.open(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到一个基础分词器,查询也需要分词操作,假如用户输入的内容很长</span></span><br><span class="line">        Analyzer analyzer = <span class="keyword">new</span> StandardAnalyzer();</span><br><span class="line"></span><br><span class="line">        IndexReader indexReader = DirectoryReader.open(directory);</span><br><span class="line">        <span class="comment">//创建IndexSearch对象</span></span><br><span class="line">        IndexSearcher indexSearcher = <span class="keyword">new</span> IndexSearcher(indexReader);</span><br><span class="line">        <span class="comment">//创建一个分析器</span></span><br><span class="line">        QueryParser parser = <span class="keyword">new</span> QueryParser(<span class="string">"content"</span>,analyzer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//要查询的东西</span></span><br><span class="line">        Query query = parser.parse(<span class="string">"用"</span>);</span><br><span class="line">        <span class="comment">/*// 创建一个查询对象</span></span><br><span class="line"><span class="comment">        TermQuery termQuery = new TermQuery(new Term("name", "crm"));*/</span></span><br><span class="line">        <span class="comment">// 执行查询</span></span><br><span class="line">        <span class="comment">// 返回的最大值，在分页的时候使用</span></span><br><span class="line">        TopDocs topDocs = indexSearcher.search(query, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 取查询结果总数量</span></span><br><span class="line">        System.out.println(<span class="string">"总共的查询结果："</span> + topDocs.totalHits);</span><br><span class="line">        <span class="comment">// 查询结果，就是documentID列表</span></span><br><span class="line">        ScoreDoc[] scoreDocs = topDocs.scoreDocs;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">            <span class="comment">// 取对象document的对象id</span></span><br><span class="line">            int docID = scoreDoc.doc;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 相关度得分</span></span><br><span class="line">            float score = scoreDoc.score;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据ID去document对象</span></span><br><span class="line">            Document <span class="built_in">document</span> = indexSearcher.doc(docID);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*System.out.println("相关度得分：" + score);</span></span><br><span class="line"><span class="comment">            System.out.println("");</span></span><br><span class="line"><span class="comment">            System.out.println("文件的名字: "+document.get("name"));</span></span><br><span class="line"><span class="comment">            System.out.println("");*/</span></span><br><span class="line">            <span class="comment">// 另外的一种使用方法</span></span><br><span class="line">            System.out.println(<span class="built_in">document</span>.getField(<span class="string">"content"</span>).stringValue());</span><br><span class="line">            System.out.println(<span class="built_in">document</span>.get(<span class="string">"path"</span>));</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.out.println(<span class="string">"======================="</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        indexReader.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="12-Lucene的其他功能"><a href="#12-Lucene的其他功能" class="headerlink" title="12. Lucene的其他功能"></a>12. Lucene的其他功能</h4><h5 id="12-1-分词器"><a href="#12-1-分词器" class="headerlink" title="12-1 分词器"></a>12-1 分词器</h5><p>Lucene 自带的 StandardAnalyzer 分词器，只能对英语进行分词。<br>在对中文进行分词的时候采用了一元分词，即每一个中文作为一个词，<br>如“我是中国人”，则分词结果为“我”，“是”，“中”，“国”，“人”，<br>可以看出分词效果很差。在这里推荐一个比较好用的中文分词器<br>IKAnalyzer。</p>
<h5 id="12-2-停用词"><a href="#12-2-停用词" class="headerlink" title="12-2 停用词"></a>12-2 停用词</h5><p>停用词是指在信息检索中，为节省存储空间和提高搜索效率，在<br>处理自然语言数据（或文本）之前或之后会自动过滤掉某些字或词，<br>这些字或词即被称为 Stop Words（停用词）。比如中文中“了”， “么”，</p>
<p>“呢”，“的”等意义不大且在一篇文章中出现频率又很高的词，又比<br>如英文中的”for”,”in”,”it”,”a”,”or”等词。<br>在使用 IKAnalyzer 分词器的时候，可以在 IKAnalyzer.cfg.xml<br>里配置相关信息，如下图：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;</span><br><span class="line">    &lt;!--用户在这可以配置自己的扩展字典--&gt;</span><br><span class="line">    &lt;entry key="ext_dict"&gt;ext_dict;&lt;/entry&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--用户可以在这里配置自己的停止词字典--&gt;</span><br><span class="line">    &lt;entry key="ext_stopwords"&gt;stopword.dic;chinese_stopword.dic&lt;/entry&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<h5 id="12-2-高亮-Highlighter"><a href="#12-2-高亮-Highlighter" class="headerlink" title="12-2 高亮-Highlighter"></a>12-2 高亮-Highlighter</h5><p>高亮是什么?来看一下百度就知道了<br><img src="https://img-blog.csdnimg.cn/20181103112826150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>红色的就是关键词高亮显示了,引入里面的高亮jar包就行了,自己可以设置.</p>
<h2 id="三-Lucene相关概念补充"><a href="#三-Lucene相关概念补充" class="headerlink" title="三. Lucene相关概念补充"></a>三. Lucene相关概念补充</h2><h4 id="1-Field属性"><a href="#1-Field属性" class="headerlink" title="1. Field属性"></a>1. Field属性</h4><p>Field 是文档中的域，包括 Field 名和 Field 值两部分，一个文档可以包括多个 Field，Document 只是 Field 的一个承载体，Field值即为要索引的内容，也是要搜索的内容。</p>
<ul>
<li>是否分词(tokenized)<ul>
<li>是：作分词处理，即将 Field 值进行分词，分词的目的是为了索引。比如：商品名称、商品简介等，这些内容用户要输入关键字搜索，由于搜索的内容格式大、内容多需要分词后将语汇单元索引。</li>
<li>否：不作分词处理比如：商品 id、订单号、身份证号等</li>
</ul>
</li>
<li>是否索引(indexed)<ul>
<li>是：进行索引。将 Field 分词后的词或整个 Field 值进行索引，索引的目的是为了搜索比如：商品名称、商品简介分词后进行索引，订单号、身份证号不用分词但也要索引，这些将来都要作为查询条件。</li>
<li>否：不索引。该域的内容无法搜索到比如：商品 id、文件路径、图片路径等，不用作为查询条件的不用索引。</li>
</ul>
</li>
<li>是否存储(stored)<ul>
<li>是：将 Field 值存储在文档中，存储在文档中的 Field 才可以从<br>Document 中获取。比如：商品名称、订单号，凡是将来要从 Document 中获取的 Field都要存储。</li>
<li>否：不存储 Field 值，不存储的 Field 无法通过 Document 获取<br>比如：商品简介，内容较大不用存储。如果要向用户展示商品简介可以从系统的关系数据库中获取商品简介。如果需要商品描述，则根据搜索出的商品 ID 去数据库中查询，然后显示出商品描述信息即可。<h4 id="2-Field-常用类型"><a href="#2-Field-常用类型" class="headerlink" title="2. Field 常用类型"></a>2. Field 常用类型</h4>开发中常用 的 Filed 类型，注意 Field 的属性，根据需求选择：<br><a href="https://img-blog.csdnimg.cn/20181103113942512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener">https://img-blog.csdnimg.cn/20181103113942512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70</a><h4 id="3-例子"><a href="#3-例子" class="headerlink" title="3. 例子"></a>3. 例子</h4></li>
</ul>
</li>
<li>图书 id：<ul>
<li>是否分词：不用分词，因为不会根据商品 id 来搜索商品</li>
<li>是否索引：不索引，因为不需要根据图书 ID 进行搜索</li>
<li>是否存储：要存储，因为查询结果页面需要使用 id 这个值</li>
</ul>
</li>
<li>图书名称：<ul>
<li>是否分词：要分词，因为要将图书的名称内容分词索引，根据关键搜索图书名称抽取的词。</li>
<li>是否索引：要索引。</li>
<li>是否存储：要存储</li>
</ul>
</li>
<li>图书价格：<ul>
<li>是否分词：要分词，lucene 对数字型的值只要有搜索需求的都要分词和索引，因为 lucene 对数字型的内容要特殊分词处理，本例子可能要根据价格范 围搜索，需要分词和索引。</li>
<li>是否索引：要索引</li>
<li>是否存储：要存储</li>
</ul>
</li>
<li>图书图片地址：<ul>
<li>是否分词：不分词</li>
<li>是否索引：不索引</li>
<li>是否存储：要存储</li>
</ul>
</li>
<li>图书描述：<ul>
<li>是否分词：要分词</li>
<li>是否索引：要索引</li>
<li>是否存储：因为图书描述内容量大，不在查询结果页面直接显示，不存储。 不存储是来不在 lucene 的索引文件中记录，节省 lucene的索引文件空间， 如果要在详情页面显示描述，思路： 从 lucene中取出图书的 id，根据图书的 id 查询关系数据库中 book 表 得到描述信息。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/03/全文检索技术Lucene/" data-id="cjoilhttd000hhwu7riliq2h1" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/全文检索技术Lucene/">全文检索技术Lucene</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/快速搜索技术Lucene/">快速搜索技术Lucene</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Hadoop入门" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/02/Hadoop入门/" class="article-date">
  <time class="post-time" datetime="2018-11-02T01:07:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/02/Hadoop入门/">Hadoop入门</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/大数据技术/">大数据技术</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/02/Hadoop入门/" class="leancloud_visitors" data-flag-title="Hadoop入门">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Hadoop简介"><a href="#一-Hadoop简介" class="headerlink" title="一.Hadoop简介"></a>一.Hadoop简介</h2><h4 id="1-Hadoop-分布式-简介"><a href="#1-Hadoop-分布式-简介" class="headerlink" title="1.Hadoop  分布式 简介"></a>1.Hadoop  分布式 简介</h4><p>Hadoop  是分布式的系统架构，是 e Apache  基金会顶级金牌项目<br><img src="https://img-blog.csdnimg.cn/20181101233214591.png" alt="在这里插入图片描述"></p>
<h4 id="2-Hadoop-的思想之源"><a href="#2-Hadoop-的思想之源" class="headerlink" title="2.Hadoop  的思想之源"></a>2.Hadoop  的思想之源</h4><p>来自于 Google 03 年发布 3 大论文， GFS、MapReduce、Bigtable ；Dougcutting 用 Java 实现)</p>
<h4 id="3-Hadoop作者"><a href="#3-Hadoop作者" class="headerlink" title="3.Hadoop作者"></a>3.Hadoop作者</h4><p>Hadoop 作者 Doug cutting，就职 Yahoo 期间开发了 Hadoop项目，目前在 Cloudera 公司从事架构工作<br><img src="https://img-blog.csdnimg.cn/2018110123330933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="4-Hadoop-组成"><a href="#4-Hadoop-组成" class="headerlink" title="4.Hadoop  组成"></a>4.Hadoop  组成</h4><p>Hadoop = hdfs（存储） + mapreduce(计算) + yarn(资源管理) </p>
<h6 id="a-分布式存储系统-HDFS-（Hadoop-Distributed-FileSystem-）"><a href="#a-分布式存储系统-HDFS-（Hadoop-Distributed-FileSystem-）" class="headerlink" title="a. 分布式存储系统 HDFS  （Hadoop Distributed FileSystem  ）"></a>a. 分布式存储系统 HDFS  （Hadoop Distributed FileSystem  ）</h6><p>– 分布式的存储系统<br>– 提供了 高可靠性、高扩展性和高吞吐率的数据存储服务</p>
<h6 id="b-分布式计算框架-MapReduce"><a href="#b-分布式计算框架-MapReduce" class="headerlink" title="b. 分布式计算框架 MapReduce"></a>b. 分布式计算框架 MapReduce</h6><p>– 分布式计算框架（计算向数据移动）<br>– 具有 易于编程、高容错性和高扩展性等优点。</p>
<h6 id="c-分布式资源管理框架-YARN-（Yet-Another-Resource-Management-）"><a href="#c-分布式资源管理框架-YARN-（Yet-Another-Resource-Management-）" class="headerlink" title="c. 分布式资源管理框架 YARN （Yet Another Resource Management ）"></a>c. 分布式资源管理框架 YARN （Yet Another Resource Management ）</h6><p>– 负责集群资源的管理和调度</p>
<h2 id="二-分布式文件存储系统-HDFS"><a href="#二-分布式文件存储系统-HDFS" class="headerlink" title="二.分布式文件存储系统 HDFS"></a>二.分布式文件存储系统 HDFS</h2><h4 id="1-HDFS真面目"><a href="#1-HDFS真面目" class="headerlink" title="1.HDFS真面目"></a>1.HDFS真面目</h4><p>HDFS 是 Hadoop 分布式文件存储系统为什么会有分布式的文件存储系统出现？面对的大量的数据和如何计算的难题大量【pb 级以上】的网页怎么存储问题 （之前是用磁柜存储）</p>
<h6 id="分布式存储系统-HDFS-（Hadoop-Distributed-File-System）主要解决大数据的存储问题"><a href="#分布式存储系统-HDFS-（Hadoop-Distributed-File-System）主要解决大数据的存储问题" class="headerlink" title="分布式存储系统 HDFS （Hadoop Distributed File System）主要解决大数据的存储问题"></a>分布式存储系统 HDFS （Hadoop Distributed File System）<strong>主要解决大数据的存储问题</strong></h6><p>经过多年的发展，HDFS 的应用已经非常成熟非常多，如百度网盘 360 云盘 腾讯微云 阿里云（不仅提供服务器和云存储还提供服务，比一般的强多了）大数据好多技术框架都架构于这个文件存储系统之上的。</p>
<h6 id="hadoop2-0时代的生态系统如下"><a href="#hadoop2-0时代的生态系统如下" class="headerlink" title="hadoop2.0时代的生态系统如下:"></a>hadoop2.0时代的生态系统如下:</h6><p><img src="https://img-blog.csdnimg.cn/20181101233615684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-HDFS-架构图"><a href="#2-HDFS-架构图" class="headerlink" title="2.==HDFS  架构图=="></a>2.==HDFS  架构图==</h4><p><img src="https://img-blog.csdnimg.cn/20181101233808995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-架构图详解"><a href="#3-架构图详解" class="headerlink" title="3.架构图详解"></a>3.架构图详解</h4><h5 id="3-1-HDFS-的功能模块及原理详解"><a href="#3-1-HDFS-的功能模块及原理详解" class="headerlink" title="3-1. HDFS  的功能模块及原理详解"></a>3-1. HDFS  的功能模块及原理详解</h5><h6 id="3-1-1-HDFS-数据存储单元（block"><a href="#3-1-1-HDFS-数据存储单元（block" class="headerlink" title="3-1-1. HDFS  数据存储单元（block )"></a>3-1-1. HDFS  数据存储单元（block )</h6><p>一个文件被切分成固定大小的数据块 block(在客户端切分)</p>
<pre><code>• 默认数据块大小为 128MB (hadoop2.x)，可自定义配置
• 若文件大小不到 128MB ，则单独存成一个 block
</code></pre><p>一个文件存储方式</p>
<pre><code>• 按大小被切分成若干个 block ，存储到不同节点上
• 默认情况下每个 block 都有 3 个副本
* Block 大小和副本数通过 Client 端上传文件时设置，文件上传成功后副本数可以变更，Block Size 不可变更
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181101234130482.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181101234153566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="3-1-2-hdfs存储模型：字节"><a href="#3-1-2-hdfs存储模型：字节" class="headerlink" title="3-1-2. hdfs存储模型：字节"></a>3-1-2. hdfs存储模型：字节</h6><pre><code>– 文件线性切割成块（Block）:偏移量 offset （byte）
– Block 分散存储在集群节点中
– 单一文件 Block 大小一致，文件与文件可以不一致
– Block 可以设置副本数，副本分散在不同节点中
• 副本数不要超过节点数量
– 文件上传可以设置 Block 大小和副本数
– 已上传的文件 Block 副本数可以调整，大小不变
– 只支持一次写入多次读取，同一时刻只有一个写入者
– 可以 append 追加数据
</code></pre><h5 id="3-2-NameNode-（简称-NN"><a href="#3-2-NameNode-（简称-NN" class="headerlink" title="3-2. NameNode （简称 NN )"></a>3-2. NameNode （简称 NN )</h5><h6 id="3-2-1-NameNode-主要功能："><a href="#3-2-1-NameNode-主要功能：" class="headerlink" title="3-2-1. NameNode  主要功能："></a>3-2-1. NameNode  主要功能：</h6><pre><code>• 接受客户端的读/写服务
• 收集 DataNode 汇报的 Block 列表信息
</code></pre><h6 id="3-2-2-基于内存存储-不会和磁盘发生交换"><a href="#3-2-2-基于内存存储-不会和磁盘发生交换" class="headerlink" title="3-2-2. 基于内存存储 :==不会和磁盘发生交换=="></a>3-2-2. 基于内存存储 :==不会和磁盘发生交换==</h6><pre><code>• 只存在内存中
• 持久化
</code></pre><h6 id="3-2-3-NameNode-保存metadata-信息"><a href="#3-2-3-NameNode-保存metadata-信息" class="headerlink" title="3-2-3.  NameNode  保存metadata  信息"></a>3-2-3.  NameNode  保存metadata  信息</h6><pre><code>• 文件 owership(归属)和 permissions(权限)
• 文件大小，时间
• （Block 列表：Block 偏移量），位置信息
• Block 保存在哪个 DataNode 信息（由 DataNode 启动时上报,不保存在磁盘）
</code></pre><h6 id="3-2-4-NameNode-持久化"><a href="#3-2-4-NameNode-持久化" class="headerlink" title="3-2-4.  NameNode  持久化"></a>3-2-4.  NameNode  持久化</h6><pre><code>• NameNode 的 metadate 信息在启动后会加载到内存
• metadata 存储到磁盘文件名为”fsimage”
• Block 的位置信息不会保存到 fsimage
• edits 记录对 metadata 的操作日志
</code></pre><p>– fsimage 保存了最新的元数据检查点,类似快照。<br>– editslog 保存自最新检查点后的元信息变化，从最新检查点后，hadoop 将对每个文件的操作都保存在 edits 中。客户端修改文件时候，先写到 editlog，成功后才更新内存中的metadata 信息<br>==Metadata = fsimage + editslog==</p>
<h5 id="3-3-DataNode-（DN-）"><a href="#3-3-DataNode-（DN-）" class="headerlink" title="3-3. DataNode （DN ）"></a>3-3. DataNode （DN ）</h5><p>•本地磁盘目录存储数据（Block），文件的形式<br>• 同时存储 Block 的元数据信息文件<br>• 启动 DN 进程的时候会向 NameNode 汇报 block 信息<br>• 通过向 NN 发送心跳保持与其联系（3 秒一次），如果 NN 10分钟没有收到 DN 的心跳，则认为其已经 lost，并 copy 其上的 block 到其它 DN</p>
<h5 id="3-4-SecondaryNameNode-（SNN"><a href="#3-4-SecondaryNameNode-（SNN" class="headerlink" title="3-4. SecondaryNameNode （SNN )"></a>3-4. SecondaryNameNode （SNN )</h5><p>– 它的主要工作是帮助 NN 合并 edits log 文件，减少 NN 启动时间,它不是 NN 的备份（但可以做备份)。<br>– SNN 执行合并时间和机制</p>
<pre><code>•A、根据配置文件设置的时间间隔 fs.checkpoint.period 默认 3600 秒。
•B、根据配置文件设置 edits log 大小 fs.checkpoint.size规定 edits 文件的最大值默认是 64MB
</code></pre><h5 id="3-5-SecondaryNameNode-SNN-合并流程"><a href="#3-5-SecondaryNameNode-SNN-合并流程" class="headerlink" title="3-5. SecondaryNameNode SNN 合并流程"></a>3-5. SecondaryNameNode SNN 合并流程</h5><p><img src="https://img-blog.csdnimg.cn/20181101234549677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>首先是 NN 中的 Fsimage 和 edits 文件通过网络拷贝，到达SNN 服务器中，拷贝的同时，用户的实时在操作数据，那么 NN中就会从新生成一个 edits 来记录用户的操作，而另一边的 SＮＮ将拷贝过来的 edits 和 fsimage 进行合并，合并之后就替换NN 中的 fsimage。之后 NN 根据 fsimage 进行操作（当然每隔一段时间就进行替换合并，循环）。当然新的 edits 与合并之后传输过来的 fsimage 会在下一次时间内又进行合并。</p>
<h5 id="3-6-Block的副本放置策略"><a href="#3-6-Block的副本放置策略" class="headerlink" title="3-6. Block的副本放置策略"></a>3-6. Block的副本放置策略</h5><p>– 第一个副本：放置在上传文件的 DN；如果是集群外提交，则随机挑选一台磁盘不太满，CPU 不太忙的节点。<br>– 第二个副本：放置在于第一个副本不同的机架的节点上。<br>– 第三个副本：与第二个副本相同机架的不同节点。<br>– 更多副本：随机节点</p>
<pre><code>集群内提交：会放到不同的基站(服务器上,减少宕机的概率)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181101234729844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="4-HDFS读写流程"><a href="#4-HDFS读写流程" class="headerlink" title="4. HDFS读写流程"></a>4. HDFS读写流程</h4><h5 id="4-1-写文件流程"><a href="#4-1-写文件流程" class="headerlink" title="4-1. 写文件流程"></a>4-1. 写文件流程</h5><p><img src="https://img-blog.csdnimg.cn/20181101235029638.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="HDFS-写流程"><a href="#HDFS-写流程" class="headerlink" title="HDFS 写流程"></a>HDFS 写流程</h6><p>– Client：</p>
<pre><code>• 切分文件 Block
• 按 Block 线性和 NN 获取 DN 列表（副本数）
• 验证 DN 列表后以更小的单位(packet)流式传输数据
</code></pre><p>– 各节点，两两通信确定可用</p>
<p>– Block 传输结束后：</p>
<pre><code>DN 向 NN 汇报 Block 信息
DN 向 Client 汇报完成
</code></pre><p>– Client 向 NN 汇报完成</p>
<pre><code>• 获取下一个 Block 存放的 DN 列表
• ……………..
• 最终 Client 汇报完成
• NN 会在写流程更新文件状态
</code></pre><h5 id="4-2-读文件过程"><a href="#4-2-读文件过程" class="headerlink" title="4-2. 读文件过程"></a>4-2. 读文件过程</h5><p><img src="https://img-blog.csdnimg.cn/20181101235106291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="HDFS-读流程"><a href="#HDFS-读流程" class="headerlink" title="HDFS 读流程"></a>HDFS 读流程</h6><p>– Client：</p>
<pre><code>• 和 NN 获取一部分 Block 副本位置列表
• 线性和 DN 获取 Block，最终合并为一个文件
• 在 Block 副本列表中按距离择优选取
</code></pre><h5 id="4-3-HDFS的优缺点"><a href="#4-3-HDFS的优缺点" class="headerlink" title="4-3. HDFS的优缺点"></a>4-3. HDFS的优缺点</h5><h6 id="4-3-1-优点"><a href="#4-3-1-优点" class="headerlink" title="4-3-1. 优点"></a>4-3-1. 优点</h6><p>– 高容错性</p>
<pre><code>• 数据自动保存多个副本
• 副本丢失后，自动恢复
</code></pre><p>– 适合批处理</p>
<pre><code>• 移动计算而非数据
• 数据位置暴露给计算框架（Block 偏移量）
</code></pre><p>– 适合大数据处理</p>
<pre><code>• GB 、TB 、甚至 PB 级数据
• 百万规模以上的文件数量
• 10K+ 节点
</code></pre><p>– 可构建在廉价机器上</p>
<pre><code>• 通过多副本提高可靠性
• 提供了容错和恢复机制
</code></pre><h6 id="4-3-2-缺点"><a href="#4-3-2-缺点" class="headerlink" title="4-3-2. 缺点"></a>4-3-2. 缺点</h6><ul>
<li>低延迟高数据吞吐访问问题</li>
<li>比如支持秒级别反应，不支持毫秒级</li>
<li>延迟与高吞吐率问题（吞吐量大但有限制于其延迟）</li>
<li><p>小文件存取</p>
<p>  • 占用 NameNode 大量内存</p>
<pre><code>• 寻道时间超过读取时间
</code></pre></li>
<li><p>并发写入、文件随机修改</p>
<p>  • 一个文件只能有一个写者</p>
<pre><code>• 仅支持 append
</code></pre><h2 id="三-Hadoop的搭建"><a href="#三-Hadoop的搭建" class="headerlink" title="三.Hadoop的搭建"></a>三.Hadoop的搭建</h2><h5 id="1-jdk安装-配置环境变量"><a href="#1-jdk安装-配置环境变量" class="headerlink" title="1.  jdk安装, 配置环境变量"></a>1.  jdk安装, 配置环境变量</h5><p>vi /etc/profile  (打开并修改环境变量配置的文件)</p>
<p>  • JAVA_HOME=/opt/sxt/jdk1.7.0_75<br>  • PATH=$PATH:$JAVA_HOME/bin   (注意是冒号隔开)</p>
<h5 id="2-ssh-免密钥（本机）以后连接本机不用再输账户密码了"><a href="#2-ssh-免密钥（本机）以后连接本机不用再输账户密码了" class="headerlink" title="2. ssh 免密钥（本机）以后连接本机不用再输账户密码了"></a>2. ssh 免密钥（本机）以后连接本机不用再输账户密码了</h5><p>  • ssh-keygen -t dsa -P ‘’ -f ~/.ssh/id_dsa<br>  • cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</p>
<h5 id="3-上传-hadoop-tar-gz-到服务器"><a href="#3-上传-hadoop-tar-gz-到服务器" class="headerlink" title="3. 上传 hadoop.tar.gz 到服务器"></a>3. 上传 hadoop.tar.gz 到服务器</h5></li>
<li>解压部署包 到/opt/sxt 目录下(目录随便选一个)</li>
<li>vi /etc/profile (添加环境变量配置)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">•  export HADOOP_PREFIX=/opt/sxt/hadoop-2.6.5</span><br><span class="line">•  PATH=$PATH:$JAVA_HOME/bin:$HADOOP_PREFIX/bin:$HADOOP_PREFIX/sbin</span><br></pre></td></tr></table></figure>
<h5 id="4-进入-opt-sxt-hadoop-2-6-5-etc-hadoop-目录-修改几个配置"><a href="#4-进入-opt-sxt-hadoop-2-6-5-etc-hadoop-目录-修改几个配置" class="headerlink" title="4. 进入  /opt/sxt/hadoop-2.6.5/etc/hadoop 目录,修改几个配置"></a>4. 进入  /opt/sxt/hadoop-2.6.5/etc/hadoop 目录,修改几个配置</h5><h6 id="修改-hadoop-env-sh-文件-vim-hadoop-env-sh"><a href="#修改-hadoop-env-sh-文件-vim-hadoop-env-sh" class="headerlink" title="-修改  hadoop-env.sh 文件: vim  hadoop-env.sh"></a>-修改  hadoop-env.sh 文件: vim  hadoop-env.sh</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/sxt/jdk1.7.0_75</span><br></pre></td></tr></table></figure>
<h6 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="- core-site.xml"></a>- core-site.xml</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;hdfs://192.168.56.123:9000&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;/var/sxt/hadoop/local&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h6 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="- hdfs-site.xml"></a>- hdfs-site.xml</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--有个值为1,因为DataNode就一个--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.56.123:50090&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<p>如果要修改每个文件默认的切分大小(Block块,默认为128M),加个配置就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--里面的值为1M,大小为字节数1024*1024,不能直接写1M或1m--&gt;</span><br><span class="line">&lt;property&gt;  </span><br><span class="line">     &lt;name&gt;dfs.blocksize&lt;/name&gt;  </span><br><span class="line">     &lt;value&gt;1048576&lt;/value&gt;  </span><br><span class="line">&lt;/property&gt;  </span><br><span class="line">&lt;property&gt;  </span><br><span class="line">     &lt;name&gt;dfs.namenode.fs-limits.min-block-size&lt;/name&gt;  </span><br><span class="line">     &lt;value&gt;1048576&lt;/value&gt;  </span><br><span class="line"> &lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h6 id="vi-slaves（datanode-节点）"><a href="#vi-slaves（datanode-节点）" class="headerlink" title="- vi slaves（datanode 节点）"></a>- vi slaves（datanode 节点）</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.123</span><br></pre></td></tr></table></figure>
<h5 id="5-格式化"><a href="#5-格式化" class="headerlink" title="5.   格式化"></a>5.   格式化</h5><pre><code>hdfs namenode -format   (只有第一次集群启动的时候才要格式化,后面就可以不用了)
</code></pre><h5 id="6-启动-start-dfs-sh"><a href="#6-启动-start-dfs-sh" class="headerlink" title="6.   启动 start-dfs.sh"></a>6.   启动 start-dfs.sh</h5><h5 id="7-查看服务进程启动了么？-jps-命令-正常情况会启动下面三个进程"><a href="#7-查看服务进程启动了么？-jps-命令-正常情况会启动下面三个进程" class="headerlink" title="7.  查看服务进程启动了么？ jps 命令 ,正常情况会启动下面三个进程"></a>7.  查看服务进程启动了么？ jps 命令 ,正常情况会启动下面三个进程</h5><pre><code>a) SecondaryNameNode
b) NameNode
c) DataNode
d) Jps
</code></pre><h5 id="8-访问-192-168-56-123-50070"><a href="#8-访问-192-168-56-123-50070" class="headerlink" title="8. 访问 192.168.56.123:50070"></a>8. 访问 192.168.56.123:50070</h5><pre><code>• 确保防火墙关闭（service iptables stop）  出现如下界面成功
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181102004429718.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="9-创建一个用户-也就是客户端的用户"><a href="#9-创建一个用户-也就是客户端的用户" class="headerlink" title="9. 创建一个用户,也就是客户端的用户"></a>9. 创建一个用户,也就是客户端的用户</h5><pre><code>hdfs dfs -mkdir /root
hdfs dfs -ls /root
</code></pre><p>创建完成后在Utilities的B t f s中生成一个root的用户<br><img src="https://img-blog.csdnimg.cn/20181102004647921.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="10-hdfs-dfs-的基本命令"><a href="#10-hdfs-dfs-的基本命令" class="headerlink" title="10.  hdfs dfs 的基本命令"></a>10.  hdfs dfs 的基本命令</h5><p>•  hdfs dfs - - put fileName[ 本地文件名 ] PATH 【s hdfs  的文件路径】</p>
<pre><code>如: hdfs dfs -put test.txt /root  (把当前目录的test.txt上传到root下面,上传成功如下图)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181102005114527.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>• hdfs dfs -du [-s][-h]URI[URI …] 显示文件(夹)大小.<br>•  hdfs dfs - - mkdir[- - p] <paths> 创建<br>•  hdfs dfs - - rm - - r /myhadoop1.0 删除<br>• hdfs dfs -cp [-f][-p|-p[topax]]URI[URI…]<des t="">复制文件(夹)，可以覆盖，可以保留原有权限信息</des></paths></p>
<h6 id="11-产生-100000-条数据："><a href="#11-产生-100000-条数据：" class="headerlink" title="11. 产生 100000 条数据："></a>11. 产生 100000 条数据：</h6><pre><code>for i in `seq 100000`;do echo &quot;hello sxt $i&quot; &gt;&gt; test.txt;done
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/02/Hadoop入门/" data-id="cjoilhtsj0002hwu7d62y5atz" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HDFS分布式存储/">HDFS分布式存储</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HDFS集群搭建/">HDFS集群搭建</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-大型网站高并发处理Nginx-lvs" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/02/大型网站高并发处理Nginx-lvs/" class="article-date">
  <time class="post-time" datetime="2018-11-02T01:04:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/02/大型网站高并发处理Nginx-lvs/">大型网站高并发处理Nginx+lvs</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/大数据技术/">大数据技术</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/11/02/大型网站高并发处理Nginx-lvs/" class="leancloud_visitors" data-flag-title="大型网站高并发处理Nginx+lvs">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-负载均衡"><a href="#一-负载均衡" class="headerlink" title="一.负载均衡"></a>一.负载均衡</h2><h6 id="为啥会出现负载均衡"><a href="#为啥会出现负载均衡" class="headerlink" title="为啥会出现负载均衡"></a>为啥会出现负载均衡</h6><p>  在海量并发的环境下，用户每一次请求服务器，都需要大量的创建线程，每一次的线程都必须分配资源（CPU、内存、带宽、磁盘 IO等），当资源不足的时候就会使得服务器宕机而无法提供服务。那么如何保证网站在流量峰值时能够顺利运作呢? 首先来介绍几个概念</p>
<h5 id="1-高并发"><a href="#1-高并发" class="headerlink" title="1.高并发"></a>1.高并发</h5><p> 见名知意，高（大量的），并发就是可以使用多个线程或者多个进程，同时处理（就是并发）不同的操作。简而言之就是每秒内有多少个请求同时访问。</p>
<h5 id="2-负载均衡"><a href="#2-负载均衡" class="headerlink" title="2.负载均衡"></a>2.负载均衡</h5><p> 负载均衡：将请求/数据【均匀】分摊到多个操作单元上执行，负载均衡的关键在于【均匀】,也是分布式系统架构设计中必须考虑的因素之一。</p>
<h5 id="3-tomcat-并发图"><a href="#3-tomcat-并发图" class="headerlink" title="3.tomcat  并发图"></a>3.tomcat  并发图</h5><p> <img src="https://img-blog.csdnimg.cn/20181031224429626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 有 tomcat 的并发测试图可以发现，当每秒 300 个请求同时访问tomcat 时，tomcat 已经开始承受不住，出现波动。那么大型网站是如何处理高并发的呢？以下是高并发场景下，实现负载均衡的一个分布式架构图。<br> <img src="https://img-blog.csdnimg.cn/20181031224500501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 常见互联网分布式架构，分为客户端层、反向代理 nginx 层、站<br>点层、服务层、数据层。只需要实现“将 请求/ / 数据 均匀分摊到多个<br>操作单元上执行”，就能实现负载均衡</p>
<h2 id="二-Nginx真面目"><a href="#二-Nginx真面目" class="headerlink" title="二.Nginx真面目"></a>二.Nginx真面目</h2><h5 id="1-什么是-Nginx"><a href="#1-什么是-Nginx" class="headerlink" title="1.什么是 Nginx"></a>1.什么是 Nginx</h5><p>Nginx 是一款轻量级的 Web 服务器/ 反向代理服务器【后面有介绍】及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev 所开发，其特点是占有内存少，并发能力强，nginx 的并发能力确实在同类型的网页服务器中表现非常好。<br>        •2004 年 10 月 4 日 第一个公开版本 0.1.0 发布。其将源代码以类 BSD 许可证的形式发布。<br>    •官方测试 nginx 能够支撑 5 5  万并发链接，并且 CPU、内存等资<br>源消耗却非常低，运行非常稳定。</p>
<h5 id="2-哪些地方使用了-Nginx-非常多"><a href="#2-哪些地方使用了-Nginx-非常多" class="headerlink" title="2.哪些地方使用了 Nginx (非常多)"></a>2.哪些地方使用了 Nginx (非常多)</h5><p><img src="https://img-blog.csdnimg.cn/20181031224642204.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="3-Nginx的优缺点"><a href="#3-Nginx的优缺点" class="headerlink" title="3.Nginx的优缺点"></a>3.Nginx的优缺点</h5><ol>
<li>nginx 相对于 apache 的优点： 轻量级，同样起 web 服务，比 apache 占用更少的内存及资源高并发，nginx </li>
<li>处理请求是 异步非阻塞（如前端 ajax）的，而 apache 则是阻塞型的，在高并发下 nginx处理请求是 异步非阻塞（如前端 ajax）的，而 apache 则是阻塞型的，在高并发下 nginx能保持低资源低消耗高性能高度模块化的设计，编写模块相对简单 还有，它社区活跃，各种高性能模块出品迅速（十几年时间发展） apache 相对于 nginx 的优点： Rewrite 重写 ，比 nginx 的 rewrite 强大模块超多，基本想到的都可以找到少 bug ，nginx 的 bug 相对较多。（出身好起步高）</li>
<li>Nginx 配置简洁, Apache 复杂</li>
</ol>
<h2 id="三-Nginx的安装"><a href="#三-Nginx的安装" class="headerlink" title="三.Nginx的安装"></a>三.Nginx的安装</h2><h5 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1.安装依赖"></a>1.安装依赖</h5><pre><code>需要的依赖  gcc   openssl-devel   pcre-devel   zlib-devel
安装的步骤  yum -y install gcc openssl-devel pcre-devel zlib-devel
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031225110925.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="2-解压文件"><a href="#2-解压文件" class="headerlink" title="2.  解压文件"></a>2.  解压文件</h5><pre><code>解压   tar -zxvf nginx-1.8.1.tar.gz  (这里是下载好的压缩包)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031225240773.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="3-configure-配置"><a href="#3-configure-配置" class="headerlink" title="3.configure  配置"></a>3.configure  配置</h5><pre><code>进入解压后的源码目录，然后执行 configure 命令进行配置(指定安装的位置)
./configure --prefix=/usr/soft/nginx   
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031225412781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="4-编译并安装"><a href="#4-编译并安装" class="headerlink" title="4. 编译并安装"></a>4. 编译并安装</h5><pre><code>make &amp;&amp; make install
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031225456446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>安装好后，会在/usr/soft 下生成 nginx 目录(这是我编译前指定的)，这个目录就是 nginx 的软件了。    
</code></pre><h5 id="5-nginx-的常用命令"><a href="#5-nginx-的常用命令" class="headerlink" title="5.nginx 的常用命令"></a>5.nginx 的常用命令</h5><pre><code>启动命令  nginx_home/sbin/nginx
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031225606470.png" alt="在这里插入图片描述"><br>启动后，访问虚拟机的 80 端口，可查看到以下界面,Nginx 默认监听 80 端口，当出现以上信息，说明安装启动成功。<br><img src="https://img-blog.csdnimg.cn/20181031225618521.png" alt="在这里插入图片描述"><br>一旦 nginx 启动，就可以通过调用带有 -s 参数的可执行文件来控制它。使用语法： nginx -s  信号信号可以是下列之一：</p>
<pre><code>stop     快速关机
quit     优雅的关机
reload   重新加载配置文件
reopen   重新打开日志文件
例如，要重新加载修改后的配置并重启，可以执行以下命令： nginx  -s  reload
</code></pre><h2 id="四-Nginx-实现高并发的配置"><a href="#四-Nginx-实现高并发的配置" class="headerlink" title="四.Nginx 实现高并发的配置"></a>四.Nginx 实现高并发的配置</h2><h5 id="1-nginx配置大览-下图为要修改的位置"><a href="#1-nginx配置大览-下图为要修改的位置" class="headerlink" title="1.nginx配置大览  (下图为要修改的位置)"></a>1.nginx配置大览  (下图为要修改的位置)</h5><p><img src="https://img-blog.csdnimg.cn/20181031232247976.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#进程数，建议设置和 CPU 个数一样或 2 倍</span><br><span class="line">	worker_processes 2;</span><br><span class="line">#日志级别</span><br><span class="line">	error_log logs/error.log warning;(默认 error 级别)</span><br><span class="line"># nginx 启动后的 pid 存放位置</span><br><span class="line">#pid logs/nginx.pid;</span><br><span class="line">	events &#123;</span><br><span class="line">		#配置每个进程的连接数，总的连接数= worker_processes * worker_connections</span><br><span class="line">		# 根据物理内存大小来配置，默认 1024</span><br><span class="line">		worker_connections 10240;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">http &#123;</span><br><span class="line">	include mime.types;</span><br><span class="line">	default_type application/octet-stream;</span><br><span class="line">	sendfile on;</span><br><span class="line">	#连接超时时间，单位秒</span><br><span class="line">	keepalive_timeout 65;</span><br><span class="line">		server &#123;</span><br><span class="line">			listen 80;</span><br><span class="line">			server_name localhost</span><br><span class="line">			#默认请求</span><br><span class="line">			location / &#123;</span><br><span class="line">			root html; #定义服务器的默认网站根目录位置</span><br><span class="line">			index index.php index.html index.htm; #定义首页索引文件的名称</span><br><span class="line">			&#125;</span><br><span class="line">		#定义错误提示页面</span><br><span class="line">		error_page 500 502 503 504 /50x.html;</span><br><span class="line">		location = /50x.html &#123;</span><br><span class="line">		root html;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-负载均衡配置-轮循的方式-按顺序依次"><a href="#2-负载均衡配置-轮循的方式-按顺序依次" class="headerlink" title="2. 负载均衡配置(轮循的方式,按顺序依次)"></a>2. 负载均衡配置(轮循的方式,按顺序依次)</h5><pre><code>nginx 支持以下负载均衡机制（或方法）：
    a) 循环 - 对应用程序服务器的请求以循环方式分发，
    b) 最少连接数 - 将下一个请求分配给活动连接数最少的服务器
    c) ip-hash - 哈希函数用于确定下一个请求（基于客户端的 IP地址）应该选择哪个服务器。
</code></pre><h6 id="Nginx默认为负载平衡配置"><a href="#Nginx默认为负载平衡配置" class="headerlink" title="Nginx默认为负载平衡配置"></a>Nginx默认为负载平衡配置</h6><p>使用 nginx 进行负载平衡的最简单配置可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream sxt&#123;</span><br><span class="line">	server 192.168.56.123:8080;</span><br><span class="line">	server 192.168.56.124:8080;</span><br><span class="line">	server 192.168.56.125:8080;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line">		server_name localhost;</span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_pass http://sxt;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，在upstream sxt 上配置的应用程序3 个实例。如果没有专门配置负载均衡方法，则默认为循环法。所有请求都被 代理到服务器组 sxt，并且 nginx 应用 HTTP 负载平衡来分发请求。</p>
<h6 id="加权负载平衡-也属于轮循方式"><a href="#加权负载平衡-也属于轮循方式" class="headerlink" title="加权负载平衡(也属于轮循方式)"></a>加权负载平衡(也属于轮循方式)</h6><p>通过使用服务器权重，还可以进一步影响 nginx 负载均衡算法，谁的权重越大，分发到的请求就越多。下面如果有五次请求,那么123的tomcat会访问3次,这个适用于不同的硬件性能不一样的时候,性能好的权重应该更大.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream sxt &#123;</span><br><span class="line">	server 192.168.56.123:8080 weigth=3;</span><br><span class="line">	server 192.168.56.124:8080;</span><br><span class="line">	server 192.168.56.125:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-最少连接负载平衡"><a href="#3-最少连接负载平衡" class="headerlink" title="3.最少连接负载平衡"></a>3.最少连接负载平衡</h5><p>在连接负载最少的情况下，nginx 会尽量避免将过多的请求分发给繁忙的应用程序服务器，而是将新请求分发给不太繁忙的服务器，避免服务器过载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream sxt &#123;</span><br><span class="line">	least_conn;</span><br><span class="line">	server 192.168.56.123:8080;</span><br><span class="line">	server 192.168.56.124:8080;</span><br><span class="line">	server 192.168.56.125:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-ip-hash映射的方式"><a href="#4-ip-hash映射的方式" class="headerlink" title="4.ip-hash映射的方式"></a>4.ip-hash映射的方式</h5><p>上述的循环或最少连接数的负载平衡方法，每个后续客户端的请求都可能被分发到不同的服务器。不能保证相同的客户端总是定向到相同的服务器。<br>如果需要将客户端绑定到特定的应用程序服务器 - 换句话说，就是始终选择相同的服务器而言，就要使客户端的会话“粘滞”或“持久” 。ip-hash 负载平衡机制就是有这种特性。使用 ip-hash，客户端的 IP 地址将用作散列键，以确定应该为客户端的请求选择服务器组中的哪台服务器。此方法可确保来自同一客户端的请求将始终定向到同一台服务器，除非此服务器不可用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream sxt&#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.56.123:8080;</span><br><span class="line">	server 192.168.56.124:8080;</span><br><span class="line">	server 192.168.56.125:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-Nginx的访问控制"><a href="#5-Nginx的访问控制" class="headerlink" title="5.Nginx的访问控制"></a>5.Nginx的访问控制</h5><p>Nginx 还可以对 IP 的访问进行控制，allow 代表允许，deny 代表禁止.Nginx不会遍历查找条件,而是找到第一个限制条件就行了,如192.168.78.1,就为禁止访问啦!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	deny 192.168.78.1;</span><br><span class="line">	allow 192.168.78.1;</span><br><span class="line">	allow 192.168.78.0/24;</span><br><span class="line">	allow 10.1.1.0/16;</span><br><span class="line">	allow 192.168.1.0/32;</span><br><span class="line">	deny all;</span><br><span class="line">	proxy_pass http://sxt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="五-虚拟主机"><a href="#五-虚拟主机" class="headerlink" title="五.虚拟主机"></a>五.虚拟主机</h2><h5 id="1-何为虚拟主机"><a href="#1-何为虚拟主机" class="headerlink" title="1.何为虚拟主机"></a>1.何为虚拟主机</h5><p>虚拟主机是指在网络服务器上分出一定的磁盘空间，用户可以租用此部分空间，以供用户放置站点及应用组件，提供必要的数据存放和传输功能。说白了虚拟主机就是把一台物理服务器划分成多个“虚拟”的服务器，各个虚拟主机之间完全独立，在外界看来，每一台虚拟主机和一台单独的主机的表现完全相同。所以这种被虚拟化的逻辑主机被形象地称为“虚拟主机”。</p>
<p>优点：<br>由于多台虚拟主机共享一台真实主机的资源，每个虚拟主机用户承受的硬件费用、网络维护费用、通信线路的费用均大幅度降低。许多企业建立网站都采用这种方法，这样不仅大大节省了购买机器和租用专线的费用，网站服务器服务器管理简单，诸如软件配置、防病毒、防攻击等安全措施都由专业服务商提供，大大简化了服务器管理的复杂性；同时也不必为使用和维护服务器的技术问题担心，更不必聘用专门的管理人员。</p>
<p>类别：</p>
<pre><code>1、基于域名的虚拟主机，通过域名来区分虚拟主机
2、基于端口的虚拟主机，通过端口来区分虚拟主机
3、基于 ip 的虚拟主机，很少用
</code></pre><h5 id="2-基于域名的虚拟主机配置"><a href="#2-基于域名的虚拟主机配置" class="headerlink" title="2.基于域名的虚拟主机配置"></a>2.基于域名的虚拟主机配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream shsxt&#123;</span><br><span class="line">		server 192.168.56.123:8080;</span><br><span class="line">		server 192.168.56.124:8080;</span><br><span class="line">	&#125;</span><br><span class="line">	upstream bjsxt&#123;</span><br><span class="line">		server 192.168.56.125:8080;</span><br><span class="line">		server 192.168.56.126:8080;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	//访问 sxt2.com 的时候，会把请求导到 bjsxt 的服务器组里</span><br><span class="line">	server_name sxt2.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://bjsxt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	//访问 sxt1.com 的时候，会把请求导到 shsxt 的服务器组里</span><br><span class="line">	server_name sxt1.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://shsxt;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：基于域名的虚拟机主机 在模拟应用场景时，需要在 windows 系统的 hosts文件里配置域名映射。（C:\Windows\System32\drivers\etc\hosts）<br><img src="https://img-blog.csdnimg.cn/20181031233611324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如上图所示，将 sxt1 和 sxt2 的域名映射到 nginx 服务器 IP 上。启动 nginx 后，分别访问 sxt1.com ,sxt2.com<br><img src="https://img-blog.csdnimg.cn/20181031233705513.png" alt="在这里插入图片描述"></p>
<p>图 1<br><img src="https://img-blog.csdnimg.cn/20181031233712920.png" alt="在这里插入图片描述"><br>图 2<br>由图 1，图 2 可看出，当访问 sxt1.com 的时候，nginx 将请求分发给了 tomcat20 和 tomcat21当访问 sxt2.com 的时候，nginx 将请求分发给了 tomcat22.</p>
<h2 id="六-基于端口的虚拟主机"><a href="#六-基于端口的虚拟主机" class="headerlink" title="六.基于端口的虚拟主机"></a>六.基于端口的虚拟主机</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream shsxt&#123;</span><br><span class="line">		server 192.168.56.123:8080;</span><br><span class="line">		server 192.168.56.124:8080;</span><br><span class="line">	&#125;</span><br><span class="line">	upstream bjsxt&#123;</span><br><span class="line">		server 192.168.56.125:8080;</span><br><span class="line">		server 192.168.56.126:8080;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	//当访问 nginx 的 80 端口时，将请求导给 bjsxt 组</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://bjsxt;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">server &#123;</span><br><span class="line">	//当访问 nginx 的 81 端口时，将请求导给 shsxt 组</span><br><span class="line">	listen 81;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://shsxt;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当访问 nginx 的 80 端口时，请求被分发给了 tomcat20 和 tomcat21<br><img src="https://img-blog.csdnimg.cn/2018103123374312.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181031233748678.png" alt="在这里插入图片描述"><br>当访问 nginx 的 81 端口时，请求被分发给了 tomcat22<br><img src="https://img-blog.csdnimg.cn/20181031233754456.png" alt="在这里插入图片描述"></p>
<h2 id="七-正向代理和反向代理"><a href="#七-正向代理和反向代理" class="headerlink" title="七.正向代理和反向代理"></a>七.正向代理和反向代理</h2><pre><code>正向代理
</code></pre><p>举个栗子：我是一个用户，我访问不了某网站，但是我能访问一个代理服务器，这个代理服务器呢,他能访问那个我不能访问的网站，于是我先连上代理服务器,告诉他我需要那个无法访问网站的内容，代理服务器去取回来,然后返回给我。像我们经常通过 vpn 访问国外的网站，此时就是正向代理。客户端必须设置正向代理服务器，当然前提是要知道正向代理服的 务器的 IP  地址，还有代理程序的端口。</p>
<pre><code>再比如下面的翻墙：
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181031233809465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>反向代理
</code></pre><p>•反向代理（Reverse Proxy ）方式是指以代理服务器来接受 internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器<br><img src="https://img-blog.csdnimg.cn/20181031233819318.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>反向代理隐藏了真实的服务端，当我们请求 <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 的时候，就像拨打 10086 一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx 就是性能非常好的反向代理服务器，用来做负载均衡。</p>
<h2 id="八-Nginx-的-的-session-的一致性问题"><a href="#八-Nginx-的-的-session-的一致性问题" class="headerlink" title="八.Nginx 的 的 session  的一致性问题"></a>八.Nginx 的 的 session  的一致性问题</h2><p>http 协议是无状态的，即你连续访问某个网页 100 次和访问 1次对服务器来说是没有区别对待的，因为它记不住你。那么，在一些场合，确实需要服务器记住当前用户怎么办？比如用户登录邮箱后接下来要收邮件、写邮件，总不能每次操作都让用户输入用户名和密码吧，为了解决这个问题session 的方案就被提了出来，事实上它并不是什么新技术，而且也不能脱离 http 协议以及任何现有的 web 技术session 的常见实现形式是会话cookie（session cookie），即未设置过期时间的cookie，这个cookie 的默认生命周期为浏览器会话期间，只要关闭浏览器窗口，cookie 就消失了。</p>
<h5 id="1-Session-共享"><a href="#1-Session-共享" class="headerlink" title="1.Session  共享"></a>1.Session  共享</h5><p> 首先我们应该明白，为什么要实现共享，如果你的网站是存放在一个机器上，那么是不存在这个问题的，因为会话数据就在这台机器，但是如果你使用了负载均衡把请求分发到不同的机器呢？这个时候会话 id 在客户端是没有问题的，但是如果用户的两次请求到了两台不同的机器，而它的 session 数据可能存在其中一台机器，这个时候<br>就会出现取不到 session 数据的情况，于是 session 的共享就成了一个问题</p>
<h5 id="2-Session一致性解决方案"><a href="#2-Session一致性解决方案" class="headerlink" title="2.Session一致性解决方案"></a>2.Session一致性解决方案</h5><pre><code>– 1、session 复制
</code></pre><p>– tomcat 本身带有复制 session 的功能。</p>
<pre><code>– 2、共享 session
</code></pre><p>– 需要专门管理 session 的软件，<br>– memcached 缓存服务，可以和 tomcat 整合，帮助 tomcat共享管理 session。</p>
<h5 id="3-安装-memcached"><a href="#3-安装-memcached" class="headerlink" title="3.安装 memcached"></a>3.安装 memcached</h5><ol>
<li>安装 memcached 内存数据库<br>yum -y install memcached</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看memcached安装的位置:   whereis  memcached</span><br><span class="line">验证安装:  memcached -h /etc/rc.d/init.d/memcached status   (这个是默认的位置)</span><br><span class="line">查看配置文件:   cat /etc/sysconfig/memcached</span><br><span class="line">启动:   memcached  /etc/rc.d/init.d/memcached start</span><br><span class="line">重启:   memcached  /etc/rc.d/init.d/memcached restart</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20181101002709195.png" alt="在这里插入图片描述"></p>
<ol start="2">
<li><p>web 服务器连接 memcached 的 jar 包拷贝到 tomcat 的 lib, 还可以在网上下载jar包,方法如下(要在tomcat的lib目录下):<br>wget <a href="http://dag.wieers.com/rpm/packages/rpmforge-release/rpmforge-release-0.5.2-2.rf.src.rpm" target="_blank" rel="noopener">http://dag.wieers.com/rpm/packages/rpmforge-release/rpmforge-release-0.5.2-2.rf.src.rpm</a><br>rpm -ivh rpmforge-release-0.5.2-2.rf.src.rpm</p>
<ol start="3">
<li>配置 tomcat 的 conf 目录下的 context.xml</li>
</ol>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Manager</span><br><span class="line">	className=&quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&quot;</span><br><span class="line">	memcachedNodes=&quot;n1:192.168.56.123:11211&quot;</span><br><span class="line">	sticky=&quot;true&quot;</span><br><span class="line">	lockingMode=&quot;auto&quot;</span><br><span class="line">	sessionBackupAsync=&quot;false&quot;</span><br><span class="line">	requestUriIgnorePattern=&quot;.*\.(ico|png|gif|jpg|css|js)$&quot;</span><br><span class="line">	sessionBackupTimeout=&quot;1000&quot;</span><br><span class="line">	transcoderFactoryClass=&quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>配置 memcachedNodes 属性，配置 memcached 数据库的 ip 和端口，默认 11211，多个的话用逗号隔开.目的？让tomcat 服务器从memcached缓存里面拿session 或者是放 session</p>
<ol start="4">
<li>修改 index.jsp，取 sessionid 看一看</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html;charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">	SessionID:&lt;%=session.getId()%&gt;</span><br><span class="line">	&lt;/br&gt;</span><br><span class="line">	SessionIP:&lt;%=request.getServerName()%&gt;</span><br><span class="line">	&lt;/br&gt;</span><br><span class="line">	&lt;h1&gt;this is tomcat 1&lt;/h1&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/02/大型网站高并发处理Nginx-lvs/" data-id="cjoilhttn000mhwu7jwxcqg6q" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached解决session共享/">memcached解决session共享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Linux进阶命令" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/31/Linux进阶命令/" class="article-date">
  <time class="post-time" datetime="2018-10-30T16:09:00.000Z" itemprop="datePublished">
    <span class="post-month">10月</span><br/>
    <span class="post-day">31</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/31/Linux进阶命令/">Linux进阶命令</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/10/31/Linux进阶命令/" class="leancloud_visitors" data-flag-title="Linux进阶命令">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Linux基础命令"><a href="#一-Linux基础命令" class="headerlink" title="一. Linux基础命令"></a>一. Linux基础命令</h2><h5 id="1-新建文件"><a href="#1-新建文件" class="headerlink" title="1. 新建文件"></a>1. 新建文件</h5><pre><code>touch web.log 创建一个名为web.log空文件
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030225016237.png" alt="在这里插入图片描述"></p>
<h5 id="2-复制文件"><a href="#2-复制文件" class="headerlink" title="2.复制文件"></a>2.复制文件</h5><pre><code>cp web.log web_cp.log
</code></pre><p><img src="https://img-blog.csdnimg.cn/2018103022520095.png" alt="在这里插入图片描述"></p>
<pre><code>复制文件，加个-r 参数，代表遍历复制，此时可用于复制一个
</code></pre><p>目录。</p>
<h5 id="3-删除文件"><a href="#3-删除文件" class="headerlink" title="3.删除文件"></a>3.删除文件</h5><pre><code>rm m web_cp.log
</code></pre><h5 id="4-查看文件"><a href="#4-查看文件" class="headerlink" title="4.查看文件"></a>4.查看文件</h5><pre><code>cat filename: 一次性显示整个文件的内容
more filename 该命令一次显示一屏文本，满屏后停下来，并且在屏幕的底部出现一个提示信息，给出至今己显示的该文件的
百分比(
    按 Space 键，显示文本的下一屏内容。
    按 Enier 键，只显示文本的下一行内容。
    按 B 键，显示上一屏内容。
    按 Q 键，退出。
)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030225720662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>less 命令 与 more 命令 非常类似 less filename  (
    h 显示帮助界面
    Q 退出 less 命令
    u 向后滚动半页
    d 向前翻半页
    空格键 滚动一页
    b 向后翻一页
    回车键 滚动一行
    [pagedown]： 向下翻动一页
    [pageup]： 向上翻动一页
    以及上下键，向上一行，向下一行
)
</code></pre><h5 id="5-从头或尾打印"><a href="#5-从头或尾打印" class="headerlink" title="5.从头或尾打印"></a>5.从头或尾打印</h5><pre><code>head -10 filename 打印文件 1 到 10 行
tail -10 filename 打印文件最后 10 行
</code></pre><h5 id="7-查找文件或目录"><a href="#7-查找文件或目录" class="headerlink" title="7.查找文件或目录"></a>7.查找文件或目录</h5><pre><code>f ind pathname –name filename
例子：find / -name profile   该命令表示为，在/目录下查找 名字为 profile 的文件或目录，最后列出它的绝对路径

还可以按正则表达式来查找，且 pathname 越精确，查找的范围越小，速度越快。find /etc -name pro*
</code></pre><h5 id="8-其他类"><a href="#8-其他类" class="headerlink" title="8.其他类"></a>8.其他类</h5><pre><code>q!  不保存文件并退出 vi
在 VI 的命令模式下输入“:set nu”，就有行号了。
在 VI 的命令模式下输入“:set nonu”，取消行号。
yy  复制光标所在行(常用)
• nyy  复制光标所在行的向下 n 行，例如， 20yy 则是复制 20行(常用)
• p,P  小p 为复制的数据粘贴在光标下一行， 大P 则为粘贴在光标上一行(常用)
G:光标移至第最后一行
nG：光标移动至第 N 行行首
n+：光标下移 n 行
n-：光标上移 n 行
H ：光标移至屏幕顶行
M ：光标移至屏幕中间行
L ：光标移至屏幕最后行
• dd：删除 行
x 或 X：删除一个字符，x 删除光标后的，而 X 删除光标前的
• u 恢复前一个动作(常用)
删除第 N 行到第 M 行   :N,Md
</code></pre><h5 id="9-将本地目录复制到远程机器"><a href="#9-将本地目录复制到远程机器" class="headerlink" title="9.将本地目录复制到远程机器"></a>9.将本地目录复制到远程机器</h5><pre><code>scp -r local_folderremote_username@remote_ip:remote_folder
例如:  scp -r /root/Desktop/tomcat/apache-tomcat-8.5.24 root@192.168.56.124:/root/Desktop/tomcat  (将Tomcat拷贝到远程机器那去)
</code></pre><h2 id="二-linux网络类命令"><a href="#二-linux网络类命令" class="headerlink" title="二.linux网络类命令"></a>二.linux网络类命令</h2><h5 id="1-查看ip"><a href="#1-查看ip" class="headerlink" title="1.查看ip"></a>1.查看ip</h5><pre><code>ifconfig   箭头 1 指向的是本机 IP，箭头 2 为广播地址，箭头 3 位子网掩码。
</code></pre><p><img src="https://img-blog.csdnimg.cn/2018103023352517.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="2-测试与目标主机的连通性"><a href="#2-测试与目标主机的连通性" class="headerlink" title="2.测试与目标主机的连通性"></a>2.测试与目标主机的连通性</h5><pre><code>ping remote_ip   注意：linux 系统的 ping 命令会一直发送数据包，进行测试，除非认为的按 ctrl + c 停止掉，
windows 系统默认只会发 4 个包进行测试，以下为 windows 的 dos 命令。
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030233625726.png" alt="在这里插入图片描述"></p>
<h5 id="3-显示各种网络相关信息"><a href="#3-显示各种网络相关信息" class="headerlink" title="3.显示各种网络相关信息"></a>3.显示各种网络相关信息</h5><pre><code>netstat  

-a (all)显示所有选项，默认不显示 LISTEN 相关
-t (tcp)仅显示 tcp 相关选项
-u (udp)仅显示 udp 相关选项
-n 拒绝显示别名，能显示数字的全部转化成数字。
-l 仅列出有在 Listen (监听) 的服務状态
-p 显示建立相关链接的程序名
-r 显示路由信息，路由表
-e 显示扩展信息，例如 uid 等
-s 按各个协议进行统计
-c 每隔一个固定时间，执行该 netstat 命令。
</code></pre><h2 id="三-linux系统配置命令"><a href="#三-linux系统配置命令" class="headerlink" title="三.linux系统配置命令"></a>三.linux系统配置命令</h2><h5 id="1-主机名配置"><a href="#1-主机名配置" class="headerlink" title="1.  主机名配置"></a>1.  主机名配置</h5><pre><code>若要修改主机名字，可在/etc/sysconfig/network文件里修改.
vim /etc/sysconfig/network    (机器重启才能生效)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030234010838.png" alt="在这里插入图片描述"></p>
<h5 id="2-DNS-配置"><a href="#2-DNS-配置" class="headerlink" title="2. DNS  配置"></a>2. DNS  配置</h5><pre><code>hosts 文件的作用相当于 DNS，提供 IP 地址 hostname 的对应,可在这个文件里添加映射。域名解析
vi /etc/hosts  (后面有s的)
</code></pre><p><img src="https://img-blog.csdnimg.cn/201810302341163.png" alt="在这里插入图片描述"></p>
<pre><code>测试：直接 ping 主机名
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030234202738.png" alt="在这里插入图片描述"></p>
<h5 id="3-环境变量配置"><a href="#3-环境变量配置" class="headerlink" title="3.环境变量配置"></a>3.环境变量配置</h5><pre><code>Linux 系统的环境变量是在/etc/profile 文件里配置.系统 path 里有很多路径，路径之间有冒号隔开。当用户敲命令时，
系统会从左往右依次寻找对应的程序，有的话则运行该程序，没有的就报错，command not found.
查看path的命令   echo $path  (echo相当于输出语法一样)
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030234356428.png" alt="在这里插入图片描述"></p>
<pre><code>具体配置的操作:  vim  /etc/profile    (修改环境变量的地方,打开进入编辑模式就行)
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 配置jdk环境变量</span><br><span class="line">JAVA_HOME=/root/Desktop/java/jdk/jdk1.7.0_75</span><br><span class="line"># 配置tomcat的环境变量</span><br><span class="line">TOMCAT=/root/Desktop/tomcat/apache-tomcat-7.0.91</span><br><span class="line"># 配置nginx</span><br><span class="line">NGINX=/usr/software/nginx</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$TOMCAT/bin:$NGINX/sbin</span><br></pre></td></tr></table></figure>
<p>加入的位置大概如下:<br><img src="https://img-blog.csdnimg.cn/20181101192528372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>配置完成过后保存并退出,并生效配置:  </p>
<pre><code>source  /etc/profile
验证:在任意位置输入  jps 命令,或任意地方启动,关闭tomcat等等都能完成; 如:就不用跑到tomcat的bin目录下启动tomcat了./startup.sh
而现在只要在任意目录下启动即可 startup.sh
</code></pre><h5 id="4-linux服务操作"><a href="#4-linux服务操作" class="headerlink" title="4.linux服务操作"></a>4.linux服务操作</h5><h6 id="列出所有服务"><a href="#列出所有服务" class="headerlink" title="列出所有服务"></a>列出所有服务</h6><pre><code>chkconfig
查询操作系统在每一个执行等级中会执行哪些系统服务，其中包括各类常驻服务。
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030234639705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>各数字代表的系统初始化级别含义：

0：停机状态
1：单用户模式，root 账户进行操作
2：多用户，不能使用 net file system，一般很少用
3：完全多用户，一部分启动，一部分不启动，命令行界面
4：未使用、未定义的保留模式
5：图形化，3 级别中启动的进程都启动，并且会启动一部分
图形界面进程。
6：停止所有进程，卸载文件系统，重新启动(reboot)

这些级别中 1、2、4 很少用，相对而言 0、3、5、6 用的会较多。3 级别和 5 级别除了桌面相关的进程外没有什么区别。为了减少资源占用，推荐都用 3 级别.
注意 ：linux 默认级别为 3，不要把 initdefault 设置为 0 和 6
</code></pre><h6 id="图形界面设置"><a href="#图形界面设置" class="headerlink" title="图形界面设置"></a>图形界面设置</h6><pre><code>1.关闭图形界面
init 3 关闭图形界面（XServer服务也会关闭）

2. 开启图形界面：
init 5 或  startx

3. 开机时，不进入 X Window：
vi /etc/inittab
id:5:initdefault:
改成
id:3:initdefault:
</code></pre><h6 id="服务操作"><a href="#服务操作" class="headerlink" title="服务操作"></a>服务操作</h6><pre><code>service 服务名 start/stop/status/restart
例子：对防火墙服务进行操作，防火墙的服务名为：iptables.查看防火墙服务运行状态。
</code></pre><h6 id="服务初执行等级更改"><a href="#服务初执行等级更改" class="headerlink" title="服务初执行等级更改"></a>服务初执行等级更改</h6><pre><code>chkconfig --level 2345 name off|on 
若不加级别，默认是 2345 级别,命令：chkconfig name on|off  
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030235146161.png" alt="在这里插入图片描述"></p>
<h5 id="5-进程操作"><a href="#5-进程操作" class="headerlink" title="5.进程操作"></a>5.进程操作</h5><h6 id="查看所有进程"><a href="#查看所有进程" class="headerlink" title="查看所有进程"></a>查看所有进程</h6><pre><code> ps -aux
 -a 列出所有
-u 列出用户
-x 详细列出，如 cpu、内存等

 ps - ef | grep ssh    (后面的grep相当于搜索条件)
 查看所有进程里 CMD 是 ssh 的进程信息。其中箭头所指的是 sshd 服务进程的进程号（PID）
</code></pre><p><img src="https://img-blog.csdnimg.cn/20181030235441743.png" alt="在这里插入图片描述"></p>
<h6 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h6><pre><code>kill -9 pid
-9：强制杀死
ps 命令先查出对应程序的 PID 或 PPID ，然后杀死掉进程。
</code></pre><h2 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h2><h5 id="1-yum"><a href="#1-yum" class="headerlink" title="1.yum"></a>1.yum</h5><pre><code>yum 是一个在 Fedora 和 RedHat 以及 CentOS 中的 Shell 前端软件包管理器。基于 RPM 包管理，能够从指定的服务器自动下载 RPM 包并
且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。

查看当前源   yum list | head -50
</code></pre><h5 id="2-wget"><a href="#2-wget" class="headerlink" title="2.wget"></a>2.wget</h5><pre><code>wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP/IP 协议 下载，如果你的linux没有wget
需要先安装 yum install wget –y
wget 用法:wget [option] 网址 -O 指定下载保存的路径 
</code></pre><p><img src="https://img-blog.csdnimg.cn/2018103100022765.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181031000240613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="3-tar"><a href="#3-tar" class="headerlink" title="3.tar"></a>3.tar</h5><pre><code>-z gzip 进行解压或压缩，带.gz 需要加，压缩出来.gz 也需要加
-x 解压
-c 压缩
-f 目标文件，压缩文件新命名或解压文件名
-v 解压缩过程信息打印

解压命令  tar -zvxf xxxx.tar.gz
压缩命令  tar -zcf 压缩包命名 压缩目标
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/31/Linux进阶命令/" data-id="cjoilhtt00009hwu73fz9loo0" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux的进阶命令/">linux的进阶命令</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Linux基本命令及项目上线" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/26/Linux基本命令及项目上线/" class="article-date">
  <time class="post-time" datetime="2018-10-26T11:18:00.000Z" itemprop="datePublished">
    <span class="post-month">10月</span><br/>
    <span class="post-day">26</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/26/Linux基本命令及项目上线/">Linux基本命令及项目上线</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/10/26/Linux基本命令及项目上线/" class="leancloud_visitors" data-flag-title="Linux基本命令及项目上线">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-Linux的常用命令"><a href="#一-Linux的常用命令" class="headerlink" title="一.Linux的常用命令"></a>一.Linux的常用命令</h1><pre><code>date 查看日期
pwd  查看当前位置(当我们在命令界面操作时有必要适当看看当前目录,以免出错)
cd   目录地址  目录切换
ls | ll  列表查看当前目录下文件与文件夹,ll为详细的信息
ls -a 查看目录下的所有文件（包括以.开头的隐藏文件）
</code></pre><h4 id="设置Linux的中文编码"><a href="#设置Linux的中文编码" class="headerlink" title="设置Linux的中文编码"></a>设置Linux的中文编码</h4><pre><code>输入命令进入修改界面:  vi /etc/sysconfig/i18n
要修改的内容:  LANG=&quot;en_US.UTF-8&quot; 修改为LANG=&quot;zh_CN.UTF-8&quot; 
保存退出:  shift+:
刷新:  source /etc/sysconfig/i18n
检查编码：  locale
</code></pre><h4 id="文件夹-文件-基本操作"><a href="#文件夹-文件-基本操作" class="headerlink" title="文件夹 文件 基本操作"></a>文件夹 文件 基本操作</h4><pre><code>  mkdir   目录名(可以跟多个目录名)   创建文件夹
  touch web.log   创建一个空文件
  rm -rf  目录(可以为多个)    删除文件夹（f为强制删除）
 mv      原始目录   修改后的目录   文件移动(可以进行重命名操作)
 cat filename  一次性显示整个文件的内容
 vi filename  打开文件并进入编辑状态
 more filename 该命令一次显示一屏文本，满屏后停下来，并且在屏幕的底部出现一个提示信息，给出至今己显示的该文件的百分比（
     按Space键，显示文本的下一屏内容。
    按Enier键，只显示文本的下一行内容。
    按B键，显示上一屏内容。
    按Q键，退出。
 ）
 less filename  （
     h 显示帮助界面 
    Q 退出less 命令 
    u 向后滚动半页 
    d 向前翻半页 
    空格键 滚动一页
    b 向后翻一页 
    回车键 滚动一行
    [pagedown]： 向下翻动一页 
    [pageup]： 向上翻动一页
    以及上下键，向上一行，向下一行
）
head  -10 filename  打印文件前1到10行
tail -10 filename 打印文件最后10行
find  pathname –name filename   例子：find / -name profile
  该命令表示为，在/目录下查找 名字为profile的文件或目录，最后列出它的绝对路径（ find /etc -name pro*也行，查找满足正则表达式）
</code></pre><h4 id="文件基本操作vim"><a href="#文件基本操作vim" class="headerlink" title="文件基本操作vim"></a>文件基本操作vim</h4><pre><code>安装vim 软件   yum install vim  （这样linux的文件就会有代码的高亮显示）
vim    文件名   创建或者打开指定文件
按一下 i键  进入编辑状态 在编辑状态下修改文件
u      撤销上一步的操作
Ctrl+r 恢复上一步被撤销的操作
复制行  复制哪一行就把光标放在哪一行然后用命令y,就复制了，然后我再用p命令就可以把这行复制到光标下面
快速查找   /+(你要查找的词),如: /name ,然后回车就行
查找下一个  按n键
按一下 esc 键 退出编辑  
shift+: 键  输入 wq 然后按 enter 键 执行写入并退出的操作
</code></pre><h4 id="一般模式"><a href="#一般模式" class="headerlink" title="一般模式"></a>一般模式</h4><pre><code> yy 复制光标所在行(常用) 
 nyy 复制光标所在行的向下n行，例如， 20yy则是复制20行(常用) 
 p,P   p为复制的数据粘贴在光标下一行， P则为粘贴在光标上一行(常用)
 G:光标移至第最后一行
 nG：光标移动至第N行行首
 n+：光标下移n行 
 n-：光标上移n行 
 H ：光标移至屏幕顶行 
 M ：光标移至屏幕中间行 
 L ：光标移至屏幕最后行 

dd：删除 行 
  x或X：删除一个字符，x删除光标后的，而X删除光标前的 
u 恢复前一个动作(常用)
  删除第N行到第M行：
   :N,Md
</code></pre><h4 id="文件copy"><a href="#文件copy" class="headerlink" title="文件copy"></a>文件copy</h4><pre><code>cp  源文件地址   目标文件目录地址  
</code></pre><h4 id="文件夹copy"><a href="#文件夹copy" class="headerlink" title="文件夹copy"></a>文件夹copy</h4><pre><code>cp -r  源文件夹目录   目标文件夹目录  或  复制文件夹 cp -rf 要复制的目录 新目录  
</code></pre><h4 id="进程问题"><a href="#进程问题" class="headerlink" title="进程问题"></a>进程问题</h4><ol>
<li>查看进程 ps -ef|grep redis<br><img src="https://img-blog.csdnimg.cn/20181026124931828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_27,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>杀死进程 kill -9 pid编号,pid编号为第一行的数字,可以一次清除多个进程,在后面写上多个pid就行<br><img src="https://img-blog.csdnimg.cn/20181026125247475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_27,color_FFFFFF,t_70" alt=" "></li>
</ol>
<h4 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h4><pre><code>解压压缩文件 tar -zvxf  + 文件名
</code></pre><h4 id="info-replication-查看状态"><a href="#info-replication-查看状态" class="headerlink" title="info replication 查看状态"></a>info replication 查看状态</h4><p><img src="https://img-blog.csdnimg.cn/20181026125450249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_27,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="二-静态ip、网络配置步骤"><a href="#二-静态ip、网络配置步骤" class="headerlink" title="二.静态ip、网络配置步骤"></a>二.静态ip、网络配置步骤</h1><p>   1.启动时选择<strong>NAT模式</strong><br>   <img src="https://img-blog.csdnimg.cn/20181029185150911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181029185202559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>   2.启动后修改网卡文件<br>     vi /etc/sysconfig/network-scripts/ifcfg-eth0 修改ip地址<br>        BOOTPROTO dbcp–&gt;static<br>        ipv6—&gt;no<br>      <strong>添加配置</strong><br>     DEVICE=eth0     #网卡设备名,请勿修改名字<br>    TYPE=Ethernet    #网络类型，以太网<br>    BOOTPROTO=static   #启用静态IP地址<br>    ONBOOT=yes  #开启自动启用网络连接<br>    IPADDR=192.168.78.100  #设置IP地址<br>    NETMASK=255.255.255.0  #设置子网掩码<br>    GATEWAY=192.168.78.2   #设置网关<br>    DNS1=114.114.114.114  #设置备DNS</p>
<h4 id="改完之后的如下"><a href="#改完之后的如下" class="headerlink" title="改完之后的如下:"></a>改完之后的如下:</h4><pre><code>DEVICE=&quot;eth0&quot;
BOOTPROTO=&quot;static&quot;
NM_CONTROLLED=&quot;yes&quot;
ONBOOT=&quot;yes&quot;
TYPE=&quot;Ethernet&quot;
IPADDR=192.168.56.125
NETMASK=255.255.255.0
GATEWAY=192.168.56.2
DNS1=114.114.114.114

注意：你的ip前三位要与你的网关GATEWAY一致
</code></pre><h4 id="保存并退出"><a href="#保存并退出" class="headerlink" title="保存并退出"></a>保存并退出</h4><pre><code>service network  restart 重启网络
</code></pre><h4 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h4><pre><code>ping 192.168.1.1
ping 192.168.1.xxx (windows ip)
ping baodu.com
</code></pre><h4 id="通过xshell-连接linux"><a href="#通过xshell-连接linux" class="headerlink" title="通过xshell 连接linux"></a>通过xshell 连接linux</h4><pre><code>新建会话
   输入  linux ip  用户名 密码    
</code></pre><h4 id="利用xshell实现Windows与Linux文件互传"><a href="#利用xshell实现Windows与Linux文件互传" class="headerlink" title="利用xshell实现Windows与Linux文件互传"></a>利用xshell实现Windows与Linux文件互传</h4><pre><code>   在Linux主机上，安装上传下载工具包rz及sz

只需要安装这个包即可。
[root@localhost src]#  yum install -y lrzs z

除了可以用rz sz命令进行本地windows系统和虚拟机之间的文件传输，还可以使用XFTP软件。
</code></pre><h1 id="三-项目部署到Linux流程"><a href="#三-项目部署到Linux流程" class="headerlink" title="三.项目部署到Linux流程"></a>三.项目部署到Linux流程</h1><h2 id="1-安装jdk"><a href="#1-安装jdk" class="headerlink" title="1. 安装jdk"></a>1. 安装jdk</h2><pre><code>yum list|grep jdk   查找jdk 相关软件
yum install  +版本号  安装指定版本jdk
查看安装是否成功:  java -version
</code></pre><h2 id="2-tomcat-部署"><a href="#2-tomcat-部署" class="headerlink" title="2.tomcat 部署"></a>2.tomcat 部署</h2><pre><code>wget http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-8/v8.5.34/bin/apache-tomcat-8.5.34.tar.gz  执行下载
进入bin目录操作:   cd  tomcat/bin
service  iptables  status  查看防火墙状态
service  iptables  stop   关闭防火墙
在bin 目录下执行启动脚本     ./startup.sh
外界浏览器进行访问     (例如:你的ip+端口号)192.168.1.186:8080   
关闭tomcat     cd bin --&gt;   ./shutdown.sh   
</code></pre><h5 id="查看Tomcat日志-建议xshell复制个连接查看"><a href="#查看Tomcat日志-建议xshell复制个连接查看" class="headerlink" title="查看Tomcat日志(建议xshell复制个连接查看)"></a>查看Tomcat日志(建议xshell复制个连接查看)</h5><pre><code> 首先进入Tomcat的logs目录:   cd tomcat   cd logs
输入下面语句即可实现监听:    tail -f catalina.out  
</code></pre><h2 id="3-项目Windows项目传到Linux"><a href="#3-项目Windows项目传到Linux" class="headerlink" title="3.项目Windows项目传到Linux"></a>3.项目Windows项目传到Linux</h2><h5 id="将项目打成-war"><a href="#将项目打成-war" class="headerlink" title="将项目打成 war"></a>将项目打成 war</h5><pre><code>打包环境 pom 配置
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  &lt;!--</span><br><span class="line">   打包标签配置</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;dev&lt;/id&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">      &lt;env&gt;dev&lt;/env&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;!--默认运行开发环境--&gt;</span><br><span class="line">      &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</span><br><span class="line">    &lt;/activation&gt;</span><br><span class="line">  &lt;/profile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;test&lt;/id&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">      &lt;env&gt;test&lt;/env&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">  &lt;/profile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;product&lt;/id&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">      &lt;env&gt;product&lt;/env&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">  &lt;/profile&gt;</span><br><span class="line">&lt;/profiles&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--配置--&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;finalName&gt;crm&lt;/finalName&gt;</span><br><span class="line">  &lt;resources&gt;</span><br><span class="line">    &lt;resource&gt;</span><br><span class="line">      &lt;directory&gt;src/main/resources/$&#123;env&#125;&lt;/directory&gt;</span><br><span class="line">    &lt;/resource&gt;</span><br><span class="line">    &lt;resource&gt;</span><br><span class="line">      &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">      &lt;includes&gt;</span><br><span class="line">        &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">        &lt;include&gt;**/*.properties&lt;/include&gt;</span><br><span class="line">        &lt;include&gt;**/*.tld&lt;/include&gt;</span><br><span class="line">      &lt;/includes&gt;</span><br><span class="line">      &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">    &lt;/resource&gt;</span><br><span class="line">  &lt;/resources&gt;</span><br></pre></td></tr></table></figure>
<h5 id="对应的项目的目录-每个里面的就jdbc-properties不同-根据不同环境配置"><a href="#对应的项目的目录-每个里面的就jdbc-properties不同-根据不同环境配置" class="headerlink" title="对应的项目的目录:每个里面的就jdbc.properties不同,根据不同环境配置"></a>对应的项目的目录:每个里面的就jdbc.properties不同,根据不同环境配置</h5><p><img src="https://img-blog.csdnimg.cn/20181026184812150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTgyODQ1,size_27,color_FFFFFF,t_70" alt=""></p>
<h5 id="配置相应的打包命令"><a href="#配置相应的打包命令" class="headerlink" title="配置相应的打包命令"></a>配置相应的打包命令</h5><pre><code>打包命令(跳过 maven 测试)
打开发环境包:  clean compile package -Pdev -Dmaven.test.skip=true
打测试环境包:  clean compile package -Ptest -Dmaven.test.skip=true
打正式环境包:  clean compile package -Pproduct -Dmaven.test.skip=true
打包成功后在项目的target目录下会生成一个war包
</code></pre><h2 id="4-将war包上传到Linux的Tomcat下的webapps目录"><a href="#4-将war包上传到Linux的Tomcat下的webapps目录" class="headerlink" title="4.将war包上传到Linux的Tomcat下的webapps目录"></a>4.将war包上传到Linux的Tomcat下的webapps目录</h2><pre><code>通过ftp 上传静态网站目录 到 tomcat--&gt;webapps 
因为前面你已经安装了传输文件的插件,直接把你的war包用鼠标拖到xsheel里面就行啦!前题此时xsheel必须在Tomcat的WebApps目录下面
</code></pre><h2 id="5-mysql的安装"><a href="#5-mysql的安装" class="headerlink" title="5.mysql的安装"></a>5.mysql的安装</h2><pre><code>mysql 安装与配置
         查看mysql安装历史  rpm -qa | grep mysql
         卸载  yum –y remove mysql(上面查到的自己mysql的版本名称)
执行安装
         yum -y install mysql-server mysql mysql-devel
启动服务        
      service mysqld start     启动
      service mysqld stop      停止   
      service mysqld resatrt   重启
      ||
      /etc/init.d/mysqld start|stop|restart
创建管理员
       mysqladmin -u root  password  root   (用户密码自己设置就行,这里都为root)
执行登录
       mysql -uroot  -proot
执行授权
       grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;root&apos; with grant option;
       FLUSH   PRIVILEGES;  (刷新一下设置)
外界访问 navicat | sqlyog (通过第三方连接测试)
</code></pre><h2 id="6-1-5的步骤都成功了-启动Tomcat服务器就行啦"><a href="#6-1-5的步骤都成功了-启动Tomcat服务器就行啦" class="headerlink" title="6.1~5的步骤都成功了,启动Tomcat服务器就行啦!"></a>6.1~5的步骤都成功了,启动Tomcat服务器就行啦!</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/26/Linux基本命令及项目上线/" data-id="cjoilhtsy0008hwu7hzap62sl" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基本命令/">linux基本命令</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目在linux上线/">项目在linux上线</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Http详解" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/24/Http详解/" class="article-date">
  <time class="post-time" datetime="2018-10-24T07:22:00.000Z" itemprop="datePublished">
    <span class="post-month">10月</span><br/>
    <span class="post-day">24</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/24/Http详解/">Http详解</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/HTTP知识/">HTTP知识</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/10/24/Http详解/" class="leancloud_visitors" data-flag-title="Http详解">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>HTTP简介<br>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。</p>
<p>HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。</p>
<p>HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。目前在WWW中使用的是HTTP/1.0的第六版，HTTP/1.1的规范化工作正在进行之中，而且HTTP-NG(Next Generation of HTTP)的建议已经提出。</p>
<p>HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/2964446-5a35e17f298a48e1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2" target="_blank" rel="noopener">https://upload-images.jianshu.io/upload_images/2964446-5a35e17f298a48e1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2</a></p>
<p>http请求-响应模型.jpg<br>主要特点<br>1、简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。</p>
<p>2、灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。</p>
<p>3.无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</p>
<p>4.无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。<br>5、支持B/S及C/S模式。</p>
<p>HTTP之URL<br>HTTP使用统一资源标识符（Uniform Resource Identifiers, URI）来传输数据和建立连接。URL是一种特殊类型的URI，包含了用于查找某个资源的足够的信息</p>
<p>URL,全称是UniformResourceLocator, 中文叫统一资源定位符,是互联网上用来标识某一处资源的地址。以下面这个URL为例，介绍下普通URL的各部分组成：</p>
<p><a href="http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name" target="_blank" rel="noopener">http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name</a><br>从上面的URL可以看出，一个完整的URL包括以下几部分：<br>1.协议部分：该URL的协议部分为“http：”，这代表网页使用的是HTTP协议。在Internet中可以使用多种协议，如HTTP，FTP等等本例中使用的是HTTP协议。在”HTTP”后面的“//”为分隔符</p>
<p>2.域名部分：该URL的域名部分为“<a href="http://www.aspxfans.com”。一个URL中，也可以使用IP地址作为域名使用" target="_blank" rel="noopener">www.aspxfans.com”。一个URL中，也可以使用IP地址作为域名使用</a></p>
<p>3.端口部分：跟在域名后面的是端口，域名和端口之间使用“:”作为分隔符。端口不是一个URL必须的部分，如果省略端口部分，将采用默认端口</p>
<p>4.虚拟目录部分：从域名后的第一个“/”开始到最后一个“/”为止，是虚拟目录部分。虚拟目录也不是一个URL必须的部分。本例中的虚拟目录是“/news/”</p>
<p>5.文件名部分：从域名后的最后一个“/”开始到“？”为止，是文件名部分，如果没有“?”,则是从域名后的最后一个“/”开始到“#”为止，是文件部分，如果没有“？”和“#”，那么从域名后的最后一个“/”开始到结束，都是文件名部分。本例中的文件名是“index.asp”。文件名部分也不是一个URL必须的部分，如果省略该部分，则使用默认的文件名</p>
<p>6.锚部分：从“#”开始到最后，都是锚部分。本例中的锚部分是“name”。锚部分也不是一个URL必须的部分</p>
<p>7.参数部分：从“？”开始到“#”为止之间的部分为参数部分，又称搜索部分、查询部分。本例中的参数部分为“boardID=5&amp;ID=24618&amp;page=1”。参数可以允许有多个参数，参数与参数之间用“&amp;”作为分隔符。</p>
<p>（原文：<a href="http://blog.csdn.net/ergouge/article/details/8185219" target="_blank" rel="noopener">http://blog.csdn.net/ergouge/article/details/8185219</a> ）</p>
<p>URI和URL的区别<br>URI，是uniform resource identifier，统一资源标识符，用来唯一的标识一个资源。<br>Web上可用的每种资源如HTML文档、图像、视频片段、程序等都是一个来URI来定位的<br>URI一般由三部组成：<br>①访问资源的命名机制<br>②存放资源的主机名<br>③资源自身的名称，由路径表示，着重强调于资源。</p>
<p>URL是uniform resource locator，统一资源定位器，它是一种具体的URI，即URL可以用来标识一个资源，而且还指明了如何locate这个资源。<br>URL是Internet上用来描述信息资源的字符串，主要用在各种WWW客户程序和服务器程序上，特别是著名的Mosaic。<br>采用URL可以用一种统一的格式来描述各种信息资源，包括文件、服务器的地址和目录等。URL一般由三部组成：<br>①协议(或称为服务方式)<br>②存有该资源的主机IP地址(有时也包括端口号)<br>③主机资源的具体地址。如目录和文件名等</p>
<p>URN，uniform resource name，统一资源命名，是通过名字来标识资源，比如mailto:<a href="mailto:java-net@java.sun.com" target="_blank" rel="noopener">java-net@java.sun.com</a>。<br>URI是以一种抽象的，高层次概念定义统一资源标识，而URL和URN则是具体的资源标识的方式。URL和URN都是一种URI。笼统地说，每个 URL 都是 URI，但不一定每个 URI 都是 URL。这是因为 URI 还包括一个子类，即统一资源名称 (URN)，它命名资源但不指定如何定位资源。上面的 mailto、news 和 isbn URI 都是 URN 的示例。</p>
<p>在Java的URI中，一个URI实例可以代表绝对的，也可以是相对的，只要它符合URI的语法规则。而URL类则不仅符合语义，还包含了定位该资源的信息，因此它不能是相对的。<br>在Java类库中，URI类不包含任何访问资源的方法，它唯一的作用就是解析。<br>相反的是，URL类可以打开一个到达资源的流。</p>
<p>HTTP之请求消息Request<br>客户端发送一个HTTP请求到服务器的请求消息包括以下格式：</p>
<p>请求行（request line）、请求头部（header）、空行和请求数据四个部分组成。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/2964446-fdfb1a8fce8de946.png?imageMogr2/auto-orient/strip%7CimageView2/2" target="_blank" rel="noopener">https://upload-images.jianshu.io/upload_images/2964446-fdfb1a8fce8de946.png?imageMogr2/auto-orient/strip%7CimageView2/2</a></p>
<p>Http请求消息结构.png<br>请求行以一个方法符号开头，以空格分开，后面跟着请求的URI和协议的版本。<br>Get请求例子，使用Charles抓取的request：<br>GET /562f25980001b1b106000338.jpg HTTP/1.1<br>Host    img.mukewang.com<br>User-Agent    Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36<br>Accept    image/webp,image/<em>,</em>/*;q=0.8<br>Referer    <a href="http://www.imooc.com/" target="_blank" rel="noopener">http://www.imooc.com/</a><br>Accept-Encoding    gzip, deflate, sdch<br>Accept-Language    zh-CN,zh;q=0.8<br>第一部分：请求行，用来说明请求类型,要访问的资源以及所使用的HTTP版本.<br>GET说明请求类型为GET,[/562f25980001b1b106000338.jpg]为要访问的资源，该行的最后一部分说明使用的是HTTP1.1版本。</p>
<p>第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息<br>从第二行起为请求头部，HOST将指出请求的目的地.User-Agent,服务器端和客户端脚本都能访问它,它是浏览器类型检测逻辑的重要基础.该信息由你的浏览器来定义,并且在每个请求中自动发送等等</p>
<p>第三部分：空行，请求头部后面的空行是必须的<br>即使第四部分的请求数据为空，也必须有空行。</p>
<p>第四部分：请求数据也叫主体，可以添加任意的其他数据。<br>这个例子的请求数据为空。</p>
<p>POST请求例子，使用Charles抓取的request：<br>POST / HTTP1.1<br>Host:<a href="http://www.wrox.com" target="_blank" rel="noopener">www.wrox.com</a><br>User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)<br>Content-Type:application/x-www-form-urlencoded<br>Content-Length:40<br>Connection: Keep-Alive</p>
<p>name=Professional%20Ajax&amp;publisher=Wiley<br>第一部分：请求行，第一行明了是post请求，以及http1.1版本。<br>第二部分：请求头部，第二行至第六行。<br>第三部分：空行，第七行的空行。<br>第四部分：请求数据，第八行。</p>
<p>HTTP之响应消息Response<br>一般情况下，服务器接收并处理客户端发过来的请求后会返回一个HTTP的响应消息。</p>
<p>HTTP响应也由四个部分组成，分别是：状态行、消息报头、空行和响应正文。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/2964446-1c4cab46f270d8ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2" target="_blank" rel="noopener">https://upload-images.jianshu.io/upload_images/2964446-1c4cab46f270d8ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2</a></p>
<p>http响应消息格式.jpg<br>例子</p>
<p>HTTP/1.1 200 OK<br>Date: Fri, 22 May 2009 06:07:21 GMT<br>Content-Type: text/html; charset=UTF-8</p>
<p><html><br>      <head></head><br>      <body><br>            <!--body goes here--><br>      </body><br></html><br>第一部分：状态行，由HTTP协议版本号， 状态码， 状态消息 三部分组成。<br>第一行为状态行，（HTTP/1.1）表明HTTP版本为1.1版本，状态码为200，状态消息为（ok）</p>
<p>第二部分：消息报头，用来说明客户端要使用的一些附加信息<br>第二行和第三行为消息报头，<br>Date:生成响应的日期和时间；Content-Type:指定了MIME类型的HTML(text/html),编码类型是UTF-8</p>
<p>第三部分：空行，消息报头后面的空行是必须的<br>第四部分：响应正文，服务器返回给客户端的文本信息。<br>空行后面的html部分为响应正文。</p>
<p>HTTP之状态码<br>状态代码有三位数字组成，第一个数字定义了响应的类别，共分五种类别:</p>
<p>1xx：指示信息–表示请求已接收，继续处理<br>2xx：成功–表示请求已被成功接收、理解、接受<br>3xx：重定向–要完成请求必须进行更进一步的操作<br>4xx：客户端错误–请求有语法错误或请求无法实现<br>5xx：服务器端错误–服务器未能实现合法的请求<br>常见状态码：</p>
<p>200 OK                        //客户端请求成功<br>400 Bad Request               //客户端请求有语法错误，不能被服务器所理解<br>401 Unauthorized              //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用<br>403 Forbidden                 //服务器收到请求，但是拒绝提供服务<br>404 Not Found                 //请求资源不存在，eg：输入了错误的URL<br>500 Internal Server Error     //服务器发生不可预期的错误<br>503 Server Unavailable        //服务器当前不能处理客户端的请求，一段时间后可能恢复正常<br>更多状态码<a href="http://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">http://www.runoob.com/http/http-status-codes.html</a></p>
<p>HTTP请求方法<br>根据HTTP标准，HTTP请求可以使用多种请求方法。<br>HTTP1.0定义了三种请求方法： GET, POST 和 HEAD方法。<br>HTTP1.1新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。</p>
<p>GET     请求指定的页面信息，并返回实体主体。<br>HEAD     类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头<br>POST     向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。<br>PUT     从客户端向服务器传送的数据取代指定的文档的内容。<br>DELETE      请求服务器删除指定的页面。<br>CONNECT     HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。<br>OPTIONS     允许客户端查看服务器的性能。<br>TRACE     回显服务器收到的请求，主要用于测试或诊断。<br>HTTP工作原理<br>HTTP协议定义Web客户端如何从Web服务器请求Web页面，以及服务器如何把Web页面传送给客户端。HTTP协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。</p>
<p>以下是 HTTP 请求/响应的步骤：</p>
<p>1、客户端连接到Web服务器<br>一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。例如，<a href="http://www.oakcms.cn。" target="_blank" rel="noopener">http://www.oakcms.cn。</a></p>
<p>2、发送HTTP请求<br>通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据4部分组成。</p>
<p>3、服务器接受请求并返回HTTP响应<br>Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据4部分组成。</p>
<p>4、释放连接TCP连接<br>若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;</p>
<p>5、客户端浏览器解析HTML内容<br>客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。</p>
<p>例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：</p>
<p>1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;</p>
<p>2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;</p>
<p>3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;</p>
<p>4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;</p>
<p>5、释放 TCP连接;</p>
<p>6、浏览器将该 html 文本并显示内容; 　　</p>
<p>GET和POST请求的区别<br>GET请求<br>GET /books/?sex=man&amp;name=Professional HTTP/1.1<br>Host: <a href="http://www.wrox.com" target="_blank" rel="noopener">www.wrox.com</a><br>User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)<br>Gecko/20050225 Firefox/1.0.1<br>Connection: Keep-Alive<br>注意最后一行是空行</p>
<p>POST请求<br>POST / HTTP/1.1<br>Host: <a href="http://www.wrox.com" target="_blank" rel="noopener">www.wrox.com</a><br>User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)<br>Gecko/20050225 Firefox/1.0.1<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 40<br>Connection: Keep-Alive</p>
<p>name=Professional%20Ajax&amp;publisher=Wiley<br>1、GET提交，请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，多个参数用&amp;连接；例 如：login.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%A0 %E5%A5%BD。如果数据是英文字母/数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密，得出如： %E4%BD%A0%E5%A5%BD，其中％XX中的XX为该符号以16进制表示的ASCII。</p>
<p>POST提交：把提交的数据放置在是HTTP包的包体中。上文示例中红色字体标明的就是实际的传输数据</p>
<p>因此，GET提交的数据会在地址栏中显示出来，而POST提交，地址栏不会改变<br>2、传输数据的大小：首先声明：HTTP协议没有对传输的数据大小进行限制，HTTP协议规范也没有对URL长度进行限制。</p>
<p>而在实际开发中存在的限制主要有：</p>
<p>GET:特定浏览器和服务器对URL长度有限制，例如 IE对URL长度的限制是2083字节(2K+35)。对于其他浏览器，如Netscape、FireFox等，理论上没有长度限制，其限制取决于操作系 统的支持。</p>
<p>因此对于GET提交时，传输数据就会受到URL长度的 限制。</p>
<p>POST:由于不是通过URL传值，理论上数据不受 限。但实际各个WEB服务器会规定对post提交数据大小进行限制，Apache、IIS6都有各自的配置。</p>
<p>3、安全性</p>
<p>POST的安全性要比GET的安全性高。比如：通过GET提交数据，用户名和密码将明文出现在URL上，因为(1)登录页面有可能被浏览器缓存；(2)其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了，除此之外，使用GET提交数据还可能会造成Cross-site request forgery攻击</p>
<p>4、Http get,post,soap协议都是在http上运行的</p>
<p>（1）get：请求参数是作为一个key/value对的序列（查询字符串）附加到URL上的<br>查询字符串的长度受到web浏览器和web服务器的限制（如IE最多支持2048个字符），不适合传输大型数据集同时，它很不安全</p>
<p>（2）post：请求参数是在http标题的一个不同部分（名为entity body）传输的，这一部分用来传输表单信息，因此必须将Content-type设置为:application/x-www-form- urlencoded。post设计用来支持web窗体上的用户字段，其参数也是作为key/value对传输。<br>但是：它不支持复杂数据类型，因为post没有定义传输数据结构的语义和规则。</p>
<p>（3）soap：是http post的一个专用版本，遵循一种特殊的xml消息格式<br>Content-type设置为: text/xml 任何数据都可以xml化。</p>
<p>Http协议定义了很多与服务器交互的方法，最基本的有4种，分别是GET,POST,PUT,DELETE. 一个URL地址用于描述一个网络上的资源，而HTTP中的GET, POST, PUT, DELETE就对应着对这个资源的查，改，增，删4个操作。 我们最常见的就是GET和POST了。GET一般用于获取/查询资源信息，而POST一般用于更新资源信息.</p>
<p>我们看看GET和POST的区别</p>
<p>GET提交的数据会放在URL之后，以?分割URL和传输数据，参数之间以&amp;相连，如EditPosts.aspx?name=test1&amp;id=123456. POST方法是把提交的数据放在HTTP包的Body中.</p>
<p>GET提交的数据大小有限制（因为浏览器对URL的长度有限制），而POST方法提交的数据没有限制.</p>
<p>GET方式需要使用Request.QueryString来取得变量的值，而POST方式通过Request.Form来获取变量的值。</p>
<p>GET方式提交数据，会带来安全问题，比如一个登录页面，通过GET方式提交数据时，用户名和密码将出现在URL上，如果页面可以被缓存或者其他人可以访问这台机器，就可以从历史记录获得该用户的账号和密码.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/24/Http详解/" data-id="cjoilhtsw0007hwu7hstdst0a" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-正式版" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/15/正式版/" class="article-date">
  <time class="post-time" datetime="2018-10-15T15:48:00.000Z" itemprop="datePublished">
    <span class="post-month">10月</span><br/>
    <span class="post-day">15</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/15/正式版/">正式版</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/10/15/正式版/" class="leancloud_visitors" data-flag-title="正式版">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>一.实现环境</p>
<p>二.POI简介</p>
<p>三.本博客实现的小目标</p>
<p>四.具体实现步骤</p>
<p>1.项目的基本结构</p>
<p>2.引入相应的jar包依赖(pom.xml的配置):</p>
<p>3.jdbc.properties与spring-jdbc.xml的配置(根据自己的mysql自行修改)</p>
<p>4.实现增删改查的功能接口</p>
<p>5.接口的实现类</p>
<p>一.实现环境<br>Spring + idea2018 + jdk1.8 + excel2013 + mysql数据库</p>
<p>二.POI简介<br>Apache POI是Apache软件基金会的开放源码函式库，POI提供API给Java程序对Microsoft Office格式档案读和写的功能。是纯java技术.其主要的基本功能模块如下:</p>
<p>HSSF － 提供读写Microsoft Excel格式档案的功能。<br>XSSF － 提供读写Microsoft Excel OOXML格式档案的功能。<br>HWPF － 提供读写Microsoft Word格式档案的功能。<br>HSLF － 提供读写Microsoft PowerPoint格式档案的功能。<br>HDGF － 提供读写Microsoft Visio格式档案的功能。<br>三.本博客实现的小目标<br>利用POI对excle的读取与修改,并实现与mysql数据库的数据交互,包括基本的增删改查.</p>
<p>四.具体实现步骤<br>1.项目的基本结构</p>
<p>首先先准备一个使用的excle表格,名叫student.xlsx:</p>
<p>对应的Student实体类为:</p>
<p>package com.shsxt.entity;</p>
<p>/**</p>
<ul>
<li>Created on 2018/10/3 18:09</li>
<li>Author: Mr Tong<br>*/</li>
</ul>
<p>public class Student {</p>
<pre><code>private Integer s_id; //主键
private Integer s_no; //序号
private String s_name; //名字
private Integer s_age; //年龄
private String s_sex; //性别
private double s_grade; //分数

//有用到
public Student() {
}

//大用处,哈哈哈哈哈
public Student(Integer s_no, String s_name, Integer s_age, String s_sex, double s_grade) {
    this.s_no = s_no;
    this.s_name = s_name;
    this.s_age = s_age;
    this.s_sex = s_sex;
    this.s_grade = s_grade;
}


public Integer getS_id() {
    return s_id;
}

public void setS_id(Integer s_id) {
    this.s_id = s_id;
}

public Integer getS_no() {
    return s_no;
}

public void setS_no(Integer s_no) {
    this.s_no = s_no;
}

public String getS_name() {
    return s_name;
}

public void setS_name(String s_name) {
    this.s_name = s_name;
}

public Integer getS_age() {
    return s_age;
}

public void setS_age(Integer s_age) {
    this.s_age = s_age;
}

public String getS_sex() {
    return s_sex;
}

public void setS_sex(String s_sex) {
    this.s_sex = s_sex;
}

public double getS_grade() {
    return s_grade;
}

public void setS_grade(double s_grade) {
    this.s_grade = s_grade;
}
</code></pre><p>}<br>2.引入相应的jar包依赖(pom.xml的配置):</p>
<p><dependencies><br>    <dependency><br>      <groupid>junit</groupid><br>      <artifactid>junit</artifactid><br>      <version>4.12</version><br>      <scope>test</scope><br>    </dependency><br>    <!-- spring 测试环境 --><br>    <dependency><br>      <groupid>org.springframework</groupid><br>      <artifactid>spring-test</artifactid><br>      <version>4.3.2.RELEASE</version><br>      <scope>test</scope><br>    </dependency></dependencies></p>
<pre><code>&lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
  &lt;artifactId&gt;poi&lt;/artifactId&gt;
  &lt;version&gt;3.17&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
  &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
  &lt;version&gt;3.17&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- spring 框架坐标依赖添加 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
  &lt;version&gt;4.3.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- spring jdbc --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
  &lt;version&gt;4.3.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- mysql 驱动包 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;mysql&lt;/groupId&gt;
  &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
  &lt;version&gt;5.1.39&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- c3p0 连接池 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;c3p0&lt;/groupId&gt;
  &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
  &lt;version&gt;0.9.1.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--
      加入aop 坐标
    --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
  &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
  &lt;version&gt;1.8.9&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- spring 上下文环境 支持 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
  &lt;version&gt;4.3.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>  <br>3.jdbc.properties与spring-jdbc.xml的配置(根据自己的mysql自行修改)<br>jdbc.driver=com.mysql.jdbc.Driver<br>jdbc.url=jdbc:mysql://localhost:3306/spring?useUnicode=true&amp;characterEncoding=utf8<br>jdbc.user=root<br>jdbc.password=root<br>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>
<p><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xsi:schemalocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"><br>    <a href="context:annotation-config/" target="_blank" rel="noopener">context:annotation-config/</a><br>    <!--
      配置扫描器
    --><br>   <!-- <context:component-scan base-package="com.shsxt"></context:component-scan>--><br>    &lt;context:component-scan base-package=”com.shsxt”/&gt;</beans></p>
<pre><code>&lt;!--
   加载properties 配置文件
--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;aop:aspectj-autoproxy/&gt;


&lt;!--
 配置数据源c3p0
--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
    &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;user&quot; value=&quot;${jdbc.user}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;


&lt;!--
   配置 jdbcTemplate
--&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre><p><br>4.实现增删改查的功能接口<br>package com.shsxt.dao;</p>
<p>/**</p>
<ul>
<li>Created on 2018/10/3 18:40</li>
<li>Author: Mr Tong<br>*/</li>
</ul>
<p>public interface StudentDao {</p>
<pre><code>/**
 * 批量添加Student实体类的记录
 * @param students
 * @return
 */
public Integer saveStudentBatch(List&lt;Student&gt; students);

/**
 * 查询所有的记录
 * @return
 */
public List&lt;Student&gt; queryAllRecord();

/**
 * 统计账户记录-聚合查询
 * sum  max  min  count
 * group by   having
 * @return
 */
public  Integer countStudentsByS_no();
</code></pre><p>}<br>5.接口的实现类<br>package com.shsxt.dao.impl;</p>
<p>/**</p>
<ul>
<li>Created on 2018/10/3 18:45</li>
<li>Author: Mr Tong<br>*/</li>
</ul>
<p>@Repository<br>public class StudentDaoImpl implements StudentDao {</p>
<pre><code>@Resource
private JdbcTemplate jdbcTemplate;

/**
 * 批量添加Student实体类的记录
 * @param students
 * @return
 */

@Override
public Integer saveStudentBatch(List&lt;Student&gt; students) {

    String sql=&quot;insert into tb_student(s_no,s_name,s_age,s_sex,s_grade) values(?,?,?,?,?)&quot;;

    return jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {
        @Override
        public void setValues(PreparedStatement ps, int i) throws SQLException {

            //准备容器接收参数

            //Student student = (Student) students.get(i);
            //Map&lt;Integer,List&lt;Object[]&gt;&gt; map = new HashMap&lt;&gt;();
            //Student student = new Student();
            Student student = students.get(i);
                ps.setInt(1, student.getS_no());
                ps.setString(2, student.getS_name());
                ps.setInt(3, student.getS_age());
                ps.setString(4, student.getS_sex());
                ps.setDouble(5, student.getS_grade());
            }

        @Override
        public int getBatchSize() {
            // 批量添加记录的总条数
            return students.size();
        }
    }).length;
}

/**
 * 查询所有的记录
 * @return
 */

@Override
public List&lt;Student&gt; queryAllRecord() {

    //准备好sql语句,查询所有
    String sql = &quot;select * from tb_student &quot;;

    return jdbcTemplate.query(sql, new RowMapper&lt;Student&gt;() {
        @Override
        public Student mapRow(ResultSet rs, int rowNum) throws SQLException {

            //定义个实体类来接收查询的结果
            Student student = new Student();
            //设置值
            student.setS_no(rs.getInt(&quot;s_no&quot;));
            student.setS_name(rs.getString(&quot;s_name&quot;));
            student.setS_age(rs.getInt(&quot;s_age&quot;));
            student.setS_sex(rs.getString(&quot;s_sex&quot;));
            student.setS_grade(rs.getDouble(&quot;s_grade&quot;));
            return student;
        }
    });
}

/**
 * 统计账户记录-聚合查询
 * sum  max  min  count
 * group by   having
 * @return
 */

@Override
public Integer countStudentsByS_no() {

    String sql=&quot;select count(1) from tb_student &quot;;

    return jdbcTemplate.queryForObject(sql, Integer.class);
}
</code></pre><p>}</p>
<p>基本的功能实已经实现啦!现在让我们来测试一下:</p>
<p>测试读取excle表格的数据到mysql数据库的操作(TestToMysql):</p>
<p>/**</p>
<ul>
<li>Created on 2018/10/3 16:59</li>
<li>Author: Mr Tong<br>*/</li>
</ul>
<p>@RunWith(SpringJUnit4ClassRunner.class)<br>@ContextConfiguration(locations = {“classpath:spring-jdbc.xml”})<br>public class TestToMysql {</p>
<pre><code>@Resource
private StudentDao studentDao;

@Test
public void test(){

    //定义一个容器用来接收Excel中的数据
    //List&lt;Student&gt; students = new ArrayList&lt;&gt;();

    //Map&lt;Integer, List&lt;Student&gt;&gt; students = new HashMap&lt;&gt;();
    List&lt;Student&gt; students = new ArrayList&lt;&gt;();
    Student student = new Student();

    //定义一个成员变量,得到下面的每行中单元格cell的数量,并传入方法中
    int cellNums = 0; 

    //得到一个输入流,inp为所读xlsx表格的对象
    try (InputStream inp = new FileInputStream(&quot;C:\\Users\\威威\\Desktop\\student.xlsx&quot;)) {
        //InputStream inp = new FileInputStream(&quot;workbook.xlsx&quot;);


        //借助WorkbookFactory创建一个工作簿Workbook
        Workbook wb = WorkbookFactory.create(inp);

        //得到表
        for (Sheet sheet : wb ) {

            //得到表中行的数量,getLastRowNum返回最后一个下标
            int rowNum = sheet.getLastRowNum() + 1;

            //得到一行中单元格的数量,getLastCellNum函数返回最后一个下标+1
            //Row row = sheet.getRow(rowNum);

            for (int i=1; i&lt;rowNum; ++i) {

                //得到Excel表格的行
                Row row = sheet.getRow(i);
                int cellNum = row.getLastCellNum();

                //赋值给成员变量
                cellNums = cellNum;

                //把每行的cell内容加进去
                /*for (int j = 0; j &lt; cellNum; j++) {
                    //list.add(j, row.getCell(j).getStringCellValue());
                    student.setS_no((int) row.getCell(j).getNumericCellValue());
                    //每次都移除最后一个元素,防止重复(debug可见实质)
                    while (i != 0) {
                        list.remove(5);
                        break;
                    }
                }*/
                student.setS_no((int) row.getCell(0).getNumericCellValue());
                student.setS_name((String) row.getCell(1).getStringCellValue());
                student.setS_age((int) row.getCell(2).getNumericCellValue());
                student.setS_sex((String) row.getCell(3).getStringCellValue());
                student.setS_grade(row.getCell(4).getNumericCellValue());

                //将最新的一行数据加入到map集合里面
                students.add(0, student);
                //调用Dao层方法,进行批量添加
                studentDao.saveStudentBatch(students);
                //清空students,哈哈哈
                students.clear();
            }

        }
    } catch (IOException e) {
        e.printStackTrace();
    }  catch (InvalidFormatException e) {
        e.printStackTrace();
    }

}
</code></pre><p>}<br>测试从数据库中修改记录更新到excle表格的功能(TestToExcle):</p>
<p>/**</p>
<ul>
<li>Created on 2018/10/4 11:21</li>
<li>Author: Mr Tong<br>*/</li>
</ul>
<p>@RunWith(SpringJUnit4ClassRunner.class)<br>@ContextConfiguration(locations = {“classpath:spring-jdbc.xml”})<br>public class TestToExcel {</p>
<pre><code>@Resource
private StudentDao studentDao;

@Test
public void test01(){

    //调用方法得到数据库中的所有记录
    List&lt;Student&gt; list = studentDao.queryAllRecord();
    //System.out.println(list.get(0));

    //得到数据库中记录的条数
    int recodeNums = studentDao.countStudentsByS_no();

    //Reading and Rewriting Workbooks
    try (InputStream inp = new FileInputStream(&quot;C:\\Users\\威威\\Desktop\\test.xlsx&quot;)) {
        //InputStream inp = new FileInputStream(&quot;workbook.xlsx&quot;);

        //借助WorkbookFactory创建一个工作簿Workbook
        Workbook wb = WorkbookFactory.create(inp);

        //得到sheet,因为只有一个sheet,所有也不需要遍历啦!
        Sheet sheet = wb.getSheetAt(0);

        //得到表中行的数量,getLastRowNum返回最后一个下标
        int rowNum = sheet.getLastRowNum() + 1;

        //遍历表中的所有行
        for (int i = 1; i &lt; rowNum; i++) {

            //得到Excel表格的行
            Row row = sheet.getRow(i);
            Student student = list.get(i-1);

            //得到单元格的数量
            int cellNum = row.getLastCellNum();

            //遍历单元格,改变单元格中的值
            for (int j = 0; j &lt; cellNum; j++) {

                //得到对应的单元格
                Cell cell = row.getCell(j);

                //给单元格设置对应的值
               if(j == 0){
                   cell.setCellValue(student.getS_no());
               }if(j == 1){
                    cell.setCellValue(student.getS_name());
               }if(j == 2){
                    cell.setCellValue(student.getS_age());
               }if(j == 3){
                    cell.setCellValue(student.getS_sex());
               }if(j == 4){
                    cell.setCellValue(student.getS_grade());
               }
            }
        }

        // Write the output to a file
        try (OutputStream fileOut = new FileOutputStream(&quot;C:\\Users\\威威\\Desktop\\test.xlsx&quot;)) {
            wb.write(fileOut);
        }
    }  catch (IOException e) {
        e.printStackTrace();
    } catch (InvalidFormatException e) {
        e.printStackTrace();
    }
}
</code></pre><p>}</p>
<h2 id="PS-以上就实现了excle与mysql数据库之间的数据交互啦"><a href="#PS-以上就实现了excle与mysql数据库之间的数据交互啦" class="headerlink" title="PS~~以上就实现了excle与mysql数据库之间的数据交互啦!!!!"></a>PS~~以上就实现了excle与mysql数据库之间的数据交互啦!!!!</h2><p>作者：萌萌的PP<br>来源：CSDN<br>原文：<a href="https://blog.csdn.net/qq_38982845/article/details/83026407?utm_source=copy" target="_blank" rel="noopener">https://blog.csdn.net/qq_38982845/article/details/83026407?utm_source=copy</a><br>版权声明：本文为博主原创文章，转载请附上博文链接！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/15/正式版/" data-id="cjoilhttq000ohwu7qsbni3kk" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java分类/">java分类</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">萌萌的PP</h1>
    <h2 class="blog-subtitle">帅哥美女们 , 快来一起码代码啊!!!</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/" title="About">
            <li>关于</li>
          </a>
        
          <a href="/" title="展示">
            <li>展示</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://mmdpp.oss-cn-hangzhou.aliyuncs.com/blog_picture/photo.png?Expires=1542289434&amp;OSSAccessKeyId=TMP.AQG_RpuS4fyqggAxYqW_-DP3rhVICt7iBDnM2SL8sxXGOIE4S99ZyErlUmX1ADAtAhQuet9a6zd-APvmQsTcEovHdxiSSAIVAM-031-ELaXQL220snS3uY_RUT0O&amp;Signature=5LUKd6FkQqv3HA0s92Z7Wj8rmmo%3D">
    <h2 class="author">Mr Tong</h2>
    <h3 class="description">爱好码代码的小菜鸟啦!!!</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>13</strong><br>文章</div></a>
      <a href="/categories"><div><strong>5</strong><br>分类</div></a>
      <a href="/tags"><div><strong>15</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="https://github.com/fly-tong" target="_blank" title="Github">
          Github
        </a>
      
        <a class="hvr-bounce-in" href="https://blog.csdn.net/qq_38982845" target="_blank" title="CSDN">
          CSDN
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="https://github.com/fly-tong/fly-tong.github.io" target="_blank" title="blog home">
          blog home
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 Mr Tong<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/archives" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/" title="" class="menuItem">关于</a>
          
            <a href="/" title="" class="menuItem">展示</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>




  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.article-title').length > 1) {
        showTime(Counter);
      }
    });
  </script>





  </div>
</body>
</html>